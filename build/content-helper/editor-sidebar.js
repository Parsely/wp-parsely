!function(){"use strict";var e={251:function(e,t,n){var r=n(196),s=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,r)&&!o.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:s,type:e,key:c,ref:u,props:i,_owner:l.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},893:function(e,t,n){e.exports=n(251)},196:function(e){e.exports=window.React}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){n.d({},{W:function(){return Kt}});var e,t,r,s=n(893),i=window.wp.components,a=window.wp.data,l=window.wp.editPost,o=window.wp.element,c=window.wp.i18n,u=n(196),p=window.wp.primitives,d=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{fillRule:"evenodd",d:"M11.25 5h1.5v15h-1.5V5zM6 10h1.5v10H6V10zm12 4h-1.5v6H18v-6z",clipRule:"evenodd"})),f=window.wp.plugins,g=function(){function e(){this._tkq=[],this.isLoaded=!1,this.isEnabled=!1,"undefined"!=typeof wpParselyTracksTelemetry&&(this.isEnabled=!0,this.loadTrackingLibrary())}return e.getInstance=function(){return window.wpParselyTelemetryInstance||Object.defineProperty(window,"wpParselyTelemetryInstance",{value:new e,writable:!1,configurable:!1,enumerable:!1}),window.wpParselyTelemetryInstance},e.prototype.loadTrackingLibrary=function(){var e=this,t=document.createElement("script");t.async=!0,t.src="//stats.wp.com/w.js",t.onload=function(){e.isLoaded=!0,e._tkq=window._tkq||[]},document.head.appendChild(t)},e.trackEvent=function(t,n){return void 0===n&&(n={}),r=this,s=void 0,a=function(){var r;return function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(o){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&l[0]?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){a.label=l[1];break}if(6===l[0]&&a.label<s[1]){a.label=s[1],s=l;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(l);break}s[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,o])}}}(this,(function(s){switch(s.label){case 0:return(r=e.getInstance()).isTelemetryEnabled()?[4,e.waitUntilLoaded()]:[2];case 1:return s.sent(),r.trackEvent(t,n),[2]}}))},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{o(a.next(e))}catch(e){t(e)}}function l(e){try{o(a.throw(e))}catch(e){t(e)}}function o(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(n,l)}o((a=a.apply(r,s||[])).next())}));var r,s,i,a},e.waitUntilLoaded=function(){return new Promise((function(t,n){var r=e.getInstance();if(r.isTelemetryEnabled())if(r.isLoaded)t();else var s=0,i=setInterval((function(){r.isLoaded&&(clearInterval(i),t()),(s+=100)>=1e4&&(clearInterval(i),n("Telemetry library not loaded"))}),100);else n("Telemetry not enabled")}))},e.prototype.trackEvent=function(t,n){var r;this.isLoaded?(0!==t.indexOf(e.TRACKS_PREFIX)&&(t=e.TRACKS_PREFIX+t),this.isEventNameValid(t)?(n=this.prepareProperties(n),null===(r=this._tkq)||void 0===r||r.push(["recordEvent",t,n])):console.error("Error tracking event: Invalid event name")):console.error("Error tracking event: Telemetry not loaded")},e.prototype.isTelemetryEnabled=function(){return this.isEnabled},e.prototype.isProprietyValid=function(t){return e.PROPERTY_REGEX.test(t)},e.prototype.isEventNameValid=function(t){return e.EVENT_NAME_REGEX.test(t)},e.prototype.prepareProperties=function(e){return(e=this.sanitizeProperties(e)).parsely_version=wpParselyTracksTelemetry.version,wpParselyTracksTelemetry.user&&(e._ut=wpParselyTracksTelemetry.user.type,e._ui=wpParselyTracksTelemetry.user.id),wpParselyTracksTelemetry.vipgo_env&&(e.vipgo_env=wpParselyTracksTelemetry.vipgo_env),this.sanitizeProperties(e)},e.prototype.sanitizeProperties=function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.isProprietyValid(r)&&(n[r]=e[r])})),n},e.TRACKS_PREFIX="wpparsely_",e.EVENT_NAME_REGEX=/^(([a-z0-9]+)_){2}([a-z0-9_]+)$/,e.PROPERTY_REGEX=/^[a-z_][a-z0-9_]*$/,e}(),h=(g.trackEvent,function(){return(0,s.jsx)(i.SVG,{"aria-hidden":"true",version:"1.1",viewBox:"0 0 15 15",width:"15",height:"15",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)(i.Path,{d:"M0 14.0025V11.0025L7.5 3.5025L10.5 6.5025L3 14.0025H0ZM12 5.0025L13.56 3.4425C14.15 2.8525 14.15 1.9025 13.56 1.3225L12.68 0.4425C12.09 -0.1475 11.14 -0.1475 10.56 0.4425L9 2.0025L12 5.0025Z"})})}),y=function(e){var t=e.size,n=void 0===t?24:t,r=e.className,a=void 0===r?"wp-parsely-icon":r;return(0,s.jsxs)(i.SVG,{className:a,height:n,viewBox:"0 0 60 65",width:n,xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)(i.Path,{fill:"#5ba745",d:"M23.72,51.53c0-.18,0-.34-.06-.52a13.11,13.11,0,0,0-2.1-5.53A14.74,14.74,0,0,0,19.12,43c-.27-.21-.5-.11-.51.22l-.24,3.42c0,.33-.38.35-.49,0l-1.5-4.8a1.4,1.4,0,0,0-.77-.78,23.91,23.91,0,0,0-3.1-.84c-1.38-.24-3.39-.39-3.39-.39-.34,0-.45.21-.25.49l2.06,3.76c.2.27,0,.54-.29.33l-4.51-3.6a3.68,3.68,0,0,0-2.86-.48c-1,.16-2.44.46-2.44.46a.68.68,0,0,0-.39.25.73.73,0,0,0-.14.45S.41,43,.54,44a3.63,3.63,0,0,0,1.25,2.62L6.48,50c.28.2.09.49-.23.37l-4.18-.94c-.32-.12-.5,0-.4.37,0,0,.69,1.89,1.31,3.16a24,24,0,0,0,1.66,2.74,1.34,1.34,0,0,0,1,.52l5,.13c.33,0,.41.38.1.48L7.51,58c-.31.1-.34.35-.07.55a14.29,14.29,0,0,0,3.05,1.66,13.09,13.09,0,0,0,5.9.5,25.13,25.13,0,0,0,4.34-1,9.55,9.55,0,0,1-.08-1.2,9.32,9.32,0,0,1,3.07-6.91"}),(0,s.jsx)(i.Path,{fill:"#5ba745",d:"M59.7,41.53a.73.73,0,0,0-.14-.45.68.68,0,0,0-.39-.25s-1.43-.3-2.44-.46a3.64,3.64,0,0,0-2.86.48l-4.51,3.6c-.26.21-.49-.06-.29-.33l2.06-3.76c.2-.28.09-.49-.25-.49,0,0-2,.15-3.39.39a23.91,23.91,0,0,0-3.1.84,1.4,1.4,0,0,0-.77.78l-1.5,4.8c-.11.32-.48.3-.49,0l-.24-3.42c0-.33-.24-.43-.51-.22a14.74,14.74,0,0,0-2.44,2.47A13.11,13.11,0,0,0,36.34,51c0,.18,0,.34-.06.52a9.26,9.26,0,0,1,3,8.1,24.1,24.1,0,0,0,4.34,1,13.09,13.09,0,0,0,5.9-.5,14.29,14.29,0,0,0,3.05-1.66c.27-.2.24-.45-.07-.55l-3.22-1.17c-.31-.1-.23-.47.1-.48l5-.13a1.38,1.38,0,0,0,1-.52A24.6,24.6,0,0,0,57,52.92c.61-1.27,1.31-3.16,1.31-3.16.1-.33-.08-.49-.4-.37l-4.18.94c-.32.12-.51-.17-.23-.37l4.69-3.34A3.63,3.63,0,0,0,59.46,44c.13-1,.24-2.47.24-2.47"}),(0,s.jsx)(i.Path,{fill:"#5ba745",d:"M46.5,25.61c0-.53-.35-.72-.8-.43l-4.86,2.66c-.45.28-.56-.27-.23-.69l4.66-6.23a2,2,0,0,0,.28-1.68,36.51,36.51,0,0,0-2.19-4.89,34,34,0,0,0-2.81-3.94c-.33-.41-.74-.35-.91.16l-2.28,5.68c-.16.5-.6.48-.59-.05l.28-8.93a2.54,2.54,0,0,0-.66-1.64S35,4.27,33.88,3.27,30.78.69,30.78.69a1.29,1.29,0,0,0-1.54,0s-1.88,1.49-3.12,2.59-2.48,2.35-2.48,2.35A2.5,2.5,0,0,0,23,7.27l.27,8.93c0,.53-.41.55-.58.05l-2.29-5.69c-.17-.5-.57-.56-.91-.14a35.77,35.77,0,0,0-3,4.2,35.55,35.55,0,0,0-2,4.62,2,2,0,0,0,.27,1.67l4.67,6.24c.33.42.23,1-.22.69l-4.87-2.66c-.45-.29-.82-.1-.82.43a18.6,18.6,0,0,0,.83,5.07,20.16,20.16,0,0,0,5.37,7.77c3.19,3,5.93,7.8,7.45,11.08A9.6,9.6,0,0,1,30,49.09a9.31,9.31,0,0,1,2.86.45c1.52-3.28,4.26-8.11,7.44-11.09a20.46,20.46,0,0,0,5.09-7,19,19,0,0,0,1.11-5.82"}),(0,s.jsx)(i.Path,{fill:"#5ba745",d:"M36.12,58.44A6.12,6.12,0,1,1,30,52.32a6.11,6.11,0,0,1,6.12,6.12"})]})},v=function(){return v=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},v.apply(this,arguments)},m={},w="wp-parsely/settings",_=(0,a.createReduxStore)(w,{initialState:m,reducer:function(e,t){var n,r;switch(void 0===e&&(e=m),t.type){case"SET_SETTINGS":return v(v({},e),((n={})[t.endpoint]=t.settings,n));case"SET_PARTIAL_SETTINGS":var s=e[t.endpoint]||{},i=v(v({},s),t.partialSettings);return v(v({},e),((r={})[t.endpoint]=i,r));default:return e}},actions:{setSettings:function(e,t){return{type:"SET_SETTINGS",endpoint:e,settings:t}},setPartialSettings:function(e,t){return{type:"SET_PARTIAL_SETTINGS",endpoint:e,partialSettings:t}}},selectors:{getSettings:function(e,t){return e[t]}}}),b=window.wp.apiFetch,x=n.n(b),S=function(){return S=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},S.apply(this,arguments)},P=(0,o.createContext)({settings:{},setSettings:function(){console.error("WP Parse.ly: setSettings not implemented")}}),j=function(){var e=(0,o.useContext)(P);if(void 0===e)throw new Error("useSettings must be used within a SettingsProvider");return e},k=function(e){var t=e.children,n=e.endpoint,r=e.defaultSettings,i=(0,a.useSelect)((function(e){var t=e(_).getSettings(n);return t||(t=r,(0,a.dispatch)(_).setSettings(n,r).then((function(){}))),{storedSettings:t}}),[r,n]).storedSettings,l=(0,o.useState)(i),c=l[0],u=l[1],p=(0,a.dispatch)(_).setPartialSettings,d=(0,o.useCallback)((function(e){u((function(t){return S(S({},t),e)})),p(n,e)}),[n,p]);!function(e,t,n){var r=(0,o.useRef)(!0);(0,o.useEffect)((function(){r.current?r.current=!1:x()({path:"/wp-parsely/v1/user-meta/content-helper/"+e,method:"PUT",data:t})}),n)}(n,i,[c]);var f=(0,o.useMemo)((function(){return{settings:i,setSettings:d}}),[i,d]);return(0,s.jsx)(P.Provider,{value:f,children:t})};void 0!==(0,a.select)(w)||(0,a.register)(_),function(e){e.Minutes10="10m",e.Hour="1h",e.Hours2="2h",e.Hours4="4h",e.Hours24="24h",e.Days7="7d",e.Days30="30d"}(e||(e={})),function(e){e.Views="views",e.AvgEngaged="avg_engaged"}(t||(t={})),function(e){e.Author="author",e.Section="section",e.Tag="tag",e.Unavailable="unavailable"}(r||(r={}));var T=function(e,t){return Object.values(t).includes(e)};function E(e,t){void 0===t&&(t=!1);var n=parseInt(e,10),r=e.charAt(e.length-1),s=(0,c.__)("Unknown Period","wp-parsely");switch(r){case"m":if(1===n){s=(0,c.__)("Last Minute","wp-parsely");break}s=(0,c.sprintf)(/* translators: 1: Number of minutes */(0,c._n)("Last %1$d Minute","Last %1$d Minutes",n,"wp-parsely"),n);break;case"h":if(1===n){s=(0,c.__)("Last Hour","wp-parsely");break}s=(0,c.sprintf)(/* translators: 1: Number of hours */(0,c._n)("Last %1$d Hour","Last %1$d Hours",n,"wp-parsely"),n);break;case"d":if(1===n){s=(0,c.__)("Last Day","wp-parsely");break}s=(0,c.sprintf)(/* translators: 1: Number of days */(0,c._n)("Last %1$d Day","Last %1$d Days",n,"wp-parsely"),n)}return t?s.toLocaleLowerCase():s}function C(e){switch(e){case t.Views:return(0,c.__)("Page Views","wp-parsely");case t.AvgEngaged:return(0,c.__)("Avg. Time","wp-parsely");default:return(0,c.__)("Unknown Metric","wp-parsely")}}var L=window.wp.blockEditor,O=window.wp.compose,N=window.wp.hooks,A=function(e){var t=e.text,n=void 0===t?(0,c.__)("Beta","wp-parsely"):t,r=e.color,i=void 0===r?"var(--parsely-green)":r,a=e.fontSize,l={backgroundColor:i,fontSize:void 0===a?"0.75rem":a};return(0,s.jsx)("div",{className:"wp-parsely-beta-badge",style:l,children:n})},R=function(e){void 0===e&&(e=null);var t="";(null==e?void 0:e.children)&&(t=e.children);var n="content-helper-error-message";return(null==e?void 0:e.className)&&(n+=" "+e.className),(0,s.jsx)("div",{className:n,"data-testid":null==e?void 0:e.testId,dangerouslySetInnerHTML:{__html:t}})},I=function(e){return void 0===e&&(e=null),(0,s.jsx)(R,{className:null==e?void 0:e.className,testId:"empty-credentials-message",children:window.wpParselyEmptyCredentialsMessage})},B=function(){return B=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},B.apply(this,arguments)},M=function(e,t){var n=e.children;return void 0===t&&(t=null),window.wpParselyEmptyCredentialsMessage?(0,s.jsx)(I,B({},t)):(0,s.jsx)(s.Fragment,{children:n})},V=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"m19 7.5h-7.628c-.3089-.87389-1.1423-1.5-2.122-1.5-.97966 0-1.81309.62611-2.12197 1.5h-2.12803v1.5h2.12803c.30888.87389 1.14231 1.5 2.12197 1.5.9797 0 1.8131-.62611 2.122-1.5h7.628z"}),(0,u.createElement)(p.Path,{d:"m19 15h-2.128c-.3089-.8739-1.1423-1.5-2.122-1.5s-1.8131.6261-2.122 1.5h-7.628v1.5h7.628c.3089.8739 1.1423 1.5 2.122 1.5s1.8131-.6261 2.122-1.5h2.128z"})),D=function(){return D=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},D.apply(this,arguments)},F=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,i=t.length;s<i;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},G={isLoading:!1,fullContent:!1,suggestedLinks:null,error:null,settings:{},overlayBlocks:[]},z=(0,a.createReduxStore)("wp-parsely/smart-linking",{initialState:G,reducer:function(e,t){switch(void 0===e&&(e=G),t.type){case"SET_LOADING":return D(D({},e),{isLoading:t.isLoading});case"SET_OVERLAY_BLOCKS":return D(D({},e),{overlayBlocks:t.overlayBlocks});case"SET_ERROR":return D(D({},e),{error:t.error});case"ADD_OVERLAY_BLOCK":return D(D({},e),{overlayBlocks:F(F([],e.overlayBlocks,!0),[t.block],!1)});case"REMOVE_OVERLAY_BLOCK":return"all"===t.block?D(D({},e),{overlayBlocks:[]}):D(D({},e),{overlayBlocks:e.overlayBlocks.filter((function(e){return e!==t.block}))});case"SET_FULL_CONTENT":return D(D({},e),{fullContent:t.fullContent});case"SET_SETTINGS":return D(D({},e),{settings:D(D({},e.settings),t.settings)});case"SET_SUGGESTED_LINKS":return D(D({},e),{suggestedLinks:t.suggestedLinks});default:return e}},actions:{setLoading:function(e){return{type:"SET_LOADING",isLoading:e}},setOverlayBlocks:function(e){return{type:"SET_OVERLAY_BLOCKS",overlayBlocks:e}},setError:function(e){return{type:"SET_ERROR",error:e}},addOverlayBlock:function(e){return{type:"ADD_OVERLAY_BLOCK",block:e}},removeOverlayBlock:function(e){return{type:"REMOVE_OVERLAY_BLOCK",block:e}},setFullContent:function(e){return{type:"SET_FULL_CONTENT",fullContent:e}},setSmartLinkingSettings:function(e){return{type:"SET_SETTINGS",settings:e}},setMaxLinkWords:function(e){return{type:"SET_SETTINGS",settings:{maxLinkWords:e}}},setMaxLinks:function(e){return{type:"SET_SETTINGS",settings:{maxLinksPerPost:e}}},setSettingsOpen:function(e){return{type:"SET_SETTINGS",settings:{settingsOpen:e}}},setSuggestedLinks:function(e){return{type:"SET_SUGGESTED_LINKS",suggestedLinks:e}}},selectors:{isLoading:function(e){return e.isLoading},isFullContent:function(e){return e.fullContent},getError:function(e){return e.error},getSmartLinkingSettings:function(e){return e.settings},getOverlayBlocks:function(e){return e.overlayBlocks},areSettingsOpen:function(e){var t;return null!==(t=e.settings.settingsOpen)&&void 0!==t&&t},getMaxLinkWords:function(e){var t;return null!==(t=e.settings.maxLinkWords)&&void 0!==t?t:ae},getMaxLinks:function(e){var t;return null!==(t=e.settings.maxLinksPerPost)&&void 0!==t?t:ie},getSuggestedLinks:function(e){return e.suggestedLinks}}});(0,a.register)(z);var H,U,W=function(e){var t=e.disabled,n=void 0!==t&&t,r=e.onSettingChange,l=(0,a.useSelect)((function(e){var t=e(z),n=t.getMaxLinkWords,r=t.getMaxLinks,s=t.areSettingsOpen;return{maxLinks:r(),maxLinkWords:n(),settingsOpen:s()}}),[]),o=l.maxLinks,u=l.maxLinkWords,p=l.settingsOpen,d=(0,a.useDispatch)(z),f=d.setMaxLinks,h=d.setMaxLinkWords,v=d.setSettingsOpen;return(0,s.jsxs)("div",{className:"parsely-panel-settings",children:[(0,s.jsxs)("div",{className:"parsely-panel-settings-header",children:[(0,s.jsx)(y,{size:20}),(0,s.jsx)(i.BaseControl,{id:"parsely-smart-linking-settings",className:"parsely-panel-settings-header-label",label:(0,c.__)("Smart Linking Settings","wp-parsely"),children:(0,s.jsx)(i.Button,{label:(0,c.__)("Tweak the settings of the Smart Linking","wp-parsely"),icon:V,onClick:function(){r("SmartLinkingSettingsOpen",!p),v(!p),g.trackEvent("smart_linking_ai_settings_toggled",{is_active:!p})},isPressed:p,size:"small"})})]}),p&&(0,s.jsxs)("div",{className:"parsely-panel-settings-body",children:[(0,s.jsx)(i.RangeControl,{disabled:n,value:o,initialPosition:o,onChange:function(e){f(null!=e?e:1),r("SmartLinkingMaxLinks",null!=e?e:ie)},label:(0,c.__)("Links limit","wp-parsely"),help:(0,c.__)("The maximum number of smart links to add in the content.","wp-parsely"),min:1,max:20}),(0,s.jsx)(i.RangeControl,{disabled:n,value:u,initialPosition:u,onChange:function(e){h(null!=e?e:1),r("SmartLinkingMaxLinkWords",null!=e?e:ae)},label:(0,c.__)("Link length","wp-parsely"),help:(0,c.__)("The maximum length (in words) for the smart link.","wp-parsely"),min:1,max:8})]})]})},$=window.wp.url,q=(H=function(e,t){return H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},H(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function __(){this.constructor=e}H(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)});!function(e){e.CannotFormulateApiQuery="ch_cannot_formulate_api_query",e.FetchError="fetch_error",e.HttpRequestFailed="http_request_failed",e[e.ParselyApiForbidden=403]="ParselyApiForbidden",e.ParselyApiResponseContainsError="ch_response_contains_error",e.ParselyApiReturnedNoData="ch_parsely_api_returned_no_data",e.ParselyApiReturnedTooManyResults="ch_parsely_api_returned_too_many_results",e[e.ParselyApiUnauthorized=401]="ParselyApiUnauthorized",e[e.ParselyInternalServerError=500]="ParselyInternalServerError",e[e.ParselySchemaValidationFailed=422]="ParselySchemaValidationFailed",e[e.ParselyUpstreamMalformedResponse=507]="ParselyUpstreamMalformedResponse",e[e.ParselyUpstreamNotAvailable=503]="ParselyUpstreamNotAvailable",e.PluginCredentialsNotSetMessageDetected="parsely_credentials_not_set_message_detected",e.PluginSettingsApiSecretNotSet="parsely_api_secret_not_set",e.PluginSettingsSiteIdNotSet="parsely_site_id_not_set",e.PostIsNotPublished="ch_post_not_published"}(U||(U={}));var Z=function(e){function t(n,r,s){void 0===s&&(s=(0,c.__)("Error: ","wp-parsely"));var i=e.call(this,s+n)||this;i.hint=null,i.name=i.constructor.name,i.code=r;var a=[U.ParselyApiForbidden,U.ParselyApiResponseContainsError,U.ParselyApiReturnedNoData,U.ParselyApiReturnedTooManyResults,U.ParselyApiUnauthorized,U.PluginCredentialsNotSetMessageDetected,U.PluginSettingsApiSecretNotSet,U.PluginSettingsSiteIdNotSet,U.PostIsNotPublished];return i.retryFetch=!a.includes(i.code),Object.setPrototypeOf(i,t.prototype),i.code===U.ParselyApiUnauthorized?i.message=(0,c.__)("This feature is accessible to select customers participating in its beta testing.","wp-parsely"):i.code===U.ParselyInternalServerError?i.message=(0,c.__)("The Parse.ly API returned an internal server error. Please try again later.","wp-parsely"):i.code===U.HttpRequestFailed&&i.message.includes("cURL error 28")?i.message=(0,c.__)("The Parse.ly API did not respond in a timely manner. Please try again later.","wp-parsely"):i.code===U.ParselySchemaValidationFailed?i.message=(0,c.__)("The Parse.ly API returned a validation error. Please try again later.","wp-parsely"):i.code===U.ParselyUpstreamMalformedResponse&&i.message.includes("Insufficient Storage")?i.message=(0,c.__)("The Parse.ly API couldn't find any relevant data to fulfill the request. Please retry with a different input.","wp-parsely"):i.code===U.ParselyUpstreamMalformedResponse?i.message=(0,c.__)("The Parse.ly API returned a malformed response. Please try again later.","wp-parsely"):i.code===U.ParselyUpstreamNotAvailable&&(i.message=(0,c.__)("The Parse.ly API is currently unavailable. Please try again later.","wp-parsely")),i}return q(t,e),t.prototype.Message=function(e){return void 0===e&&(e=null),[U.PluginCredentialsNotSetMessageDetected,U.PluginSettingsSiteIdNotSet,U.PluginSettingsApiSecretNotSet].includes(this.code)?I(e):(this.code===U.FetchError&&(this.hint=this.Hint((0,c.__)("This error can sometimes be caused by ad-blockers or browser tracking protections. Please add this site to any applicable allow lists and try again.","wp-parsely"))),this.code===U.ParselyApiForbidden&&(this.hint=this.Hint((0,c.__)("Please ensure that the Site ID and API Secret given in the plugin's settings are correct.","wp-parsely"))),this.code===U.HttpRequestFailed&&(this.hint=this.Hint((0,c.__)("The Parse.ly API cannot be reached. Please verify that you are online.","wp-parsely"))),(0,s.jsx)(R,{className:null==e?void 0:e.className,testId:"error",children:"<p>".concat(this.message,"</p>").concat(this.hint?this.hint:"")}))},t.prototype.Hint=function(e){return'<p className="content-helper-error-message-hint" data-testid="content-helper-error-message-hint"><strong>'.concat((0,c.__)("Hint:","wp-parsely"),"</strong> ").concat(e,"</p>")},t}(Error),K=function(){function e(){}return e.generateSmartLinks=function(e,t,n){var r,s,i,a,l;return void 0===t&&(t=ae),void 0===n&&(n=ie),s=this,i=void 0,l=function(){var s,i;return function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(o){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&l[0]?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){a.label=l[1];break}if(6===l[0]&&a.label<s[1]){a.label=s[1],s=l;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(l);break}s[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,o])}}}(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,x()({method:"POST",path:(0,$.addQueryArgs)("/wp-parsely/v1/content-suggestions/suggest-linked-reference",{max_link_words:t,max_links:n}),data:{content:e}})];case 1:return s=a.sent(),[3,3];case 2:return i=a.sent(),[2,Promise.reject(new Z(i.message,i.code))];case 3:return(null==s?void 0:s.error)?[2,Promise.reject(new Z(s.error.message,U.ParselyApiResponseContainsError))]:[2,null!==(r=s.data)&&void 0!==r?r:[]]}}))},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{o(l.next(e))}catch(e){t(e)}}function r(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(n,r)}o((l=l.apply(s,i||[])).next())}))},e}();function Y(e,t,n,r){for(var s,i=0,a=new RegExp(t.source,"g"+(t.ignoreCase?"i":"")+(t.multiline?"m":""));null!==(s=a.exec(e));){if(i===r)return e.substring(0,s.index)+n+e.substring(a.lastIndex);i++}return e}var Q,X=function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{o(r.next(e))}catch(e){i(e)}}function l(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}o((r=r.apply(e,t||[])).next())}))},J=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(o){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&l[0]?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){a.label=l[1];break}if(6===l[0]&&a.label<s[1]){a.label=s[1],s=l;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(l);break}s[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,o])}}};!function(e){e.Unknown="unknown",e.ContentHelperSidebar="content_helper_sidebar",e.BlockInspector="block_inspector"}(Q||(Q={}));var ee=function(e){var t=e.className,n=e.selectedBlockClientId,r=e.context,l=void 0===r?Q.Unknown:r,u=j(),p=u.settings,d=u.setSettings,f=(0,o.useState)(null),h=f[0],y=f[1],v=(0,a.useSelect)((function(e){var t=e(z),n=t.isLoading,r=t.getOverlayBlocks,s=t.getSuggestedLinks,i=t.getError,a=t.isFullContent,l=t.getMaxLinks,o=t.getMaxLinkWords,c=t.getSmartLinkingSettings;return{loading:n(),error:i(),maxLinks:l(),maxLinkWords:o(),fullContent:a(),overlayBlocks:r(),suggestedLinks:s(),smartLinkingSettings:c()}}),[]),m=v.loading,w=v.fullContent,_=v.overlayBlocks,b=v.error,x=v.suggestedLinks,S=v.maxLinks,P=v.maxLinkWords,k=v.smartLinkingSettings,T=(0,a.useDispatch)(z),E=T.setLoading,C=T.setFullContent,L=T.setError,O=T.setSuggestedLinks,N=T.addOverlayBlock,A=T.removeOverlayBlock,R=T.setSmartLinkingSettings;(0,o.useEffect)((function(){if(!(Object.keys(k).length>0)){var e={maxLinksPerPost:p.SmartLinkingMaxLinks,maxLinkWords:p.SmartLinkingMaxLinkWords,settingsOpen:p.SmartLinkingSettingsOpen};R(e)}}),[R,p]);var I=(0,a.useSelect)((function(e){var t=e("core/block-editor"),r=t.getSelectedBlock,s=t.getBlock,i=e("core/editor").getEditedPostContent;return{selectedBlock:n?s(n):r(),postContent:i()}}),[n]),B=I.selectedBlock,M=I.postContent;(0,o.useEffect)((function(){y(null)}),[B]);var V=function(e){return void 0===e&&(e="all"),X(void 0,void 0,void 0,(function(){var t;return J(this,(function(n){switch(n.label){case 0:return[4,A(e)];case 1:return n.sent(),l===Q.BlockInspector&&("all"===e||w?(t=(0,a.select)("core/block-editor").getBlockOrder()[0],(0,a.dispatch)("core/block-editor").selectBlock(t)):(0,a.dispatch)("core/block-editor").selectBlock(e)),0===_.length&&F(),[2]}}))}))},D=function(){(0,a.dispatch)("core/editor").lockPostSaving("wp-parsely-block-overlay"),document.querySelectorAll('.edit-post-header__settings>[type="button"]').forEach((function(e){e.setAttribute("disabled","disabled")}))},F=function(){document.querySelectorAll('.edit-post-header__settings>[type="button"]').forEach((function(e){e.removeAttribute("disabled")})),(0,a.dispatch)("core/editor").unlockPostSaving("wp-parsely-block-overlay")};return(0,s.jsx)("div",{className:"wp-parsely-smart-linking",children:(0,s.jsxs)(i.PanelRow,{className:t,children:[(0,s.jsxs)("div",{className:"wp-parsely-smart-linking-text",children:[(0,c.__)("Automatically insert links to your most relevant, top performing content.","wp-parsely")," ",(0,s.jsx)("a",{href:"https://docs.parse.ly/plugin-content-helper/#h-smart-linking-beta",children:(0,c.__)("Learn how Smart Linking works.","wp-parsely")})]}),b&&(0,s.jsx)(i.Notice,{status:"info",isDismissible:!1,className:"wp-parsely-content-helper-error",children:b.message}),null!==x&&(0,s.jsx)(i.Notice,{status:"success",isDismissible:!1,className:"wp-parsely-smart-linking-suggested-links",children:/* translators: 1 - number of smart links generated */
(0,c.sprintf)((0,c.__)("Successfully added %s smart links.","wp-parsely"),x.length)}),(0,s.jsx)(W,{disabled:m,onSettingChange:function(e,t){var n,r;d(((n={})[e]=t,n)),R(((r={})[e]=t,r))}}),(0,s.jsxs)("div",{className:"wp-parsely-smart-linking-generate",children:[(0,s.jsx)(i.Button,{onClick:function(){return X(void 0,void 0,void 0,(function(){var e,t,n,r,s;return J(this,(function(i){switch(i.label){case 0:return[4,E(!0)];case 1:return i.sent(),[4,O(null)];case 2:return i.sent(),[4,L(null)];case 3:return i.sent(),g.trackEvent("smart_linking_generate_pressed",{is_full_content:w,selected_block:null!==(s=null==B?void 0:B.name)&&void 0!==s?s:"none",context:l}),[4,(o=w?"all":null==B?void 0:B.clientId,void 0===o&&(o="all"),X(void 0,void 0,void 0,(function(){return J(this,(function(e){switch(e.label){case 0:return[4,N(o)];case 1:return e.sent(),D(),[2]}}))})))];case 4:i.sent(),e=setTimeout((function(){var e;E(!1),g.trackEvent("smart_linking_generate_timeout",{is_full_content:w,selected_block:null!==(e=null==B?void 0:B.name)&&void 0!==e?e:"none",context:l}),V(w?"all":null==B?void 0:B.clientId)}),6e4),i.label=5;case 5:return i.trys.push([5,11,12,15]),t=w||!B,n=[],!(null==B?void 0:B.originalContent)||t?[3,7]:[4,K.generateSmartLinks(null==B?void 0:B.originalContent,P,S)];case 6:return n=i.sent(),[3,9];case 7:return[4,K.generateSmartLinks(M,P,S)];case 8:n=i.sent(),i.label=9;case 9:return[4,O(n)];case 10:return i.sent(),function(e){var t;g.trackEvent("smart_linking_applied",{is_full_content:w,selected_block:null!==(t=null==B?void 0:B.name)&&void 0!==t?t:"none",links_count:e.length,context:l});for(var n="",r=n=B&&!w?B.attributes.content:M,s=0,i=e;s<i.length;s++){var o=i[s];if(!n.includes(o.title)||!n.includes(o.href)){o.text=o.text.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");var c=new RegExp(o.text,"g"),u=r.match(c),p=n.match(c);u&&p&&(null==u?void 0:u.length)>(null==p?void 0:p.length)&&o.offset++;var d='<a href="'.concat(o.href,'" title="').concat(o.title,'">').concat(o.text,"</a>");r=Y(r,new RegExp("(".concat(o.text,"|<a[^>]*>").concat(o.text,"</a>)")),d,o.offset)}}B&&!w?(0,a.dispatch)("core/block-editor").updateBlockAttributes(B.clientId,{content:r}):(0,a.dispatch)("core/editor").editPost({content:r})}(n),[3,15];case 11:return r=i.sent(),L(r),[3,15];case 12:return[4,E(!1)];case 13:return i.sent(),[4,V(w?"all":null==B?void 0:B.clientId)];case 14:return i.sent(),clearTimeout(e),[7];case 15:return[2]}var o}))}))},variant:"primary",isBusy:m,disabled:m,children:m?(0,c.__)("Generating…","wp-parsely"):(0,c.__)("Add Smart Links","wp-parsely")}),h&&(0,s.jsxs)(i.Notice,{status:"warning",isDismissible:!0,onRemove:function(){return y(null)},className:"wp-parsely-smart-linking-hint",children:[(0,s.jsx)("strong",{children:(0,c.__)("Hint:","wp-parsely")})," ",h]}),(0,s.jsx)(i.Disabled,{isDisabled:m,children:(0,s.jsx)(i.CheckboxControl,{checked:!B||w,disabled:m,onClick:function(){B||y((0,c.__)("If you want to target a specific block, you should select it on the block editor.","wp-parsely"))},onChange:B?C:function(){},label:(0,c.__)("Add smart links for the entire post","wp-parsely")})})]})]})})},te=function(){return te=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},te.apply(this,arguments)},ne=function(e){var t=e.selectedBlockClientId,n=e.label,r=(0,o.useState)(document.createElement("div"))[0];return r.className="wp-parsely-block-overlay","all"===t&&(r.className+=" full-content-overlay"),r.onclick=function(e){e.stopPropagation(),e.stopImmediatePropagation(),"all"!==t&&((0,a.dispatch)("core/block-editor").selectBlock(t,-1),r.ownerDocument.activeElement.blur())},(0,o.useEffect)((function(){if(t){if("all"===t){var e=document.querySelector(".interface-navigable-region.interface-interface-skeleton__content");return null==e||e.appendChild(r),null==e||e.setAttribute("style","overflow: hidden"),r.style.top=(null==e?void 0:e.scrollTop)+"px",function(){(null==e?void 0:e.contains(r))&&e.removeChild(r),null==e||e.setAttribute("style",""),r.style.top=""}}var n=document.querySelector('[data-block="'.concat(t,'"]'));return null==n||n.setAttribute("contenteditable","false"),null==n||n.setAttribute("aria-disabled","true"),null==n||n.appendChild(r),function(){null==n||n.setAttribute("contenteditable","true"),null==n||n.removeAttribute("aria-disabled"),(null==n?void 0:n.contains(r))&&n.removeChild(r)}}})),(0,o.createPortal)((0,s.jsxs)("div",{className:"wp-parsely-block-overlay-label",children:[(0,s.jsx)(i.Spinner,{}),(0,s.jsx)("span",{children:n})]}),r)},re=(0,O.createHigherOrderComponent)((function(e){return function(t){return(0,a.useSelect)((function(e){return{overlayBlocks:(0,e(z).getOverlayBlocks)()}}),[]).overlayBlocks.includes(t.clientId)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ne,{label:(0,c.__)("Generating Smart Links…","wp-parsely"),selectedBlockClientId:t.clientId}),(0,s.jsx)(e,te({},t))]}):(0,s.jsx)(e,te({},t))}}),"withBlockOverlay"),se=function(){return se=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},se.apply(this,arguments)},ie=10,ae=4,le=(0,O.createHigherOrderComponent)((function(e){return function(t){return t.isSelected&&"core/paragraph"===t.name?(0,s.jsx)(k,{endpoint:"editor-sidebar-settings",defaultSettings:Kt(),children:(0,s.jsx)(e,se({},t))}):(0,s.jsx)(e,se({},t))}}),"withSettingsProvider"),oe=(0,O.createHigherOrderComponent)((function(e){return function(t){if(!t.isSelected||"core/paragraph"!==t.name)return(0,s.jsx)(e,se({},t));var n=j(),r=n.settings,a=n.setSettings;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e,se({},t)),(0,s.jsx)(L.InspectorControls,{group:"list",children:(0,s.jsx)(i.PanelBody,{title:"Smart Linking",initialOpen:r.SmartLinkingOpen,className:"wp-parsely-panel wp-parsely-smart-linking-panel",icon:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y,{})," ",(0,s.jsx)(A,{})]}),onToggle:function(e){a({SmartLinkingOpen:e}),g.trackEvent("smart_linking_block_inspector_panel_toggled",{open:e})},children:(0,s.jsx)(M,{children:(0,s.jsx)(ee,{selectedBlockClientId:t.clientId,context:Q.BlockInspector})})})})]})}}),"withSmartLinkingPanel"),ce=(0,O.compose)(le,oe),ue=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M16.7 7.1l-6.3 8.5-3.3-2.5-.9 1.2 4.5 3.4L17.9 8z"})),pe=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M7 11.5h10V13H7z"})),de=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M13 19h-2v-2h2v2zm0-6h-2v-2h2v2zm0-6h-2V5h2v2z"})),fe=function(e){var t=e.title,n=e.icon,r=e.subtitle,a=e.level,l=void 0===a?2:a,o=e.children,c=e.controls,u=e.onClick,p=e.isOpen,d=e.isLoading,f=e.dropdownChildren;return(0,s.jsxs)("div",{className:"performance-stat-panel",children:[(0,s.jsxs)(i.__experimentalHStack,{className:"panel-header level-"+l,children:[(0,s.jsx)(i.__experimentalHeading,{level:l,children:t}),r&&!p&&(0,s.jsx)("span",{className:"panel-subtitle",children:r}),c&&!f&&(0,s.jsx)(i.DropdownMenu,{icon:n,label:"Select a direction",toggleProps:{isSmall:!0},controls:c}),f&&(0,s.jsx)(i.DropdownMenu,{icon:n,label:"Select a direction",toggleProps:{isSmall:!0},children:f}),n&&!f&&!c&&(0,s.jsx)(i.Button,{icon:n,isSmall:!0,isPressed:p,onClick:u})]}),(0,s.jsx)("div",{className:"panel-body",children:d?(0,s.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,s.jsx)(i.Spinner,{})}):o})]})};function ge(e,t,n){void 0===t&&(t=1),void 0===n&&(n="");var r=parseInt(e.replace(/\D/g,""),10);if(r<1e3)return e;r<1e4&&(t=1);var s=r,i=r.toString(),a="",l=0;return Object.entries({1e3:"k","1,000,000":"M","1,000,000,000":"B","1,000,000,000,000":"T","1,000,000,000,000,000":"Q"}).forEach((function(e){var n=e[0],o=e[1],c=parseInt(n.replace(/\D/g,""),10);if(r>=c){var u=t;(s=r/c)%1>1/l&&(u=s>10?1:2),u=parseFloat(s.toFixed(2))===parseFloat(s.toFixed(0))?0:u,i=s.toFixed(u),a=o}l=c})),i+n+a}var he=function(e){var n=e.data,r=e.isLoading,a=(0,o.useState)(t.Views),l=a[0],u=a[1],p=(0,o.useState)(!1),d=p[0],f=p[1];r||delete n.referrers.types.totals;var g=function(e){switch(e){case"social":return(0,c.__)("Social","wp-parsely");case"search":return(0,c.__)("Search","wp-parsely");case"other":return(0,c.__)("Other","wp-parsely");case"internal":return(0,c.__)("Internal","wp-parsely");case"direct":return(0,c.__)("Direct","wp-parsely")}return e},h=(0,c.sprintf)((0,c.__)("By %s","wp-parsely"),C(l));
/* translators: %s: metric description */return(0,s.jsxs)(fe,{title:(0,c.__)("Categories","wp-parsely"),level:3,subtitle:h,isOpen:d,onClick:function(){return f(!d)},children:[d&&(0,s.jsx)("div",{className:"panel-settings",children:(0,s.jsx)(i.SelectControl,{value:l,prefix:(0,c.__)("By: ","wp-parsely"),onChange:function(e){T(e,t)&&u(e)},children:Object.values(t).map((function(e){return(0,s.jsxs)("option",{value:e,disabled:"avg_engaged"===e,children:[C(e),"avg_engaged"===e&&(0,c.__)(" (coming soon)","wp-parsely")]},e)}))})}),r?(0,s.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,s.jsx)(i.Spinner,{})}):(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"multi-percentage-bar",children:Object.entries(n.referrers.types).map((function(e){var t=e[0],n=e[1],r=(0,c.sprintf)(/* translators: 1: Referrer type, 2: Percentage value, %%: Escaped percent sign */
(0,c.__)("%1$s: %2$s%%","wp-parsely"),g(t),n.viewsPercentage);return(0,s.jsx)(i.Tooltip
/* translators: %s: percentage value */,{
/* translators: %s: percentage value */
text:"".concat(g(t)," - ").concat((0,c.sprintf)((0,c.__)("%s%%","wp-parsely"),n.viewsPercentage)),delay:150,children:(0,s.jsx)("div",{"aria-label":r,className:"bar-fill "+t,style:{width:n.viewsPercentage+"%"}})},t)}))}),(0,s.jsx)("div",{className:"percentage-bar-labels",children:Object.entries(n.referrers.types).map((function(e){var t=e[0],n=e[1];return(0,s.jsxs)("div",{className:"single-label "+t,children:[(0,s.jsx)("div",{className:"label-color "+t}),(0,s.jsx)("div",{className:"label-text",children:g(t)}),(0,s.jsx)("div",{className:"label-value",children:ge(n.views)})]},t)}))})]})]})},ye=(0,u.createElement)(p.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,u.createElement)(p.Path,{d:"M3.99961 13C4.67043 13.3354 4.6703 13.3357 4.67017 13.3359L4.67298 13.3305C4.67621 13.3242 4.68184 13.3135 4.68988 13.2985C4.70595 13.2686 4.7316 13.2218 4.76695 13.1608C4.8377 13.0385 4.94692 12.8592 5.09541 12.6419C5.39312 12.2062 5.84436 11.624 6.45435 11.0431C7.67308 9.88241 9.49719 8.75 11.9996 8.75C14.502 8.75 16.3261 9.88241 17.5449 11.0431C18.1549 11.624 18.6061 12.2062 18.9038 12.6419C19.0523 12.8592 19.1615 13.0385 19.2323 13.1608C19.2676 13.2218 19.2933 13.2686 19.3093 13.2985C19.3174 13.3135 19.323 13.3242 19.3262 13.3305L19.3291 13.3359C19.3289 13.3357 19.3288 13.3354 19.9996 13C20.6704 12.6646 20.6703 12.6643 20.6701 12.664L20.6697 12.6632L20.6688 12.6614L20.6662 12.6563L20.6583 12.6408C20.6517 12.6282 20.6427 12.6108 20.631 12.5892C20.6078 12.5459 20.5744 12.4852 20.5306 12.4096C20.4432 12.2584 20.3141 12.0471 20.1423 11.7956C19.7994 11.2938 19.2819 10.626 18.5794 9.9569C17.1731 8.61759 14.9972 7.25 11.9996 7.25C9.00203 7.25 6.82614 8.61759 5.41987 9.9569C4.71736 10.626 4.19984 11.2938 3.85694 11.7956C3.68511 12.0471 3.55605 12.2584 3.4686 12.4096C3.42484 12.4852 3.39142 12.5459 3.36818 12.5892C3.35656 12.6108 3.34748 12.6282 3.34092 12.6408L3.33297 12.6563L3.33041 12.6614L3.32948 12.6632L3.32911 12.664C3.32894 12.6643 3.32879 12.6646 3.99961 13ZM11.9996 16C13.9326 16 15.4996 14.433 15.4996 12.5C15.4996 10.567 13.9326 9 11.9996 9C10.0666 9 8.49961 10.567 8.49961 12.5C8.49961 14.433 10.0666 16 11.9996 16Z"})),ve=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M15.5 9.5a1 1 0 100-2 1 1 0 000 2zm0 1.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm-2.25 6v-2a2.75 2.75 0 00-2.75-2.75h-4A2.75 2.75 0 003.75 15v2h1.5v-2c0-.69.56-1.25 1.25-1.25h4c.69 0 1.25.56 1.25 1.25v2h1.5zm7-2v2h-1.5v-2c0-.69-.56-1.25-1.25-1.25H15v-1.5h2.5A2.75 2.75 0 0120.25 15zM9.5 8.5a1 1 0 11-2 0 1 1 0 012 0zm1.5 0a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z",fillRule:"evenodd"})),me=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M12 4V2.2L9 4.8l3 2.5V5.5c3.6 0 6.5 2.9 6.5 6.5 0 2.9-1.9 5.3-4.5 6.2v.2l-.1-.2c-.4.1-.7.2-1.1.2l.2 1.5c.3 0 .6-.1 1-.2 3.5-.9 6-4 6-7.7 0-4.4-3.6-8-8-8zm-7.9 7l1.5.2c.1-1.2.5-2.3 1.2-3.2l-1.1-.9C4.8 8.2 4.3 9.6 4.1 11zm1.5 1.8l-1.5.2c.1.7.3 1.4.5 2 .3.7.6 1.3 1 1.8l1.2-.8c-.3-.5-.6-1-.8-1.5s-.4-1.1-.4-1.7zm1.5 5.5c1.1.9 2.4 1.4 3.8 1.6l.2-1.5c-1.1-.1-2.2-.5-3.1-1.2l-.9 1.1z"})),we=(0,o.forwardRef)((function({icon:e,size:t=24,...n},r){return(0,o.cloneElement)(e,{width:t,height:t,...n,ref:r})})),_e=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M11 13h2v-2h-2v2zm-6 0h2v-2H5v2zm12-2v2h2v-2h-2z"})),be=function(){return be=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},be.apply(this,arguments)},xe=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,i=t.length;s<i;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},Se=[{name:"views",title:(0,c.__)("Page Views","wp-parsely"),icon:ye},{name:"visitors",title:(0,c.__)("Visitors","wp-parsely"),icon:ve},{name:"avgEngaged",title:(0,c.__)("Avg. Engaged","wp-parsely"),icon:(0,s.jsx)((function(){return(0,s.jsxs)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)(i.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 19.5C16.1421 19.5 19.5 16.1421 19.5 12C19.5 7.85786 16.1421 4.5 12 4.5C7.85786 4.5 4.5 7.85786 4.5 12C4.5 16.1421 7.85786 19.5 12 19.5ZM12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z",fill:"#1E1E1E"}),(0,s.jsx)(i.Path,{d:"M11 12L12 7L13 12H11Z",fill:"#1E1E1E"}),(0,s.jsx)(i.Path,{d:"M12 13C12.5523 13 13 12.5523 13 12H11C11 12.5523 11.4477 13 12 13Z",fill:"#1E1E1E"}),(0,s.jsx)(i.Path,{d:"M12.8144 11.3845L15.6429 15.6271L11.4002 12.7987L12.8144 11.3845Z",fill:"#1E1E1E"})]})}),{})},{name:"recirculation",title:(0,c.__)("Recirculation","wp-parsely"),icon:me,smallText:!0}],Pe=function(e,t){return e.PerformanceStatsSettings.VisibleDataPoints.includes(t)},je=function(e){var t=e.title,n=e.value,r=e.icon,i=e.smallText,a=e.isVisible;return void 0===a||a?(0,s.jsxs)("div",{className:"data-point",children:[(0,s.jsx)(we,{size:24,icon:r}),(0,s.jsx)("span",{className:"data-point-title",children:t}),(0,s.jsx)("span",{className:"data-point-value"+(i?" is-small":""),children:n})]}):null},ke=function(e){var t=e.dataPoints;return(0,s.jsx)("div",{className:"performance-data-points",children:t.map((function(e){var t=e.title,n=e.value,r=e.icon,i=e.smallText,a=e.isVisible;return(0,s.jsx)(je,{title:t,value:n,icon:r,smallText:i,isVisible:a},t)}))})},Te=function(e){var t=e.onClose,n=j(),r=n.settings,a=n.setSettings;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.MenuGroup,{label:(0,c.__)("Performance Stats","wp-parsely"),children:Se.map((function(e){return(0,s.jsxs)(i.MenuItem,{icon:Pe(r,e.name)?ue:pe,onClick:function(){return n=e.name,Pe(r,s=n)?(a({PerformanceStatsSettings:be(be({},r.PerformanceStatsSettings),{VisibleDataPoints:r.PerformanceStatsSettings.VisibleDataPoints.filter((function(e){return e!==s}))})}),g.trackEvent("editor_sidebar_performance_datapoint_hidden",{dataPoint:s})):(a({PerformanceStatsSettings:be(be({},r.PerformanceStatsSettings),{VisibleDataPoints:xe(xe([],r.PerformanceStatsSettings.VisibleDataPoints,!0),[s],!1)})}),g.trackEvent("editor_sidebar_performance_datapoint_shown",{dataPoint:s})),void t();var n,s},children:[(0,s.jsx)(we,{icon:e.icon}),e.title]},e.name)}))}),(0,s.jsx)(i.MenuGroup,{children:(0,s.jsx)(i.MenuItem,{onClick:function(){a({PerformanceStatsSettings:be(be({},r.PerformanceStatsSettings),{VisibleDataPoints:["views","visitors","avgEngaged","recirculation"]})}),g.trackEvent("editor_sidebar_performance_datapoints_reset"),t()},children:(0,c.__)("Reset all","wp-parsely")})})]})},Ee=function(e){var t=e.data,n=e.isLoading,r=void 0!==n&&n,a=j().settings,l=[];return r||(l=Se.map((function(e){var n;switch(e.name){case"views":n=ge(t.views);break;case"visitors":n=ge(t.visitors);break;case"avgEngaged":n=t.avgEngaged;break;default:n=(0,c.__)("Coming soon!","wp-parsely")}return be(be({},e),{value:n,isVisible:Pe(a,e.name)})}))),(0,s.jsx)(fe,{title:(0,c.__)("Overview","wp-parsely"),level:3,icon:_e,dropdownChildren:function(e){var t=e.onClose;return(0,s.jsx)(Te,{onClose:t})},children:r?(0,s.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,s.jsx)(i.Spinner,{})}):(0,s.jsx)(ke,{dataPoints:l})})},Ce=function(e){var n=e.data,r=e.isLoading,a=(0,o.useState)(t.Views),l=a[0],u=a[1],p=(0,o.useState)(!1),d=p[0],f=p[1],g=(0,c.sprintf)((0,c.__)("By %s","wp-parsely"),C(l));return(0,s.jsxs)(fe,{title:(0,c.__)("Referrers","wp-parsely"),subtitle:g,level:3,isOpen:d,onClick:function(){return f(!d)},children:[d&&(0,s.jsx)("div",{className:"panel-settings",children:(0,s.jsx)(i.SelectControl,{value:l,prefix:(0,c.__)("By: ","wp-parsely"),onChange:function(e){T(e,t)&&u(e)},children:Object.values(t).map((function(e){return(0,s.jsxs)("option",{value:e,disabled:"avg_engaged"===e,children:[C(e),"avg_engaged"===e&&(0,c.__)(" (coming soon)","wp-parsely")]},e)}))})}),r?(0,s.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,s.jsx)(i.Spinner,{})}):(0,s.jsx)("div",{className:"referrers-list",children:Object.entries(n.referrers.top).map((function(e){var t=e[0],n=e[1];if("totals"===t)return null;var r=t;"direct"===t&&(r=(0,c.__)("Direct","wp-parsely"))
/* translators: %s: Percentage value, %%: Escaped percent sign */;var i=(0,c.sprintf)((0,c.__)("%s%%","wp-parsely"),n.viewsPercentage);return(0,s.jsxs)("div",{className:"referrers-row",children:[(0,s.jsx)("div",{className:"referrers-row-title",children:(0,s.jsx)("span",{children:r})}),(0,s.jsx)("div",{className:"referrers-row-bar",children:(0,s.jsx)("div",{"aria-label":i,className:"percentage-bar",style:{"--bar-fill":n.viewsPercentage+"%"}})}),(0,s.jsx)("div",{className:"referrers-row-value",children:(0,s.jsx)("span",{children:n.views})})]},t)}))})]})},Le={month:"short",day:"numeric",year:"numeric"},Oe={month:"short",day:"numeric"},Ne=(0,c.__)("Date N/A","wp-parsely");function Ae(e){if(!1===function(e){return!isNaN(+e)&&0!==e.getTime()}(e))return Ne;var t=Le;return e.getUTCFullYear()===(new Date).getUTCFullYear()&&(t=Oe),Intl.DateTimeFormat(document.documentElement.lang||"en",t).format(e)}function Re(e){return{period_start:e,period_end:""}}var Ie=function(){return Ie=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},Ie.apply(this,arguments)},Be=function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{o(r.next(e))}catch(e){i(e)}}function l(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}o((r=r.apply(e,t||[])).next())}))},Me=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(o){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&l[0]?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){a.label=l[1];break}if(6===l[0]&&a.label<s[1]){a.label=s[1],s=l;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(l);break}s[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,o])}}},Ve=function(){function e(){this.itmSource="wp-parsely-content-helper"}return e.prototype.getPerformanceDetails=function(e){return Be(this,void 0,void 0,(function(){var t,n,r,s,i;return Me(this,(function(l){switch(l.label){case 0:if(!1===(t=(0,a.select)("core/editor")).isCurrentPostPublished())return[2,Promise.reject(new Z((0,c.__)("This post is not published, so its details are unavailable.","wp-parsely"),U.PostIsNotPublished,""))];if(null===(n=t.getPermalink()))return[2,Promise.reject(new Z((0,c.__)("The post's URL returned null.","wp-parsely"),U.PostIsNotPublished))];l.label=1;case 1:return l.trys.push([1,4,,5]),[4,this.fetchPerformanceDataFromWpEndpoint(e,n)];case 2:return r=l.sent(),[4,this.fetchReferrerDataFromWpEndpoint(e,n,r.views)];case 3:return s=l.sent(),[3,5];case 4:return i=l.sent(),[2,Promise.reject(i)];case 5:return[2,Ie(Ie({},r),{referrers:s})]}}))}))},e.prototype.fetchPerformanceDataFromWpEndpoint=function(e,t){return Be(this,void 0,void 0,(function(){var n,r;return Me(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,x()({path:(0,$.addQueryArgs)("/wp-parsely/v1/stats/post/detail",Ie(Ie({},Re(e)),{itm_source:this.itmSource,url:t}))})];case 1:return n=s.sent(),[3,3];case 2:return r=s.sent(),[2,Promise.reject(new Z(r.message,r.code))];case 3:return(null==n?void 0:n.error)?[2,Promise.reject(new Z(n.error.message,U.ParselyApiResponseContainsError))]:0===n.data.length?[2,Promise.reject(new Z((0,c.sprintf)(/* translators: URL of the published post */
(0,c.__)("The post %s has 0 views, or the Parse.ly API returned no data.","wp-parsely"),t),U.ParselyApiReturnedNoData,""))]:n.data.length>1?[2,Promise.reject(new Z((0,c.sprintf)(/* translators: URL of the published post */
(0,c.__)("Multiple results were returned for the post %s by the Parse.ly API.","wp-parsely"),t),U.ParselyApiReturnedTooManyResults))]:[2,n.data[0]]}}))}))},e.prototype.fetchReferrerDataFromWpEndpoint=function(e,t,n){return Be(this,void 0,void 0,(function(){var r,s;return Me(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,x()({path:(0,$.addQueryArgs)("/wp-parsely/v1/referrers/post/detail",Ie(Ie({},Re(e)),{itm_source:this.itmSource,total_views:n,url:t}))})];case 1:return r=i.sent(),[3,3];case 2:return s=i.sent(),[2,Promise.reject(new Z(s.message,s.code))];case 3:return(null==r?void 0:r.error)?[2,Promise.reject(new Z(r.error.message,U.ParselyApiResponseContainsError))]:[2,r.data]}}))}))},e}(),De=function(){return De=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},De.apply(this,arguments)},Fe=function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{o(r.next(e))}catch(e){i(e)}}function l(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}o((r=r.apply(e,t||[])).next())}))},Ge=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(o){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&l[0]?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){a.label=l[1];break}if(6===l[0]&&a.label<s[1]){a.label=s[1],s=l;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(l);break}s[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,o])}}},ze=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,i=t.length;s<i;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},He=[{name:"overview",label:(0,c.__)("Overview","wp-parsely")},{name:"categories",label:(0,c.__)("Referrer Categories","wp-parsely")},{name:"referrers",label:(0,c.__)("Referrers","wp-parsely")}],Ue=function(e,t){return e.PerformanceStatsSettings.VisiblePanels.includes(t)},We=function(e){var t=e.onClose,n=j(),r=n.settings,a=n.setSettings;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.MenuGroup,{label:(0,c.__)("Performance Stats","wp-parsely"),children:He.map((function(e){return(0,s.jsx)(i.MenuItem,{disabled:e.forced,icon:Ue(r,e.name)?ue:pe,onClick:function(){return function(e){var t;(null===(t=He.find((function(t){return t.name===e})))||void 0===t?void 0:t.forced)||(Ue(r,e)?(a({PerformanceStatsSettings:De(De({},r.PerformanceStatsSettings),{VisiblePanels:r.PerformanceStatsSettings.VisiblePanels.filter((function(t){return t!==e}))})}),g.trackEvent("editor_sidebar_performance_panel_closed",{panel:e})):(a({PerformanceStatsSettings:De(De({},r.PerformanceStatsSettings),{VisiblePanels:ze(ze([],r.PerformanceStatsSettings.VisiblePanels,!0),[e],!1)})}),g.trackEvent("editor_sidebar_performance_panel_opened",{panel:e})))}(e.name),void t()},children:e.label},e.name)}))}),(0,s.jsx)(i.MenuGroup,{children:(0,s.jsx)(i.MenuItem,{onClick:function(){a({PerformanceStatsSettings:De(De({},r.PerformanceStatsSettings),{VisiblePanels:He.map((function(e){return e.name}))})}),g.trackEvent("editor_sidebar_performance_panel_reset"),t()},children:(0,c.__)("Reset all","wp-parsely")})})]})},$e=function(t){var n=t.period,r=(0,o.useState)(!0),a=r[0],l=r[1],u=(0,o.useState)(),p=u[0],d=u[1],f=(0,o.useState)(),h=f[0],y=f[1],v=j(),m=v.settings,w=v.setSettings;return(0,o.useEffect)((function(){var e=new Ve,t=function(r){return Fe(void 0,void 0,void 0,(function(){return Ge(this,(function(s){return e.getPerformanceDetails(n).then((function(e){y(e),l(!1)})).catch((function(e){return Fe(void 0,void 0,void 0,(function(){return Ge(this,(function(n){switch(n.label){case 0:return r>0&&e.retryFetch?[4,new Promise((function(e){return setTimeout(e,500)}))]:[3,3];case 1:return n.sent(),[4,t(r-1)];case 2:return n.sent(),[3,4];case 3:d(e),l(!1),n.label=4;case 4:return[2]}}))}))})),[2]}))}))};return l(!0),t(1),function(){d(void 0)}}),[n]),(0,s.jsxs)("div",{className:"wp-parsely-performance-panel",children:[(0,s.jsx)(fe,{title:(0,c.__)("Performance Stats","wp-parsely"),icon:de,dropdownChildren:function(e){var t=e.onClose;return(0,s.jsx)(We,{onClose:t})},children:(0,s.jsx)("div",{className:"panel-settings",children:(0,s.jsx)(i.SelectControl,{value:m.PerformanceStatsSettings.Period,prefix:(0,c.__)("Period: ","wp-parsely"),onChange:function(t){T(t,e)&&(w({PerformanceStatsSettings:De(De({},m.PerformanceStatsSettings),{Period:t})}),g.trackEvent("editor_sidebar_performance_period_changed",{period:t}))},children:Object.values(e).map((function(e){return(0,s.jsx)("option",{value:e,children:E(e)},e)}))})})}),p?p.Message():(0,s.jsxs)(s.Fragment,{children:[Ue(m,"overview")&&(0,s.jsx)(Ee,{data:h,isLoading:a}),Ue(m,"categories")&&(0,s.jsx)(he,{data:h,isLoading:a}),Ue(m,"referrers")&&(0,s.jsx)(Ce,{data:h,isLoading:a})]}),window.wpParselyPostUrl&&(0,s.jsx)(i.Button,{className:"wp-parsely-view-post",variant:"primary",onClick:function(){g.trackEvent("editor_sidebar_view_post_pressed")},href:window.wpParselyPostUrl,rel:"noopener",target:"_blank",children:(0,c.__)("View this in Parse.ly","wp-parsely")})]})},qe=function(e){var t=e.period;return(0,s.jsx)(i.Panel,{children:(0,s.jsx)(M,{children:(0,s.jsx)($e,{period:t})})})},Ze=window.wp.coreData,Ke=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n},Ye=function(e){var t=e.filter,n=e.label,a=e.postData,l=Ke(e,["filter","label","postData"]);return(0,s.jsx)("div",{className:"related-posts-filter-types",children:(0,s.jsxs)(i.__experimentalToggleGroupControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:n||(0,c.__)("Filter by","wp-parsely"),value:t.type,onChange:function(e){return l.onFilterTypeChange(e)},isBlock:!0,children:[a.tags.length>=1&&(0,s.jsx)(i.__experimentalToggleGroupControlOption,{value:r.Tag,label:(0,c.__)("Tag","wp-parsely")}),a.categories.length>=1&&(0,s.jsx)(i.__experimentalToggleGroupControlOption,{value:r.Section,label:(0,c.__)("Section","wp-parsely")}),(0,s.jsx)(i.__experimentalToggleGroupControlOption,{value:r.Author,label:(0,c.__)("Author","wp-parsely")})]})})},Qe=function(e){var t=e.filter,n=e.postData,a=Ke(e,["filter","postData"]);return(0,s.jsx)("div",{className:"related-posts-filter-values",children:(0,s.jsx)(i.ComboboxControl,{allowReset:!0,onChange:function(e){return a.onFilterValueChange(e)},options:r.Tag===t.type?n.tags.map((function(e){return{value:e,label:e}})):r.Section===t.type?n.categories.map((function(e){return{value:e,label:e}})):r.Author===t.type?n.authors.map((function(e){return{value:e,label:e}})):[],value:t.value})})},Xe=function(e){var t=e.filter,n=e.postData,i=e.label,a=Ke(e,["filter","postData","label"]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Ye,{filter:t,label:i,onFilterTypeChange:a.onFilterTypeChange,postData:n}),(r.Tag===t.type&&n.tags.length>1||r.Section===t.type&&n.categories.length>1||r.Author===t.type&&n.authors.length>1)&&(0,s.jsx)(Qe,{filter:t,onFilterValueChange:a.onFilterValueChange,postData:n})]})},Je=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M19.5 4.5h-7V6h4.44l-5.97 5.97 1.06 1.06L18 7.06v4.44h1.5v-7Zm-13 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-3H17v3a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h3V5.5h-3Z"})),et=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),tt=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5.625 5.5h9.75c.069 0 .125.056.125.125v9.75a.125.125 0 0 1-.125.125h-9.75a.125.125 0 0 1-.125-.125v-9.75c0-.069.056-.125.125-.125ZM4 5.625C4 4.728 4.728 4 5.625 4h9.75C16.273 4 17 4.728 17 5.625v9.75c0 .898-.727 1.625-1.625 1.625h-9.75A1.625 1.625 0 0 1 4 15.375v-9.75Zm14.5 11.656v-9H20v9C20 18.8 18.77 20 17.251 20H6.25v-1.5h11.001c.69 0 1.249-.528 1.249-1.219Z"})),nt=function(){return(0,s.jsx)(i.SVG,{"aria-hidden":"true",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 42 42",children:(0,s.jsx)(i.Path,{d:"M15.3,20.1c0,3.1,2.6,5.7,5.7,5.7s5.7-2.6,5.7-5.7s-2.6-5.7-5.7-5.7S15.3,17,15.3,20.1z M23.4,32.4\n\t\t\tC30.1,30.9,40.5,22,40.5,22s-7.7-12-18-13.3c-0.6-0.1-2.6-0.1-3-0.1c-10,1-18,13.7-18,13.7s8.7,8.6,17,9.9\n\t\t\tC19.4,32.6,22.4,32.6,23.4,32.4z M11.1,20.7c0-5.2,4.4-9.4,9.9-9.4s9.9,4.2,9.9,9.4S26.5,30,21,30S11.1,25.8,11.1,20.7z"})})};function rt(e){var t=e.metric,n=e.post,r=e.avgEngagedIcon,i=e.viewsIcon;return"views"===t?(0,s.jsxs)("span",{className:"parsely-post-metric-data",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,c.__)("Number of Views","wp-parsely")}),i,ge(n.views.toString())]}):"avg_engaged"===t?(0,s.jsxs)("span",{className:"parsely-post-metric-data",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,c.__)("Average Time","wp-parsely")}),r,n.avgEngaged]}):(0,s.jsx)("span",{className:"parsely-post-metric-data",children:"-"})}function st(e){var t,n=e.metric,r=e.post;return(0,s.jsxs)("div",{className:"related-post-single","data-testid":"related-post-single",children:[(0,s.jsxs)("div",{className:"related-post-title",children:[(0,s.jsxs)("a",{className:"related-post-stats-link",href:r.dashUrl,target:"_blank",rel:"noreferrer",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,c.__)("View in Parse.ly (opens new tab)","wp-parsely")}),r.title]}),(0,s.jsxs)("a",{className:"related-post-view-link",href:r.url,target:"_blank",rel:"noreferrer",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,c.__)("View Post (opens new tab)","wp-parsely")}),(0,s.jsx)(i.Tooltip,{text:(0,c.__)("View Post","wp-parsely"),children:(0,s.jsx)(we,{icon:Je,size:16})})]}),0===r.postId&&(0,s.jsxs)("a",{className:"related-post-edit-link",href:(t=r.postId,"/wp-admin/post.php?post=".concat(t,"&action=edit")),target:"_blank",rel:"noreferrer",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,c.__)("Edit Post (opens new tab)","wp-parsely")}),(0,s.jsx)(i.Tooltip,{text:(0,c.__)("Edit Post","wp-parsely"),children:(0,s.jsx)(we,{icon:et,size:16})})]})]}),(0,s.jsxs)("div",{className:"related-post-info",children:[(0,s.jsxs)("span",{className:"related-post-date",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,c.__)("Date","wp-parsely")}),Ae(new Date(r.date))]}),(0,s.jsxs)("span",{className:"related-post-author",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,c.__)("Author","wp-parsely")}),r.author]})]}),(0,s.jsxs)("div",{className:"related-post-links",children:[(0,s.jsxs)("div",{className:"related-post-linked",children:[(0,s.jsx)(we,{icon:ue,size:18}),(0,c.__)("Linked","wp-parsely")]}),(0,s.jsx)("div",{className:"related-post-metric",children:(0,s.jsx)(rt,{metric:n,post:r,viewsIcon:(0,s.jsx)(we,{icon:(0,s.jsx)(nt,{}),size:18}),avgEngagedIcon:(0,s.jsx)(i.Dashicon,{icon:"clock",size:18})})}),(0,s.jsx)("div",{className:"related-post-copy-url",children:(0,s.jsxs)(i.Button,{variant:"link",children:[(0,c.__)("Copy URL","wp-parsely"),(0,s.jsx)(we,{icon:tt,size:18})]})})]})]})}var it,at=function(){return at=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},at.apply(this,arguments)},lt=function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{o(r.next(e))}catch(e){i(e)}}function l(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}o((r=r.apply(e,t||[])).next())}))},ot=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(o){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&l[0]?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){a.label=l[1];break}if(6===l[0]&&a.label<s[1]){a.label=s[1],s=l;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(l);break}s[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,o])}}},ct=function(){function e(){}return e.getRelatedPosts=function(e,t,n){return lt(this,void 0,void 0,(function(){var r,s,i;return ot(this,(function(a){switch(a.label){case 0:try{r=this.buildRelatedPostsApiQuery(e,t,n)}catch(e){return[2,Promise.reject(e)]}a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.fetchRelatedPostsFromWpEndpoint(r)];case 2:return s=a.sent(),[3,4];case 3:return i=a.sent(),[2,Promise.reject(i)];case 4:return[2,{message:this.generateMessage(0===s.length,e,r.message),posts:s}]}}))}))},e.generateMessage=function(e,t,n){return e?(0,c.sprintf)(/* translators: 1: message such as "in category Foo" */
(0,c.__)("No related posts %1$s were found for the specified period and metric.","wp-parsely"),n):(0,c.sprintf)(/* translators: 1: message such as "in category Foo", 2: period such as "last 7 days"*/
(0,c.__)("Related posts %1$s in the %2$s.","wp-parsely"),n,E(t,!0))},e.fetchRelatedPostsFromWpEndpoint=function(e){var t;return lt(this,void 0,void 0,(function(){var n,r;return ot(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,x()({path:(0,$.addQueryArgs)("/wp-parsely/v1/stats/posts",at(at({},e.query),{itm_source:"wp-parsely-content-helper"}))})];case 1:return n=s.sent(),[3,3];case 2:return r=s.sent(),[2,Promise.reject(new Z(r.message,r.code))];case 3:return(null==n?void 0:n.error)?[2,Promise.reject(new Z(n.error.message,U.ParselyApiResponseContainsError))]:[2,null!==(t=null==n?void 0:n.data)&&void 0!==t?t:[]]}}))}))},e.buildRelatedPostsApiQuery=function(e,t,n){var s=at(at({},Re(e)),{limit:5,sort:t});if(r.Tag===n.type)return{query:at({tag:n.value},s),
/* translators: %s: message such as "with tag Foo" */
message:(0,c.sprintf)((0,c.__)('with tag "%1$s"',"wp-parsely"),n.value)};if(r.Section===n.type)return{query:at({section:n.value},s),
/* translators: %s: message such as "in category Foo" */
message:(0,c.sprintf)((0,c.__)('in section "%1$s"',"wp-parsely"),n.value)};if(r.Author===n.type)return{query:at({author:n.value},s),
/* translators: %s: message such as "by author John" */
message:(0,c.sprintf)((0,c.__)('by author "%1$s"',"wp-parsely"),n.value)};throw new Z((0,c.__)("No valid filter type has been specified.","wp-parsely"),U.CannotFormulateApiQuery)},e}(),ut=window.wp.editor,pt=function(){return pt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},pt.apply(this,arguments)},dt=function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{o(r.next(e))}catch(e){i(e)}}function l(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}o((r=r.apply(e,t||[])).next())}))},ft=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(o){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&l[0]?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){a.label=l[1];break}if(6===l[0]&&a.label<s[1]){a.label=s[1],s=l;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(l);break}s[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,o])}}},gt=function(){var n=j(),l=n.settings,u=n.setSettings,p=l.RelatedPostsPeriod,d=l.RelatedPostsMetric,f=(0,o.useState)({authors:[],categories:[],tags:[]}),h=f[0],y=f[1],v=(0,a.useSelect)((function(e){var t=e(ut.store).getEditedPostAttribute,n=e(Ze.store).getEntityRecords;return{authors:n("root","user",{include:t("author")}),categories:n("taxonomy","category",{include:t("categories")}),tags:n("taxonomy","post_tag",{include:t("tags")})}}),[]),m=v.authors,w=v.categories,_=v.tags;(0,o.useEffect)((function(){m&&w&&_&&y({authors:m.map((function(e){return e.name})),categories:w.map((function(e){return e.name})),tags:_.map((function(e){return e.name}))})}),[m,w,_]);var b=(0,o.useState)(!0),x=b[0],S=b[1],P=(0,o.useState)(),k=(P[0],P[1]),L=(0,o.useState)(),O=L[0],N=L[1],A=(0,o.useState)([]),R=A[0],I=A[1],B=(0,o.useState)({type:l.RelatedPostsFilterBy,value:l.RelatedPostsFilterValue}),M=B[0],V=B[1],D=function(e,t){u({RelatedPostsFilterBy:e,RelatedPostsFilterValue:t})};return(0,o.useEffect)((function(){var e,t,n=function(e){return dt(void 0,void 0,void 0,(function(){return ft(this,(function(t){return ct.getRelatedPosts(p,d,M).then((function(e){I(e.posts),N(e.message),S(!1)})).catch((function(t){return dt(void 0,void 0,void 0,(function(){return ft(this,(function(r){switch(r.label){case 0:return e>0&&t.retryFetch?[4,new Promise((function(e){return setTimeout(e,500)}))]:[3,3];case 1:return r.sent(),[4,n(e-1)];case 2:return r.sent(),[3,4];case 3:S(!1),k(t),r.label=4;case 4:return[2]}}))}))})),[2]}))}))},s=r.Tag===M.type,i=r.Section===M.type,a=r.Unavailable===M.type,l=0===h.tags.length,o=0===h.categories.length,c=s&&!h.tags.includes(M.value),u=i&&!h.categories.includes(M.value);return S(!0),a||s&&l||i&&o?Object.values(h).every((function(e){return 0===e.length}))||V((e="",t=r.Unavailable,h.tags.length>=1?(t=r.Tag,e=h.tags[0]):h.categories.length>=1?(t=r.Section,e=h.categories[0]):(t=r.Author,e=h.authors[0]),{type:t,value:e})):c?V({type:r.Tag,value:h.tags[0]}):u?V({type:r.Section,value:h.categories[0]}):n(1),function(){S(!1),I([]),N(""),k(void 0)}}),[p,d,M,h]),(0,s.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,s.jsx)(i.Spinner,{})}),(0,s.jsxs)("div",{className:"wp-parsely-related-posts",children:[(0,s.jsx)("div",{className:"related-posts-description",children:(0,c.__)("Find top-performing related posts based on a key metric.","wp-parsely")}),(0,s.jsxs)("div",{className:"related-posts-body",children:[(0,s.jsxs)("div",{className:"related-posts-settings",children:[(0,s.jsx)(i.SelectControl,{onChange:function(e){var n;T(n=e,t)&&u({RelatedPostsMetric:n})},prefix:(0,c.__)("Metric: ","wp-parsely"),value:d,children:Object.values(t).map((function(e){return(0,s.jsx)("option",{value:e,children:C(e)},e)}))}),(0,s.jsx)(i.SelectControl,{value:p,prefix:(0,c.__)("Period: ","wp-parsely"),onChange:function(t){return function(t){T(t,e)&&u({RelatedPostsPeriod:t})}(t)},children:Object.values(e).map((function(e){return(0,s.jsx)("option",{value:e,children:E(e)},e)}))})]}),(0,s.jsx)("div",{className:"related-posts-filter-settings",children:(0,s.jsx)(Xe,{label:(0,c.__)("Filter by","wp-parsely"),filter:M,onFilterTypeChange:function(e){if(console.log("updateFilterType",e),T(e,r)){var t="",n=e;r.Tag===n&&(t=h.tags[0]),r.Section===n&&(t=h.categories[0]),r.Author===n&&(t=h.authors[0]),""!==t&&(D(n,t),V({type:n,value:t}),g.trackEvent("related_posts_filter_type_changed",{filter_type:n}))}},onFilterValueChange:function(e){"string"==typeof e&&(D(M.type,e),V(pt(pt({},M),{value:e})))},postData:h})}),(0,s.jsxs)("div",{className:"related-posts-wrapper",children:[(0,s.jsx)("div",{children:(0,s.jsx)("p",{className:"related-posts-descr","data-testid":"parsely-related-posts-descr",children:r.Tag===M.type?(0,c.sprintf)(/* translators: 1: tag name, 2: period */
(0,c.__)("Top related posts with the “%1$s” tag in the %2$s.","wp-parsely"),M.value,E(p,!0)):r.Section===M.type?(0,c.sprintf)(/* translators: 1: section name, 2: period */
(0,c.__)("Top related posts in the %1$s section in the %2$s.","wp-parsely"),M.value,E(p,!0)):r.Author===M.type?(0,c.sprintf)(/* translators: 1: author name, 2: period */
(0,c.__)("Top related posts by %1$s in the %2$s.","wp-parsely"),M.value,E(p,!0)):null!=O?O:""})}),x&&(0,s.jsx)("div",{className:"related-posts-loading-message",children:(0,c.__)("Loading …","wp-parsely")}),!x&&0===R.length&&(0,s.jsx)("div",{className:"related-posts-empty",children:(0,c.__)("No related posts found.","wp-parsely")}),!x&&R.length>0&&(0,s.jsx)("div",{className:"related-posts-list",children:R.map((function(e){return(0,s.jsx)(st,{metric:d,post:e},e.id)}))})]})]})]})},ht=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M12 13.06l3.712 3.713 1.061-1.06L13.061 12l3.712-3.712-1.06-1.06L12 10.938 8.288 7.227l-1.061 1.06L10.939 12l-3.712 3.712 1.06 1.061L12 13.061z"})),yt=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"m21.5 9.1-6.6-6.6-4.2 5.6c-1.2-.1-2.4.1-3.6.7-.1 0-.1.1-.2.1-.5.3-.9.6-1.2.9l3.7 3.7-5.7 5.7v1.1h1.1l5.7-5.7 3.7 3.7c.4-.4.7-.8.9-1.2.1-.1.1-.2.2-.3.6-1.1.8-2.4.6-3.6l5.6-4.1zm-7.3 3.5.1.9c.1.9 0 1.8-.4 2.6l-6-6c.8-.4 1.7-.5 2.6-.4l.9.1L15 4.9 19.1 9l-4.9 3.6z"})),vt=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M18.3 11.7c-.6-.6-1.4-.9-2.3-.9H6.7l2.9-3.3-1.1-1-4.5 5L8.5 16l1-1-2.7-2.7H16c.5 0 .9.2 1.3.5 1 1 1 3.4 1 4.5v.3h1.5v-.2c0-1.5 0-4.3-1.5-5.7z"})),mt=function(){return mt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},mt.apply(this,arguments)},wt=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,i=t.length;s<i;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},_t=0;!function(e){e.PostTitle="postTitles",e.Heading="headings"}(it||(it={}));var bt={isLoading:!1,postTitles:{titles:[]},headings:{titles:[]}},xt=(0,a.createReduxStore)("wp-parsely/write-titles",{initialState:bt,reducer:function(e,t){var n,r,s,i,a,l;switch(void 0===e&&(e=bt),t.type){case"SET_LOADING":return mt(mt({},e),{isLoading:t.isLoading});case"SET_TITLES":return mt(mt({},e),((n={})[t.titleType]=mt(mt({},e[t.titleType]),{titles:wt(wt([],e[t.titleType].titles.filter((function(e){return e.isPinned})),!0),t.data.map((function(e){return{title:e,isPinned:!1,id:_t++}})),!0)}),n));case"REMOVE_TITLE":return mt(mt({},e),((r={})[t.titleType]=mt(mt({},e[t.titleType]),{titles:e[t.titleType].titles.filter((function(e){return e.id!==t.title.id}))}),r));case"PIN_TITLE":return mt(mt({},e),((s={})[t.titleType]=mt(mt({},e[t.titleType]),{titles:e[t.titleType].titles.map((function(e){return e.id===t.title.id?mt(mt({},e),{isPinned:!0}):e}))}),s));case"UNPIN_TITLE":return mt(mt({},e),((i={})[t.titleType]=mt(mt({},e[t.titleType]),{titles:e[t.titleType].titles.map((function(e){return e.id===t.title.id?mt(mt({},e),{isPinned:!1}):e}))}),i));case"SET_ACCEPTED_TITLE":return mt(mt({},e),((a={})[t.titleType]=mt(mt({},e[t.titleType]),{acceptedTitle:t.title}),a));case"SET_ORIGINAL_TITLE":return mt(mt({},e),((l={})[t.titleType]=mt(mt({},e[t.titleType]),{originalTitle:t.title}),l));default:return e}},actions:{setLoading:function(e){return{type:"SET_LOADING",isLoading:e}},setTitles:function(e,t){return{type:"SET_TITLES",titleType:e,data:t}},removeTitle:function(e,t){return{type:"REMOVE_TITLE",titleType:e,title:t}},setAcceptedTitle:function(e,t){return{type:"SET_ACCEPTED_TITLE",titleType:e,title:t}},pinTitle:function(e,t){return{type:"PIN_TITLE",titleType:e,title:t}},unpinTitle:function(e,t){return{type:"UNPIN_TITLE",titleType:e,title:t}},setOriginalTitle:function(e,t){return{type:"SET_ORIGINAL_TITLE",titleType:e,title:t}}},selectors:{getState:function(e){return e},isLoading:function(e){return e.isLoading},getTitles:function(e,t){return e[t].titles.map((function(e){return e}))},getPinnedTitles:function(e,t){return e[t].titles.filter((function(e){return e.isPinned}))},isPinned:function(e,t,n){var r,s;return null!==(s=null===(r=e[t].titles.find((function(e){return e.id===n.id})))||void 0===r?void 0:r.isPinned)&&void 0!==s&&s},getAcceptedTitle:function(e,t){return e[t].acceptedTitle},isAcceptedTitle:function(e,t,n){var r;return(null===(r=e[t].acceptedTitle)||void 0===r?void 0:r.id)===n.id},getOriginalTitle:function(e,t){var n;if(e[t].originalTitle)return{id:-1,title:null!==(n=e[t].originalTitle)&&void 0!==n?n:"",isPinned:!1}}}});(0,a.register)(xt);var St=function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{o(r.next(e))}catch(e){i(e)}}function l(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}o((r=r.apply(e,t||[])).next())}))},Pt=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(o){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&l[0]?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){a.label=l[1];break}if(6===l[0]&&a.label<s[1]){a.label=s[1],s=l;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(l);break}s[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,o])}}},jt=function(e){var t=(0,a.useDispatch)(xt),n=t.removeTitle,r=t.setAcceptedTitle,l=t.pinTitle,o=t.unpinTitle,u=t.setOriginalTitle,p=(0,a.useSelect)((function(t){return t(xt).isPinned(e.type,e.title)}),[e.title,e.type]),d=(0,a.useSelect)((function(e){return(0,e("core/editor").getEditedPostAttribute)("title")}),[]),f=d===e.title.title,h=function(){return St(void 0,void 0,void 0,(function(){return Pt(this,(function(t){switch(t.label){case 0:return g.trackEvent("title_suggestion_pinned",{pinned:!p,type:e.type,title:e.title.title}),p?[4,o(e.type,e.title)]:[3,2];case 1:return t.sent(),[3,4];case 2:return[4,l(e.type,e.title)];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))};return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"wp-parsely-title-suggestion".concat(f?" title-in-use":"").concat(e.isOriginal?" original-title":""),children:[(0,s.jsx)("div",{className:"suggested-title",children:e.title.title}),(0,s.jsxs)(i.ButtonGroup,{className:"suggested-title-actions",children:[!e.isOriginal&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(i.Button,{variant:"link",onClick:function(){return St(void 0,void 0,void 0,(function(){return Pt(this,(function(t){switch(t.label){case 0:return f?[2]:(g.trackEvent("title_suggestion_applied",{title:e.title.title,type:e.type}),[4,r(e.type,e.title)]);case 1:return t.sent(),[2]}}))}))},disabled:f,children:[f?(0,c.__)("Applied","wp-parsely"):(0,c.__)("Apply","wp-parsely"),(0,s.jsx)(we,{size:18,icon:ue})]}),(0,s.jsxs)(i.Button,{variant:"link",onClick:function(){return St(void 0,void 0,void 0,(function(){return Pt(this,(function(t){switch(t.label){case 0:return g.trackEvent("title_suggestion_removed",{type:e.type,title:e.title.title}),[4,n(e.type,e.title)];case 1:return t.sent(),[2]}}))}))},children:[(0,c.__)("Discard","wp-parsely"),(0,s.jsx)(we,{size:18,icon:ht})]}),p?(0,s.jsxs)(i.Button,{variant:"link",onClick:h,children:[(0,c.__)("Unpin","wp-parsely"),(0,s.jsx)(we,{size:18,icon:pe})]}):(0,s.jsxs)(i.Button,{variant:"link",onClick:h,children:[(0,c.__)("Pin","wp-parsely"),(0,s.jsx)(we,{size:18,icon:yt})]})]}),e.isOriginal&&(0,s.jsxs)(i.Button,{variant:"link",onClick:function(){return St(void 0,void 0,void 0,(function(){return Pt(this,(function(t){switch(t.label){case 0:return g.trackEvent("title_suggestion_restored",{type:e.type,restored_title:e.title.title,accepted_title:d}),(0,a.dispatch)("core/editor").editPost({title:e.title.title}),[4,u(e.type,void 0)];case 1:return t.sent(),[2]}}))}))},children:[(0,c.__)("Restore","wp-parsely"),(0,s.jsx)(we,{size:18,icon:vt})]})]})]})})},kt=function(e){var t=e.pinnedTitles,n=e.isOpen,r=e.onSettingChange,a=(0,o.useState)(n),l=a[0],u=a[1];return(0,s.jsx)(i.Panel,{className:"wp-parsely-pinned-suggestions",children:(0,s.jsx)(i.PanelBody,{className:"pinned-suggestions-body",title:(0,c.__)("Pinned Suggestions","wp-parsely"),onToggle:function(){u(!l),r("PinnedOpen",!l),g.trackEvent("title_suggestions_pinned_toggle",{isOpen:!l,pinnedTitles:t.length})},opened:l,children:t.map((function(e){return(0,s.jsx)(jt,{title:e,type:it.PostTitle},e.title)}))})})},Tt=function(){return(0,s.jsx)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",children:(0,s.jsx)(i.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M13.5034 7.91642L9 12.0104L4.49662 7.91642L5.25337 7.08398L8.99999 10.49L12.7466 7.08398L13.5034 7.91642Z",fill:"#1E1E1E"})})},Et={journalist:{label:(0,c.__)("Journalist","wp-parsely")},editorialWriter:{label:(0,c.__)("Editorial Writer","wp-parsely")},investigativeReporter:{label:(0,c.__)("Investigative Reporter","wp-parsely")},techAnalyst:{label:(0,c.__)("Tech Analyst","wp-parsely")},businessAnalyst:{label:(0,c.__)("Business Analyst","wp-parsely")},culturalCommentator:{label:(0,c.__)("Cultural Commentator","wp-parsely")},scienceCorrespondent:{label:(0,c.__)("Science Correspondent","wp-parsely")},politicalAnalyst:{label:(0,c.__)("Political Analyst","wp-parsely")},healthWellnessAdvocate:{label:(0,c.__)("Health and Wellness Advocate","wp-parsely")},environmentalJournalist:{label:(0,c.__)("Environmental Journalist","wp-parsely")},custom:{label:(0,c.__)("Custom Persona","wp-parsely"),icon:et}},Ct=Object.keys(Et),Lt=function(e){return"custom"===e||""===e?Et.custom.label:Ot(e)?e:Et[e].label},Ot=function(e){return!Ct.includes(e)||"custom"===e},Nt=function(e){var t=e.value,n=e.onChange,r=(0,o.useState)(""),a=r[0],l=r[1],u=(0,O.useDebounce)(n,500);return(0,s.jsx)("div",{className:"parsely-persona-selector-custom",children:(0,s.jsx)(i.TextControl,{value:a||t,placeholder:(0,c.__)("Enter a custom persona…","wp-parsely"),onChange:function(e){if(""===e)return n(""),void l("");e.length>32&&(e=e.slice(0,32)),u(e),l(e)}})})},At=function(e){var t=e.persona,n=e.value,r=void 0===n?(0,c.__)("Select a persona…","wp-parsely"):n,a=e.label,l=void 0===a?(0,c.__)("Persona","wp-parsely"):a,o=e.onChange,u=e.onDropdownChange,p=e.disabled,d=void 0!==p&&p,f=e.allowCustom,g=void 0!==f&&f;return(0,s.jsxs)(i.Disabled,{isDisabled:d,children:[l&&(0,s.jsx)("div",{className:"wp-parsely-dropdown-label",children:l}),(0,s.jsx)(i.DropdownMenu,{label:(0,c.__)("Persona","wp-parsely"),className:"parsely-persona-selector-dropdown"+(d?" is-disabled":""),popoverProps:{className:"wp-parsely-popover"},toggleProps:{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"parsely-persona-selector-label",children:Ot(t)?Et.custom.label:r}),(0,s.jsx)(Tt,{})]})},children:function(e){var n=e.onClose;return(0,s.jsx)(i.MenuGroup,{label:(0,c.__)("Persona","wp-parsely"),children:(0,s.jsx)(s.Fragment,{children:Ct.map((function(e){if(!g&&"custom"===e)return null;var r=Et[e],a=e===t||Ot(t)&&"custom"===e;return(0,s.jsxs)(i.MenuItem,{isSelected:a,className:a?"is-selected":"",role:"menuitemradio",onClick:function(){null==u||u(e),o(e),n(),"custom"===e&&setTimeout((function(){var e=document.querySelector(".parsely-persona-selector-custom input");e&&e.focus()}),0)},children:[r.icon&&(0,s.jsx)(we,{icon:r.icon}),r.label]},e)}))})})}}),g&&Ot(t)&&(0,s.jsx)(Nt,{onChange:function(e){o(""!==e?e:"custom")},value:"custom"===t?"":t})]})},Rt={neutral:{label:(0,c.__)("Neutral","wp-parsely")},formal:{label:(0,c.__)("Formal","wp-parsely")},humorous:{label:(0,c.__)("Humorous","wp-parsely")},confident:{label:(0,c.__)("Confident","wp-parsely")},provocative:{label:(0,c.__)("Provocative","wp-parsely")},serious:{label:(0,c.__)("Serious","wp-parsely")},inspirational:{label:(0,c.__)("Inspirational","wp-parsely")},skeptical:{label:(0,c.__)("Skeptical","wp-parsely")},conversational:{label:(0,c.__)("Conversational","wp-parsely")},analytical:{label:(0,c.__)("Analytical","wp-parsely")},custom:{label:(0,c.__)("Custom Tone","wp-parsely"),icon:et}},It=Object.keys(Rt),Bt=function(e){return"custom"===e||""===e?Rt.custom.label:Mt(e)?e:Rt[e].label},Mt=function(e){return!It.includes(e)||"custom"===e},Vt=function(e){var t=e.value,n=e.onChange,r=(0,o.useState)(""),a=r[0],l=r[1],u=(0,O.useDebounce)(n,500);return(0,s.jsx)("div",{className:"parsely-tone-selector-custom",children:(0,s.jsx)(i.TextControl,{value:a||t,placeholder:(0,c.__)("Enter a custom tone","wp-parsely"),onChange:function(e){if(""===e)return n(""),void l("");e.length>32&&(e=e.slice(0,32)),u(e),l(e)}})})},Dt=function(e){var t=e.tone,n=e.value,r=void 0===n?(0,c.__)("Select a tone","wp-parsely"):n,a=e.label,l=void 0===a?(0,c.__)("Tone","wp-parsely"):a,o=e.onChange,u=e.onDropdownChange,p=e.disabled,d=void 0!==p&&p,f=e.allowCustom,g=void 0!==f&&f;return(0,s.jsxs)(i.Disabled,{isDisabled:d,children:[(0,s.jsx)("div",{className:"wp-parsely-dropdown-label",children:l}),(0,s.jsx)(i.DropdownMenu,{label:(0,c.__)("Tone","wp-parsely"),className:"parsely-tone-selector-dropdown"+(d?" is-disabled":""),popoverProps:{className:"wp-parsely-popover"},toggleProps:{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"parsely-tone-selector-label",children:Mt(t)?Rt.custom.label:r}),(0,s.jsx)(Tt,{})]})},children:function(e){var n=e.onClose;return(0,s.jsx)(i.MenuGroup,{label:(0,c.__)("Select a tone","wp-parsely"),children:(0,s.jsx)(s.Fragment,{children:It.map((function(e){if(!g&&"custom"===e)return null;var r=Rt[e],a=e===t||Mt(t)&&"custom"===e;return(0,s.jsxs)(i.MenuItem,{isSelected:a,className:a?"is-selected":"",role:"menuitemradio",onClick:function(){null==u||u(e),o(e),n(),"custom"===e&&setTimeout((function(){var e=document.querySelector(".parsely-tone-selector-custom input");e&&e.focus()}),0)},children:[r.icon&&(0,s.jsx)(we,{icon:r.icon}),r.label]},e)}))})})}}),g&&Mt(t)&&(0,s.jsx)(Vt,{onChange:function(e){o(""!==e?e:"custom")},value:"custom"===t?"":t})]})},Ft=function(e){var t=e.isLoading,n=e.onPersonaChange,r=e.onToneChange,i=e.persona,a=e.tone;return(0,s.jsxs)("div",{className:"title-suggestions-settings",children:[(0,s.jsx)(Dt,{tone:a,value:Bt(a),onChange:function(e){r(e)},onDropdownChange:function(e){g.trackEvent("title_suggestions_ai_tone_changed",{tone:e})},disabled:t,allowCustom:!0}),(0,s.jsx)(At,{persona:i,value:Lt(i),onChange:function(e){n(e)},onDropdownChange:function(e){g.trackEvent("title_suggestions_ai_persona_changed",{persona:e})},disabled:t,allowCustom:!0})]})},Gt=function(){function e(){}return e.prototype.generateTitles=function(e,t,n,r){var s,i,a,l,o;return void 0===t&&(t=3),i=this,a=void 0,o=function(){var i,a;return function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(o){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&l[0]?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){a.label=l[1];break}if(6===l[0]&&a.label<s[1]){a.label=s[1],s=l;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(l);break}s[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,o])}}}(this,(function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,x()({method:"POST",path:(0,$.addQueryArgs)("/wp-parsely/v1/content-suggestions/suggest-headline",{limit:t,tone:Bt(n),persona:Lt(r)}),data:{content:e}})];case 1:return i=l.sent(),[3,3];case 2:return a=l.sent(),[2,Promise.reject(new Z(a.message,a.code))];case 3:return(null==i?void 0:i.error)?[2,Promise.reject(new Z(i.error.message,U.ParselyApiResponseContainsError))]:[2,null!==(s=null==i?void 0:i.data)&&void 0!==s?s:[]]}}))},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{s(o.next(e))}catch(e){t(e)}}function r(e){try{s(o.throw(e))}catch(e){t(e)}}function s(t){var s;t.done?e(t.value):(s=t.value,s instanceof l?s:new l((function(e){e(s)}))).then(n,r)}s((o=o.apply(i,a||[])).next())}))},e}(),zt=function(){return zt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},zt.apply(this,arguments)},Ht=function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{o(r.next(e))}catch(e){i(e)}}function l(e){try{o(r.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}o((r=r.apply(e,t||[])).next())}))},Ut=function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(o){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&l[0]?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){a.label=l[1];break}if(6===l[0]&&a.label<s[1]){a.label=s[1],s=l;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(l);break}s[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,o])}}},Wt=function(){var e=j(),t=e.settings,n=e.setSettings,r=(0,o.useState)(),l=r[0],u=r[1],p=(0,o.useState)(t.TitleSuggestionsSettings.Tone),d=p[0],f=p[1],h=(0,o.useState)(t.TitleSuggestionsSettings.Persona),y=h[0],v=h[1],m=(0,a.useSelect)((function(e){var t=e(xt),n=t.isLoading,r=t.getTitles,s=t.getAcceptedTitle,i=t.getOriginalTitle,a=r(it.PostTitle);return{acceptedTitle:s(it.PostTitle),loading:n(),titles:a.filter((function(e){return!e.isPinned})),pinnedTitles:a.filter((function(e){return e.isPinned})),allTitles:a,originalTitle:i(it.PostTitle)}}),[]),w=m.loading,_=m.titles,b=m.pinnedTitles,x=m.allTitles,S=m.acceptedTitle,P=m.originalTitle,k=(0,a.useDispatch)(xt),T=k.setTitles,E=k.setLoading,C=k.setAcceptedTitle,L=k.setOriginalTitle,O=(0,a.useDispatch)("core/notices").createNotice,N=function(e,r){var s;n({TitleSuggestionsSettings:zt(zt({},t.TitleSuggestionsSettings),(s={},s[e]=r,s))})},A=(0,a.useSelect)((function(e){return(0,e("core/editor").getEditedPostContent)()}),[]),R=(0,a.useSelect)((function(e){return(0,e("core/editor").getEditedPostAttribute)("title")}),[]);return(0,o.useEffect)((function(){S&&(L(it.PostTitle,R),(0,a.dispatch)("core/editor").editPost({title:null==S?void 0:S.title}),S&&((0,a.dispatch)(xt).pinTitle(it.PostTitle,S),g.trackEvent("title_suggestions_accept_pressed",{old_title:R,new_title:S.title})),C(it.PostTitle,void 0),O("success",(0,c.__)("Title suggestion applied.","wp-parsely"),{type:"snackbar",className:"parsely-title-suggestion-applied",explicitDismiss:!0,actions:[{label:(0,c.__)("Undo","wp-parsely"),onClick:function(){(0,a.dispatch)("core/editor").editPost({title:R}),L(it.PostTitle,void 0)}}]}))}),[S]),(0,o.useEffect)((function(){void 0!==l&&O("error",(0,c.__)("There was an error generating title suggestions.","wp-parsely"),{type:"snackbar",className:"parsely-title-suggestion-error",isDismissible:!0})}),[l]),(0,s.jsx)(i.PanelRow,{children:(0,s.jsxs)("div",{className:"wp-parsely-title-suggestions-wrapper",children:[(0,s.jsxs)("div",{className:"title-suggestions-header",children:[(0,c.__)("Use Parse.ly AI to generate a title for your post.","wp-parsely"),(0,s.jsxs)(i.Button,{href:"https://docs.parse.ly/plugin-content-helper/#h-title-suggestions-beta",target:"_blank",variant:"link",children:[(0,c.__)("Learn more about Parse.ly AI","wp-parsely"),(0,s.jsx)(we,{icon:Je,size:18,className:"parsely-external-link-icon"})]})]}),l&&(0,s.jsx)(i.Notice,{status:"info",isDismissible:!1,className:"wp-parsely-content-helper-error",children:l.message}),0<x.length&&(0,s.jsxs)(s.Fragment,{children:[b.length>0&&(0,s.jsx)(kt,{pinnedTitles:b,originalTitle:P,onSettingChange:N,isOpen:t.TitleSuggestionsSettings.PinnedOpen}),(0,s.jsxs)("div",{className:"wp-parsely-title-suggestions-container",children:[void 0!==P&&(0,s.jsx)(jt,{title:P,type:it.PostTitle,isOriginal:!0}),_.map((function(e){return(0,s.jsx)(jt,{title:e,type:it.PostTitle},e.id)}))]})]}),(0,s.jsx)(Ft,{isLoading:w,onPersonaChange:function(e){N("Persona",e),v(e)},onSettingChange:N,onToneChange:function(e){N("Tone",e),f(e)},persona:t.TitleSuggestionsSettings.Persona,tone:t.TitleSuggestionsSettings.Tone}),(0,s.jsx)("div",{className:"title-suggestions-generate",children:(0,s.jsxs)(i.Button,{variant:"primary",isBusy:w,disabled:w||"custom"===d||"custom"===y,onClick:function(){return Ht(void 0,void 0,void 0,(function(){return Ut(this,(function(e){switch(e.label){case 0:return u(void 0),!1!==w?[3,2]:(g.trackEvent("title_suggestions_generate_pressed",{request_more:_.length>0,total_titles:_.length,total_pinned:_.filter((function(e){return e.isPinned})).length,tone:d,persona:y}),[4,(t=it.PostTitle,n=A,r=d,s=y,Ht(void 0,void 0,void 0,(function(){var e,i,a;return Ut(this,(function(l){switch(l.label){case 0:return[4,E(!0)];case 1:l.sent(),e=new Gt,l.label=2;case 2:return l.trys.push([2,5,,6]),[4,e.generateTitles(n,3,r,s)];case 3:return i=l.sent(),[4,T(t,i)];case 4:return l.sent(),[3,6];case 5:return a=l.sent(),u(a),T(t,[]),[3,6];case 6:return[4,E(!1)];case 7:return l.sent(),[2]}}))})))]);case 1:e.sent(),e.label=2;case 2:return[2]}var t,n,r,s}))}))},children:[w&&(0,c.__)("Generating Titles…","wp-parsely"),!w&&x.length>0&&(0,c.__)("Generate More","wp-parsely"),!w&&0===x.length&&(0,c.__)("Generate Titles","wp-parsely")]})})]})})},$t=function(){return $t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},$t.apply(this,arguments)},qt=function(e){var t=e.trackToggle,n=j(),r=n.settings,a=n.setSettings;return(0,s.jsxs)(i.Panel,{children:[(0,s.jsx)(i.PanelBody,{title:(0,c.__)("Title Suggestions (Beta)","wp-parsely"),initialOpen:r.TitleSuggestionsSettings.Open,onToggle:function(e){a({TitleSuggestionsSettings:$t($t({},r.TitleSuggestionsSettings),{Open:e})}),t("title_suggestions",e)},children:(0,s.jsx)(M,{children:(0,s.jsx)(Wt,{})})}),(0,s.jsx)(i.PanelBody,{title:(0,c.__)("Smart Linking (Beta)","wp-parsely"),initialOpen:r.SmartLinkingOpen,onToggle:function(e){a({SmartLinkingOpen:e}),t("smart_linking",e)},children:(0,s.jsx)(M,{children:(0,s.jsx)(ee,{context:Q.ContentHelperSidebar})})}),(0,s.jsx)(i.PanelBody,{title:(0,c.__)("Related Posts","wp-parsely"),initialOpen:r.RelatedPostsOpen,onToggle:function(e){a({RelatedPostsOpen:e}),t("related_top_posts",e)},children:(0,s.jsx)(M,{children:(0,s.jsx)(gt,{})})})]})},Zt=function(){return Zt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},Zt.apply(this,arguments)},Kt=function(n){void 0===n&&(n="");var s,i={InitialTabName:"tools",PerformanceStatsSettings:{Period:e.Days7,VisiblePanels:["overview","categories","referrers"],VisibleDataPoints:["views","visitors","avgEngaged","recirculation"]},RelatedPostsFilterBy:r.Unavailable,RelatedPostsFilterValue:"",RelatedPostsMetric:t.Views,RelatedPostsOpen:!1,RelatedPostsPeriod:e.Days7,SmartLinkingMaxLinks:ie,SmartLinkingMaxLinkWords:ae,SmartLinkingOpen:!1,SmartLinkingSettingsOpen:!1,TitleSuggestionsSettings:{Open:!1,Tone:"neutral",Persona:"journalist",PinnedOpen:!0}};""===n&&(n=window.wpParselyContentHelperSettings);try{s=JSON.parse(n)}catch(e){return i}var a=Zt(Zt({},i),s);return"string"!=typeof a.InitialTabName&&(a.InitialTabName=i.InitialTabName),"object"!=typeof a.PerformanceStatsSettings&&(a.PerformanceStatsSettings=i.PerformanceStatsSettings),T(a.PerformanceStatsSettings.Period,e)||(a.PerformanceStatsSettings.Period=i.PerformanceStatsSettings.Period),Array.isArray(a.PerformanceStatsSettings.VisiblePanels)||(a.PerformanceStatsSettings.VisiblePanels=i.PerformanceStatsSettings.VisiblePanels),Array.isArray(a.PerformanceStatsSettings.VisibleDataPoints)||(a.PerformanceStatsSettings.VisibleDataPoints=i.PerformanceStatsSettings.VisibleDataPoints),T(a.RelatedPostsFilterBy,r)||(a.RelatedPostsFilterBy=i.RelatedPostsFilterBy),"string"!=typeof a.RelatedPostsFilterValue&&(a.RelatedPostsFilterValue=i.RelatedPostsFilterValue),T(a.RelatedPostsMetric,t)||(a.RelatedPostsMetric=i.RelatedPostsMetric),"boolean"!=typeof a.RelatedPostsOpen&&(a.RelatedPostsOpen=i.RelatedPostsOpen),T(a.RelatedPostsPeriod,e)||(a.RelatedPostsPeriod=i.RelatedPostsPeriod),"number"!=typeof a.SmartLinkingMaxLinks&&(a.SmartLinkingMaxLinks=i.SmartLinkingMaxLinks),"number"!=typeof a.SmartLinkingMaxLinkWords&&(a.SmartLinkingMaxLinkWords=i.SmartLinkingMaxLinkWords),"boolean"!=typeof a.SmartLinkingOpen&&(a.SmartLinkingOpen=i.SmartLinkingOpen),"boolean"!=typeof a.SmartLinkingSettingsOpen&&(a.SmartLinkingSettingsOpen=i.SmartLinkingSettingsOpen),"object"!=typeof a.TitleSuggestionsSettings&&(a.TitleSuggestionsSettings=i.TitleSuggestionsSettings),"boolean"!=typeof a.TitleSuggestionsSettings.Open&&(a.TitleSuggestionsSettings.Open=i.TitleSuggestionsSettings.Open),"string"!=typeof a.TitleSuggestionsSettings.Tone&&(a.TitleSuggestionsSettings.Tone=i.TitleSuggestionsSettings.Tone),"string"!=typeof a.TitleSuggestionsSettings.Persona&&(a.TitleSuggestionsSettings.Persona=i.TitleSuggestionsSettings.Persona),"boolean"!=typeof a.TitleSuggestionsSettings.PinnedOpen&&(a.TitleSuggestionsSettings.PinnedOpen=i.TitleSuggestionsSettings.PinnedOpen),a},Yt=function(){var e=j(),t=e.settings,n=e.setSettings,r=(0,a.useSelect)((function(e){return e("core/interface").getActiveComplementaryArea("core/edit-post")}),[]);(0,o.useEffect)((function(){"wp-parsely-block-editor-sidebar/wp-parsely-content-helper"===r&&g.trackEvent("editor_sidebar_opened")}),[r]);var u=function(e,t){t?g.trackEvent("editor_sidebar_panel_opened",{panel:e}):g.trackEvent("editor_sidebar_panel_closed",{panel:e})};return(0,s.jsx)(l.PluginSidebar,{icon:(0,s.jsx)(y,{className:"wp-parsely-sidebar-icon"}),name:"wp-parsely-content-helper",className:"wp-parsely-content-helper",title:(0,c.__)("Parse.ly","wp-parsely"),children:(0,s.jsx)(k,{endpoint:"editor-sidebar-settings",defaultSettings:Kt(),children:(0,s.jsx)(i.Panel,{className:"wp-parsely-sidebar-main-panel",children:(0,s.jsx)(i.TabPanel,{className:"wp-parsely-sidebar-tabs",initialTabName:t.InitialTabName,tabs:[{icon:(0,s.jsx)(h,{}),name:"tools",title:(0,c.__)("Tools","wp-parsely")},{icon:d,name:"performance",title:(0,c.__)("Performance","wp-parsely")}],onSelect:function(e){n(Zt(Zt({},t),{InitialTabName:e})),g.trackEvent("editor_sidebar_tab_selected",{tab:e})},children:function(e){return(0,s.jsxs)(s.Fragment,{children:["tools"===e.name&&(0,s.jsx)(qt,{trackToggle:u}),"performance"===e.name&&(0,s.jsx)(qe,{period:t.PerformanceStatsSettings.Period})]})}})})})})};(0,f.registerPlugin)("wp-parsely-block-editor-sidebar",{icon:y,render:function(){return(0,s.jsx)(k,{endpoint:"editor-sidebar-settings",defaultSettings:Kt(),children:(0,s.jsx)(Yt,{})})}}),(0,N.addFilter)("editor.BlockEdit","wpparsely/smart-linking-inspector-control-panel",ce),(0,N.addFilter)("editor.BlockEdit","wpparsely/block-overlay",re),(0,f.registerPlugin)("wp-parsely-block-overlay",{render:function(){return(0,a.useSelect)((function(e){return{overlayBlocks:(0,e(z).getOverlayBlocks)()}}),[]).overlayBlocks.includes("all")?(0,s.jsx)(ne,{label:(0,c.__)("Generating Smart Links…","wp-parsely"),selectedBlockClientId:"all"}):(0,s.jsx)(s.Fragment,{})}})}()}();