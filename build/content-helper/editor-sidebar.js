!function(){"use strict";var e={251:function(e,t,n){var r=n(196),i=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,s={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,r)&&!l.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:s,_owner:o.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},893:function(e,t,n){e.exports=n(251)},196:function(e){e.exports=window.React}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){n.d({},{W:function(){return Sn}});var e,t,r,i=n(893),s=window.wp.components,a=window.wp.data,o=window.wp.editPost,l=window.wp.element,c=window.wp.i18n,u=n(196),p=window.wp.primitives,d=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{fillRule:"evenodd",d:"M11.25 5h1.5v15h-1.5V5zM6 10h1.5v10H6V10zm12 4h-1.5v6H18v-6z",clipRule:"evenodd"})),f=window.wp.plugins,h=function(){function e(){this._tkq=[],this.isLoaded=!1,this.isEnabled=!1,"undefined"!=typeof wpParselyTracksTelemetry&&(this.isEnabled=!0,this.loadTrackingLibrary())}return e.getInstance=function(){return window.wpParselyTelemetryInstance||Object.defineProperty(window,"wpParselyTelemetryInstance",{value:new e,writable:!1,configurable:!1,enumerable:!1}),window.wpParselyTelemetryInstance},e.prototype.loadTrackingLibrary=function(){var e=this,t=document.createElement("script");t.async=!0,t.src="//stats.wp.com/w.js",t.onload=function(){e.isLoaded=!0,e._tkq=window._tkq||[]},document.head.appendChild(t)},e.trackEvent=function(t){return n=this,r=arguments,s=function(t,n){var r;return void 0===n&&(n={}),function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}(this,(function(i){switch(i.label){case 0:return(r=e.getInstance()).isTelemetryEnabled()?[4,e.waitUntilLoaded()]:[2];case 1:return i.sent(),r.trackEvent(t,n),[2]}}))},new((i=void 0)||(i=Promise))((function(e,t){function a(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,o)}l((s=s.apply(n,r||[])).next())}));var n,r,i,s},e.waitUntilLoaded=function(){return new Promise((function(t,n){var r=e.getInstance();if(r.isTelemetryEnabled())if(r.isLoaded)t();else var i=0,s=setInterval((function(){r.isLoaded&&(clearInterval(s),t()),(i+=100)>=1e4&&(clearInterval(s),n("Telemetry library not loaded"))}),100);else n("Telemetry not enabled")}))},e.prototype.trackEvent=function(t,n){var r;this.isLoaded?(0!==t.indexOf(e.TRACKS_PREFIX)&&(t=e.TRACKS_PREFIX+t),this.isEventNameValid(t)?(n=this.prepareProperties(n),null===(r=this._tkq)||void 0===r||r.push(["recordEvent",t,n])):console.error("Error tracking event: Invalid event name")):console.error("Error tracking event: Telemetry not loaded")},e.prototype.isTelemetryEnabled=function(){return this.isEnabled},e.prototype.isProprietyValid=function(t){return e.PROPERTY_REGEX.test(t)},e.prototype.isEventNameValid=function(t){return e.EVENT_NAME_REGEX.test(t)},e.prototype.prepareProperties=function(e){return(e=this.sanitizeProperties(e)).parsely_version=wpParselyTracksTelemetry.version,wpParselyTracksTelemetry.user&&(e._ut=wpParselyTracksTelemetry.user.type,e._ui=wpParselyTracksTelemetry.user.id),wpParselyTracksTelemetry.vipgo_env&&(e.vipgo_env=wpParselyTracksTelemetry.vipgo_env),this.sanitizeProperties(e)},e.prototype.sanitizeProperties=function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.isProprietyValid(r)&&(n[r]=e[r])})),n},e.TRACKS_PREFIX="wpparsely_",e.EVENT_NAME_REGEX=/^(([a-z0-9]+)_){2}([a-z0-9_]+)$/,e.PROPERTY_REGEX=/^[a-z_][a-z0-9_]*$/,e}(),g=(h.trackEvent,function(){return(0,i.jsx)(s.SVG,{"aria-hidden":"true",version:"1.1",viewBox:"0 0 15 15",width:"15",height:"15",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)(s.Path,{d:"M0 14.0025V11.0025L7.5 3.5025L10.5 6.5025L3 14.0025H0ZM12 5.0025L13.56 3.4425C14.15 2.8525 14.15 1.9025 13.56 1.3225L12.68 0.4425C12.09 -0.1475 11.14 -0.1475 10.56 0.4425L9 2.0025L12 5.0025Z"})})}),y=function(e){var t=e.size,n=void 0===t?24:t,r=e.className,a=void 0===r?"wp-parsely-icon":r;return(0,i.jsxs)(s.SVG,{className:a,height:n,viewBox:"0 0 60 65",width:n,xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)(s.Path,{fill:"#5ba745",d:"M23.72,51.53c0-.18,0-.34-.06-.52a13.11,13.11,0,0,0-2.1-5.53A14.74,14.74,0,0,0,19.12,43c-.27-.21-.5-.11-.51.22l-.24,3.42c0,.33-.38.35-.49,0l-1.5-4.8a1.4,1.4,0,0,0-.77-.78,23.91,23.91,0,0,0-3.1-.84c-1.38-.24-3.39-.39-3.39-.39-.34,0-.45.21-.25.49l2.06,3.76c.2.27,0,.54-.29.33l-4.51-3.6a3.68,3.68,0,0,0-2.86-.48c-1,.16-2.44.46-2.44.46a.68.68,0,0,0-.39.25.73.73,0,0,0-.14.45S.41,43,.54,44a3.63,3.63,0,0,0,1.25,2.62L6.48,50c.28.2.09.49-.23.37l-4.18-.94c-.32-.12-.5,0-.4.37,0,0,.69,1.89,1.31,3.16a24,24,0,0,0,1.66,2.74,1.34,1.34,0,0,0,1,.52l5,.13c.33,0,.41.38.1.48L7.51,58c-.31.1-.34.35-.07.55a14.29,14.29,0,0,0,3.05,1.66,13.09,13.09,0,0,0,5.9.5,25.13,25.13,0,0,0,4.34-1,9.55,9.55,0,0,1-.08-1.2,9.32,9.32,0,0,1,3.07-6.91"}),(0,i.jsx)(s.Path,{fill:"#5ba745",d:"M59.7,41.53a.73.73,0,0,0-.14-.45.68.68,0,0,0-.39-.25s-1.43-.3-2.44-.46a3.64,3.64,0,0,0-2.86.48l-4.51,3.6c-.26.21-.49-.06-.29-.33l2.06-3.76c.2-.28.09-.49-.25-.49,0,0-2,.15-3.39.39a23.91,23.91,0,0,0-3.1.84,1.4,1.4,0,0,0-.77.78l-1.5,4.8c-.11.32-.48.3-.49,0l-.24-3.42c0-.33-.24-.43-.51-.22a14.74,14.74,0,0,0-2.44,2.47A13.11,13.11,0,0,0,36.34,51c0,.18,0,.34-.06.52a9.26,9.26,0,0,1,3,8.1,24.1,24.1,0,0,0,4.34,1,13.09,13.09,0,0,0,5.9-.5,14.29,14.29,0,0,0,3.05-1.66c.27-.2.24-.45-.07-.55l-3.22-1.17c-.31-.1-.23-.47.1-.48l5-.13a1.38,1.38,0,0,0,1-.52A24.6,24.6,0,0,0,57,52.92c.61-1.27,1.31-3.16,1.31-3.16.1-.33-.08-.49-.4-.37l-4.18.94c-.32.12-.51-.17-.23-.37l4.69-3.34A3.63,3.63,0,0,0,59.46,44c.13-1,.24-2.47.24-2.47"}),(0,i.jsx)(s.Path,{fill:"#5ba745",d:"M46.5,25.61c0-.53-.35-.72-.8-.43l-4.86,2.66c-.45.28-.56-.27-.23-.69l4.66-6.23a2,2,0,0,0,.28-1.68,36.51,36.51,0,0,0-2.19-4.89,34,34,0,0,0-2.81-3.94c-.33-.41-.74-.35-.91.16l-2.28,5.68c-.16.5-.6.48-.59-.05l.28-8.93a2.54,2.54,0,0,0-.66-1.64S35,4.27,33.88,3.27,30.78.69,30.78.69a1.29,1.29,0,0,0-1.54,0s-1.88,1.49-3.12,2.59-2.48,2.35-2.48,2.35A2.5,2.5,0,0,0,23,7.27l.27,8.93c0,.53-.41.55-.58.05l-2.29-5.69c-.17-.5-.57-.56-.91-.14a35.77,35.77,0,0,0-3,4.2,35.55,35.55,0,0,0-2,4.62,2,2,0,0,0,.27,1.67l4.67,6.24c.33.42.23,1-.22.69l-4.87-2.66c-.45-.29-.82-.1-.82.43a18.6,18.6,0,0,0,.83,5.07,20.16,20.16,0,0,0,5.37,7.77c3.19,3,5.93,7.8,7.45,11.08A9.6,9.6,0,0,1,30,49.09a9.31,9.31,0,0,1,2.86.45c1.52-3.28,4.26-8.11,7.44-11.09a20.46,20.46,0,0,0,5.09-7,19,19,0,0,0,1.11-5.82"}),(0,i.jsx)(s.Path,{fill:"#5ba745",d:"M36.12,58.44A6.12,6.12,0,1,1,30,52.32a6.11,6.11,0,0,1,6.12,6.12"})]})},v=function(){return v=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},v.apply(this,arguments)},m={},w="wp-parsely/settings",_=(0,a.createReduxStore)(w,{initialState:m,reducer:function(e,t){var n,r;switch(void 0===e&&(e=m),t.type){case"SET_SETTINGS":return v(v({},e),((n={})[t.endpoint]=t.settings,n));case"SET_PARTIAL_SETTINGS":var i=e[t.endpoint]||{},s=v(v({},i),t.partialSettings);return v(v({},e),((r={})[t.endpoint]=s,r));default:return e}},actions:{setSettings:function(e,t){return{type:"SET_SETTINGS",endpoint:e,settings:t}},setPartialSettings:function(e,t){return{type:"SET_PARTIAL_SETTINGS",endpoint:e,partialSettings:t}}},selectors:{getSettings:function(e,t){return e[t]}}}),b=window.wp.apiFetch,x=n.n(b),k=function(){return k=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},k.apply(this,arguments)},S=(0,l.createContext)({settings:{},setSettings:function(){console.error("WP Parse.ly: setSettings not implemented")}}),P=function(){var e=(0,l.useContext)(S);if(void 0===e)throw new Error("useSettings must be used within a SettingsProvider");return e},j=function(e){var t=e.children,n=e.endpoint,r=e.defaultSettings,s=(0,a.useSelect)((function(e){var t=e(_).getSettings(n);return t||(t=r,(0,a.dispatch)(_).setSettings(n,r).then((function(){}))),{storedSettings:t}}),[r,n]).storedSettings,o=(0,l.useState)(s),c=o[0],u=o[1],p=(0,a.dispatch)(_).setPartialSettings,d=(0,l.useCallback)((function(e){u((function(t){return k(k({},t),e)})),p(n,e)}),[n,p]);!function(e,t,n){var r=(0,l.useRef)(!0);(0,l.useEffect)((function(){r.current?r.current=!1:x()({path:"/wp-parsely/v1/user-meta/content-helper/"+e,method:"PUT",data:t})}),n)}(n,s,[c]);var f=(0,l.useMemo)((function(){return{settings:s,setSettings:d}}),[s,d]);return(0,i.jsx)(S.Provider,{value:f,children:t})};void 0!==(0,a.select)(w)||(0,a.register)(_),function(e){e.Minutes10="10m",e.Hour="1h",e.Hours2="2h",e.Hours4="4h",e.Hours24="24h",e.Days7="7d",e.Days30="30d"}(e||(e={})),function(e){e.Views="views",e.AvgEngaged="avg_engaged"}(t||(t={})),function(e){e.Author="author",e.Section="section",e.Tag="tag",e.Unavailable="unavailable"}(r||(r={}));var T=function(e,t){return Object.values(t).includes(e)};function E(e,t){void 0===t&&(t=!1);var n=parseInt(e,10),r=e.charAt(e.length-1),i=(0,c.__)("Unknown Period","wp-parsely");switch(r){case"m":if(1===n){i=(0,c.__)("Last Minute","wp-parsely");break}i=(0,c.sprintf)(/* translators: 1: Number of minutes */(0,c._n)("Last %1$d Minute","Last %1$d Minutes",n,"wp-parsely"),n);break;case"h":if(1===n){i=(0,c.__)("Last Hour","wp-parsely");break}i=(0,c.sprintf)(/* translators: 1: Number of hours */(0,c._n)("Last %1$d Hour","Last %1$d Hours",n,"wp-parsely"),n);break;case"d":if(1===n){i=(0,c.__)("Last Day","wp-parsely");break}i=(0,c.sprintf)(/* translators: 1: Number of days */(0,c._n)("Last %1$d Day","Last %1$d Days",n,"wp-parsely"),n)}return t?i.toLocaleLowerCase():i}function L(e){switch(e){case t.Views:return(0,c.__)("Page Views","wp-parsely");case t.AvgEngaged:return(0,c.__)("Avg. Time","wp-parsely");default:return(0,c.__)("Unknown Metric","wp-parsely")}}var C,N,A=window.wp.blockEditor,O=window.wp.compose,R=window.wp.hooks,I=function(e){void 0===e&&(e=null);var t="";(null==e?void 0:e.children)&&(t=e.children);var n="content-helper-error-message";return(null==e?void 0:e.className)&&(n+=" "+e.className),(0,i.jsx)("div",{className:n,"data-testid":null==e?void 0:e.testId,dangerouslySetInnerHTML:{__html:t}})},B=function(e){var t;return void 0===e&&(e=null),(0,i.jsx)(I,{className:null==e?void 0:e.className,testId:"empty-credentials-message",children:null!==(t=window.wpParselyEmptyCredentialsMessage)&&void 0!==t?t:(0,c.__)("Please ensure that the Site ID and API Secret given in the plugin's settings are correct.","wp-parsely")})},M=function(){return M=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},M.apply(this,arguments)},D=function(e,t){var n=e.children;return void 0===t&&(t=null),window.wpParselyEmptyCredentialsMessage?(0,i.jsx)(B,M({},t)):(0,i.jsx)(i.Fragment,{children:n})},V=window.wp.blocks,F=(0,l.forwardRef)((function({icon:e,size:t=24,...n},r){return(0,l.cloneElement)(e,{width:t,height:t,...n,ref:r})})),G=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M19.5 4.5h-7V6h4.44l-5.97 5.97 1.06 1.06L18 7.06v4.44h1.5v-7Zm-13 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-3H17v3a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h3V5.5h-3Z"})),H=(C=function(e,t){return C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},C(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function __(){this.constructor=e}C(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)});!function(e){e.CannotFormulateApiQuery="ch_cannot_formulate_api_query",e.FetchError="fetch_error",e.HttpRequestFailed="http_request_failed",e.ParselyAborted="ch_parsely_aborted",e[e.ParselyApiForbidden=403]="ParselyApiForbidden",e.ParselyApiResponseContainsError="ch_response_contains_error",e.ParselyApiReturnedNoData="ch_parsely_api_returned_no_data",e.ParselyApiReturnedTooManyResults="ch_parsely_api_returned_too_many_results",e.PluginCredentialsNotSetMessageDetected="parsely_credentials_not_set_message_detected",e.PluginSettingsApiSecretNotSet="parsely_api_secret_not_set",e.PluginSettingsSiteIdNotSet="parsely_site_id_not_set",e.PostIsNotPublished="ch_post_not_published",e.ParselySuggestionsApiAuthUnavailable="AUTH_UNAVAILABLE",e.ParselySuggestionsApiNoAuthentication="NO_AUTHENTICATION",e.ParselySuggestionsApiNoAuthorization="NO_AUTHORIZATION",e.ParselySuggestionsApiNoData="NO_DATA",e.ParselySuggestionsApiOpenAiError="OPENAI_ERROR",e.ParselySuggestionsApiOpenAiSchema="OPENAI_SCHEMA",e.ParselySuggestionsApiOpenAiUnavailable="OPENAI_UNAVAILABLE",e.ParselySuggestionsApiSchemaError="SCHEMA_ERROR"}(N||(N={}));var z=function(e){function t(n,r,i){void 0===i&&(i=(0,c.__)("Error: ","wp-parsely"));var s=e.call(this,i+n)||this;s.hint=null,s.name=s.constructor.name,s.code=r;var a=[N.ParselyApiForbidden,N.ParselyApiResponseContainsError,N.ParselyApiReturnedNoData,N.ParselyApiReturnedTooManyResults,N.PluginCredentialsNotSetMessageDetected,N.PluginSettingsApiSecretNotSet,N.PluginSettingsSiteIdNotSet,N.PostIsNotPublished,N.ParselySuggestionsApiAuthUnavailable,N.ParselySuggestionsApiNoAuthentication,N.ParselySuggestionsApiNoAuthorization,N.ParselySuggestionsApiNoData,N.ParselySuggestionsApiSchemaError];return s.retryFetch=!a.includes(s.code),Object.setPrototypeOf(s,t.prototype),s.code===N.ParselySuggestionsApiNoAuthorization?s.message=(0,c.__)('This AI-powered feature is opt-in. To gain access, please submit a request <a href="https://wpvip.com/parsely-content-helper/" target="_blank" rel="noreferrer">here</a>.',"wp-parsely"):s.code===N.ParselySuggestionsApiOpenAiError||s.code===N.ParselySuggestionsApiOpenAiUnavailable?s.message=(0,c.__)("The Parse.ly API returned an internal server error. Please retry with a different input, or try again later.","wp-parsely"):s.code===N.HttpRequestFailed&&s.message.includes("cURL error 28")?s.message=(0,c.__)("The Parse.ly API did not respond in a timely manner. Please try again later.","wp-parsely"):s.code===N.ParselySuggestionsApiSchemaError?s.message=(0,c.__)("The Parse.ly API returned a validation error. Please try again with different parameters.","wp-parsely"):s.code===N.ParselySuggestionsApiNoData?s.message=(0,c.__)("The Parse.ly API couldn't find any relevant data to fulfill the request. Please retry with a different input.","wp-parsely"):s.code===N.ParselySuggestionsApiOpenAiSchema?s.message=(0,c.__)("The Parse.ly API returned an incorrect response. Please try again later.","wp-parsely"):s.code===N.ParselySuggestionsApiAuthUnavailable&&(s.message=(0,c.__)("The Parse.ly API is currently unavailable. Please try again later.","wp-parsely")),s}return H(t,e),t.prototype.Message=function(e){return void 0===e&&(e=null),[N.PluginCredentialsNotSetMessageDetected,N.PluginSettingsSiteIdNotSet,N.PluginSettingsApiSecretNotSet].includes(this.code)?B(e):(this.code===N.FetchError&&(this.hint=this.Hint((0,c.__)("This error can sometimes be caused by ad-blockers or browser tracking protections. Please add this site to any applicable allow lists and try again.","wp-parsely"))),this.code!==N.ParselyApiForbidden&&this.code!==N.ParselySuggestionsApiNoAuthentication||(this.hint=this.Hint((0,c.__)("Please ensure that the Site ID and API Secret given in the plugin's settings are correct.","wp-parsely"))),this.code===N.HttpRequestFailed&&(this.hint=this.Hint((0,c.__)("The Parse.ly API cannot be reached. Please verify that you are online.","wp-parsely"))),(0,i.jsx)(I,{className:null==e?void 0:e.className,testId:"error",children:"<p>".concat(this.message,"</p>").concat(this.hint?this.hint:"")}))},t.prototype.Hint=function(e){return'<p className="content-helper-error-message-hint" data-testid="content-helper-error-message-hint"><strong>'.concat((0,c.__)("Hint:","wp-parsely"),"</strong> ").concat(e,"</p>")},t}(Error);function W(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var U=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function Z(e,t){for(var n=e.parentNode;n;){if(n.nodeName===t.nodeName)return!0;n=n.parentNode}return!1}function q(e,t,n){var r=(0,V.getBlockContent)(e),i=(new DOMParser).parseFromString(r,"text/html").body.firstChild;if(i){var s=function(e,t,n){for(var r=[],i=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);i.nextNode();){var s=i.currentNode;s.textContent&&s.textContent.includes(t)&&!Z(s,n)&&r.push(s)}return r}(i,t.text,n),a=0,o=!1;s.forEach((function(e){var r,i;if(e.textContent&&!Z(e,n)&&!o)for(var s,l=new RegExp(W(t.text),"g");null!==(s=l.exec(e.textContent));){if(a===(null===(r=t.match)||void 0===r?void 0:r.blockOffset)){var c=n.cloneNode(!0);c.textContent=s[0];var u=document.createRange();if(u.setStart(e,s.index),u.setEnd(e,s.index+s[0].length),u.deleteContents(),u.insertNode(c),e.textContent&&s.index+s[0].length<e.textContent.length){var p=document.createTextNode(e.textContent.slice(s.index+s[0].length));null===(i=e.parentNode)||void 0===i||i.insertBefore(p,c.nextSibling)}return void(o=!0)}a++}})),e.attributes.content=i.innerHTML}}function $(e){var t=e.filter((function(e){return e.applied})),n=e.filter((function(e){return!e.applied})),r=function(e,t){return e.match.blockPosition===t.match.blockPosition?e.match.blockOffset-t.match.blockOffset:e.match.blockPosition-t.match.blockPosition};return t.sort(r),n.sort(r),U(U([],n,!0),t,!0)}var K,Y=function(){return Y=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Y.apply(this,arguments)},Q=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};!function(e){e.All="all",e.Selected="selected"}(K||(K={}));var X={isLoading:!1,applyTo:null,fullContent:!1,smartLinks:[],error:null,settings:{},overlayBlocks:[],wasAlreadyClicked:!1,isRetrying:!1,retryAttempt:0},J=(0,a.createReduxStore)("wp-parsely/smart-linking",{initialState:X,reducer:function(e,t){switch(void 0===e&&(e=X),t.type){case"SET_LOADING":return Y(Y({},e),{isLoading:t.isLoading});case"SET_OVERLAY_BLOCKS":return Y(Y({},e),{overlayBlocks:t.overlayBlocks});case"SET_ERROR":return Y(Y({},e),{error:t.error});case"ADD_OVERLAY_BLOCK":return Y(Y({},e),{overlayBlocks:Q(Q([],e.overlayBlocks,!0),[t.block],!1)});case"REMOVE_OVERLAY_BLOCK":return"all"===t.block?Y(Y({},e),{overlayBlocks:[]}):Y(Y({},e),{overlayBlocks:e.overlayBlocks.filter((function(e){return e!==t.block}))});case"SET_FULL_CONTENT":return Y(Y({},e),{fullContent:t.fullContent});case"SET_SETTINGS":return Y(Y({},e),{settings:Y(Y({},e.settings),t.settings)});case"SET_WAS_ALREADY_CLICKED":return Y(Y({},e),{wasAlreadyClicked:t.wasAlreadyClicked});case"SET_APPLY_TO":return Y(Y({},e),{applyTo:t.applyTo});case"SET_IS_RETRYING":return Y(Y({},e),{isRetrying:t.isRetrying,retryAttempt:t.isRetrying===e.isRetrying?e.retryAttempt:0});case"INCREMENT_RETRY_ATTEMPT":return Y(Y({},e),{retryAttempt:e.retryAttempt+1});case"SET_SMART_LINKS":return Y(Y({},e),{smartLinks:$(t.smartLinks)});case"ADD_SMART_LINK":var n=e.smartLinks.findIndex((function(e){return e.uid===t.smartLink.uid}));if(-1!==n){var r=Q([],e.smartLinks,!0);return r[n]=t.smartLink,Y(Y({},e),{smartLinks:$(r)})}return Y(Y({},e),{smartLinks:$(Q(Q([],e.smartLinks,!0),[t.smartLink],!1))});case"ADD_SMART_LINKS":var i=Q([],e.smartLinks,!0);return t.smartLinks.forEach((function(t){var n=e.smartLinks.findIndex((function(e){return e.uid===t.uid}));-1!==n?i[n]=t:i.push(t)})),Y(Y({},e),{smartLinks:$(i)});case"REMOVE_SMART_LINK":return Y(Y({},e),{smartLinks:$(e.smartLinks.filter((function(e){return e.uid!==t.uid})))});case"PURGE_SMART_LINKS_SUGGESTIONS":return Y(Y({},e),{smartLinks:$(e.smartLinks.filter((function(e){return e.applied})))});default:return e}},actions:{setLoading:function(e){return{type:"SET_LOADING",isLoading:e}},setOverlayBlocks:function(e){return{type:"SET_OVERLAY_BLOCKS",overlayBlocks:e}},setError:function(e){return{type:"SET_ERROR",error:e}},addOverlayBlock:function(e){return{type:"ADD_OVERLAY_BLOCK",block:e}},removeOverlayBlock:function(e){return{type:"REMOVE_OVERLAY_BLOCK",block:e}},setFullContent:function(e){return{type:"SET_FULL_CONTENT",fullContent:e}},setSmartLinkingSettings:function(e){return{type:"SET_SETTINGS",settings:e}},setMaxLinkWords:function(e){return{type:"SET_SETTINGS",settings:{maxLinkWords:e}}},setMaxLinks:function(e){return{type:"SET_SETTINGS",settings:{maxLinksPerPost:e}}},setAlreadyClicked:function(e){return{type:"SET_WAS_ALREADY_CLICKED",wasAlreadyClicked:e}},setApplyTo:function(e){return{type:"SET_APPLY_TO",applyTo:e}},setIsRetrying:function(e){return{type:"SET_IS_RETRYING",isRetrying:e}},incrementRetryAttempt:function(){return{type:"INCREMENT_RETRY_ATTEMPT"}},setSmartLinks:function(e){return{type:"SET_SMART_LINKS",smartLinks:e}},addSmartLink:function(e){return{type:"ADD_SMART_LINK",smartLink:e}},updateSmartLink:function(e){return{type:"ADD_SMART_LINK",smartLink:e}},addSmartLinks:function(e){return{type:"ADD_SMART_LINKS",smartLinks:e}},removeSmartLink:function(e){return{type:"REMOVE_SMART_LINK",uid:e}},purgeSmartLinksSuggestions:function(){return{type:"PURGE_SMART_LINKS_SUGGESTIONS"}}},selectors:{isLoading:function(e){return e.isLoading},isFullContent:function(e){return e.fullContent},getApplyTo:function(e){return e.applyTo},getError:function(e){return e.error},getSmartLinkingSettings:function(e){return e.settings},getOverlayBlocks:function(e){return e.overlayBlocks},getMaxLinkWords:function(e){var t;return null!==(t=e.settings.maxLinkWords)&&void 0!==t?t:Ae},getMaxLinks:function(e){var t;return null!==(t=e.settings.maxLinksPerPost)&&void 0!==t?t:Ne},getSuggestedLinks:function(e){return e.smartLinks.filter((function(e){return!e.applied}))},wasAlreadyClicked:function(e){return e.wasAlreadyClicked},isRetrying:function(e){return e.isRetrying},getRetryAttempt:function(e){return e.retryAttempt},hasUnappliedLinks:function(e){return e.smartLinks.some((function(e){return!e.applied}))},getSmartLinks:function(e){return e.smartLinks}}});(0,a.register)(J);var ee,te=function(e){var t=e.activeLink,n=e.links,r=e.setSelectedLink;return(0,i.jsx)("div",{className:"smart-linking-review-sidebar",children:(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"review-sidebar-header",children:["Outbound Smart Links",(0,i.jsx)("span",{children:null==n?void 0:n.length})]}),null==n?void 0:n.map((function(e){return(0,i.jsx)(s.MenuItem,{className:(null==t?void 0:t.uid)===e.uid?"is-selected":"",role:"menuitemradio",shortcut:e.applied?void 0:"NEW",isSelected:(null==t?void 0:t.uid)===e.uid,onClick:function(){r(e)},children:e.text},e.uid)}))]})})},ne=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M15.5 7.5h-7V9h7V7.5Zm-7 3.5h7v1.5h-7V11Zm7 3.5h-7V16h7v-1.5Z"}),(0,u.createElement)(p.Path,{d:"M17 4H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2ZM7 5.5h10a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5H7a.5.5 0 0 1-.5-.5V6a.5.5 0 0 1 .5-.5Z"})),re=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M20 11.2H6.8l3.7-3.7-1-1L3.9 12l5.6 5.5 1-1-3.7-3.7H20z"})),ie=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M12 13.06l3.712 3.713 1.061-1.06L13.061 12l3.712-3.712-1.06-1.06L12 10.938 8.288 7.227l-1.061 1.06L10.939 12l-3.712 3.712 1.06 1.061L12 13.061z"})),se=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M16.7 7.1l-6.3 8.5-3.3-2.5-.9 1.2 4.5 3.4L17.9 8z"})),ae=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"m14.5 6.5-1 1 3.7 3.7H4v1.6h13.2l-3.7 3.7 1 1 5.6-5.5z"})),oe=window.wp.url,le=function(){return le=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},le.apply(this,arguments)},ce=function(e){var t,n,r,s,o=null===(t=e.link.match)||void 0===t?void 0:t.blockId,l=(0,a.useSelect)((function(e){var t=e("core/block-editor"),n=t.getBlock,r=t.getBlockParents;return o?{block:n(o),parents:r(o).map((function(e){return n(e)})).filter((function(e){return void 0!==e}))}:{block:void 0,parents:[]}}),[o]),c=l.block,u=l.parents;return c?(0,i.jsxs)("div",{className:"review-suggestions-breadcrumbs",children:[u.map((function(e,t){var n;return(0,i.jsxs)("span",{children:[(0,i.jsx)("span",{className:"breadcrumbs-parent-block",children:null===(n=(0,V.getBlockType)(e.name))||void 0===n?void 0:n.title}),(0,i.jsx)("span",{className:"breadcrumbs-parent-separator",children:" / "})]},t)})),(0,i.jsxs)("span",{className:"breadcrumbs-current-block",children:[(0,i.jsx)("span",{className:"breadcrumbs-current-block-type",children:null===(n=(0,V.getBlockType)(c.name))||void 0===n?void 0:n.title}),(null===(s=null===(r=c.attributes)||void 0===r?void 0:r.metadata)||void 0===s?void 0:s.name)&&(0,i.jsx)("span",{className:"breadcrumbs-current-block-name",children:c.attributes.metadata.name})]})]}):(0,i.jsx)(i.Fragment,{})},ue=function(e){var t=e.styles.filter((function(e){return("theme"===e.__unstableType||"user"===e.__unstableType)&&e.css}));return(0,i.jsx)(i.Fragment,{children:t.map((function(e,t){var n;return(0,i.jsx)("style",{children:null===(n=e.css)||void 0===n?void 0:n.replace(/body/g,".wp-parsely-preview-editor")},t)}))})},pe=function(e){var t=e.block,n=e.link,r=(0,l.useState)((0,V.cloneBlock)(t)),o=r[0],c=r[1];if((0,l.useEffect)((function(){c((0,V.cloneBlock)(t))}),[t,n]),(0,l.useEffect)((function(){var e=document.querySelector(".wp-parsely-preview-editor");if(e){var t,r,i;t=o,r=n,(i=document.createElement("mark")).className="smart-linking-highlight",q(t,r,i);var s=new MutationObserver((function(e){e.forEach((function(e){"childList"===e.type&&(s.disconnect(),e.addedNodes.forEach((function(e){if(e instanceof HTMLElement){var t=document.querySelector('.wp-parsely-preview-editor [data-block="'.concat(o.clientId,'"]'));t&&t.setAttribute("contenteditable","false")}})),s.observe(document.body,{childList:!0,subtree:!0}))}))}));return s.observe(e,{childList:!0,subtree:!0}),function(){return s.disconnect()}}}),[o,n]),!t)return(0,i.jsx)(i.Fragment,{});var u=(0,a.select)("core/block-editor").getSettings();return(0,i.jsx)(s.Disabled,{className:"wp-block-post-content editor-styles-wrapper wp-parsely-preview-editor",children:(0,i.jsxs)(A.BlockEditorProvider,{value:[o],settings:le(le({},u),{__unstableIsPreviewMode:!0,templateLock:"all"}),children:[(0,i.jsx)(ue,{styles:u.styles}),(0,i.jsx)(A.BlockList,{})]})})},de=function(e){var t=e.link,n=(0,oe.filterURLForDisplay)(t.href,30);return(0,i.jsx)(s.MenuItem,{info:n,iconPosition:"left",icon:ne,shortcut:"Page",className:"block-editor-link-control__search-item wp-parsely-link-suggestion-link-details",children:t.title})},fe=function(e){var t=e.link,n=e.onNext,r=e.onPrevious,o=e.onAccept,l=e.onReject,c=e.onRemove,u=e.onSelectInEditor,p=e.hasPrevious,d=e.hasNext;if(!(null==t?void 0:t.match))return(0,i.jsx)(i.Fragment,{children:"No match!"});var f=t.match.blockId,h=(0,a.select)("core/block-editor").getBlock(f),g=t.applied;return h?(0,i.jsxs)("div",{className:"smart-linking-review-suggestion",children:[(0,i.jsx)(ce,{link:t}),(0,i.jsx)("div",{className:"review-suggestion-preview",children:(0,i.jsx)(pe,{block:h,link:t})}),(0,i.jsx)(s.__experimentalDivider,{}),(0,i.jsx)(de,{link:t}),(0,i.jsxs)("div",{className:"review-controls",children:[(0,i.jsx)(s.Button,{disabled:!p,className:"wp-parsely-review-suggestion-previous",onClick:r,icon:re,children:"Previous"}),(0,i.jsxs)("div",{className:"reviews-controls-middle",children:[!g&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.Button,{className:"wp-parsely-review-suggestion-reject",icon:ie,onClick:l,variant:"secondary",children:"Reject"}),(0,i.jsx)(s.Button,{className:"wp-parsely-review-suggestion-accept",icon:se,onClick:o,variant:"secondary",children:"Accept"})]}),g&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.Button,{className:"wp-parsely-review-suggestion-reject",icon:ie,onClick:c,variant:"secondary",children:"Remove"}),(0,i.jsx)(s.Button,{className:"wp-parsely-review-suggestion-accept",onClick:u,variant:"secondary",children:"Select in Editor"})]})]}),(0,i.jsxs)(s.Button,{disabled:!d,onClick:n,className:"wp-parsely-review-suggestion-next",children:["Next",(0,i.jsx)(F,{icon:ae})]})]})]}):(0,i.jsx)(i.Fragment,{children:"No block!"})},he=(0,l.memo)((function(e){var t=e.onClose,n=e.isOpen,r=e.onAppliedLink,o=(0,l.useState)(!1),u=o[0],p=o[1],d=(0,l.useState)(n),f=d[0],h=d[1],g=((0,a.useSelect)((function(e){return{postId:(0,e("core/editor").getCurrentPostId)()}}),[]).postId,(0,a.useSelect)((function(e){var t=e(J),n=t.getSmartLinks,r=t.getSuggestedLinks;return{smartLinks:n(),suggestedLinks:r}}),[])),y=g.smartLinks,v=g.suggestedLinks,m=(0,l.useState)(y[0]),w=m[0],_=m[1],b=(0,a.useDispatch)(J),x=b.purgeSmartLinksSuggestions,k=b.updateSmartLink,S=b.removeSmartLink;(0,l.useEffect)((function(){f&&0===y.length?t():_(y[0])}),[f,t,y]),(0,l.useEffect)((function(){h(n)}),[n]);var P=function(){h(!1),y.filter((function(e){return!e.applied})).length>0?p(!0):x().then((function(){return t()}))},j=function(e){p(!1),e?(h(!1),x().then((function(){t()}))):h(!0)},T=function(){var e=y.indexOf(w)+1;y[e]&&_(y[e])},E=function(){var e=y.indexOf(w)-1;y[e]&&_(y[e])},L=function(){var e,t,n,i,s,o;w.match&&(r(w),(e=w.match.blockId,t=w,n=void 0,i=void 0,s=void 0,o=function(){var n,r;return function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}(this,(function(i){switch(i.label){case 0:return(n=document.createElement("a")).href=t.href,n.title=t.title,n.setAttribute("data-smartlink",t.uid),(r=(0,a.select)("core/block-editor").getBlock(e))?(t.applied=!0,[4,k(t)]):[2];case 1:return i.sent(),q(r,t,n),(0,a.dispatch)("core/block-editor").updateBlock(e,r),[2]}}))},new(s||(s=Promise))((function(e,t){function r(e){try{l(o.next(e))}catch(e){t(e)}}function a(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(r,a)}l((o=o.apply(n,i||[])).next())}))).then((function(){if(0!==v().length){var e=y.indexOf(w)+1;y[e]?_(y[e]):_(y[0])}else P()})))},C=function(){var e=y.indexOf(w)+1;y[e]?_(y[e]):y[0]?_(y[0]):P(),S(w.uid)},N=function(){if(w.match){var e=(0,a.select)("core/block-editor").getBlock(w.match.blockId);e&&function(e,t){var n,r=e.clientId;if(e){var i=(0,V.getBlockContent)(e),s=(new DOMParser).parseFromString(i,"text/html").body.firstChild;if(s){var o=Array.from(s.querySelectorAll('a[data-smartlink="'.concat(t.uid,'"]')));if(o.length>0){var l=o[0],c=l.parentNode;if(c){var u=document.createTextNode(null!==(n=l.textContent)&&void 0!==n?n:"");c.replaceChild(u,l),e.attributes.content=s.innerHTML,(0,a.dispatch)("core/block-editor").updateBlock(r,e)}}S(t.uid)}}}(e,w)}};return(0,i.jsxs)(i.Fragment,{children:[f&&(0,i.jsxs)(s.Modal,{title:(0,c.__)("Review Smart Links","wp-parsely"),className:"wp-parsely-smart-linking-review-modal",onRequestClose:P,shouldCloseOnClickOutside:!1,shouldCloseOnEsc:!1,children:[(0,i.jsx)(s.KeyboardShortcuts,{shortcuts:{left:E,right:T,up:E,down:T,a:function(){w&&!w.applied&&L()},r:function(){w&&(w.applied?N():C())}}}),(0,i.jsxs)("div",{className:"smart-linking-modal-body",children:[(0,i.jsx)(te,{links:y,activeLink:w,setSelectedLink:_}),(0,i.jsx)(fe,{link:w,hasNext:y.indexOf(w)<y.length-1,hasPrevious:y.indexOf(w)>0,onNext:T,onPrevious:E,onAccept:L,onReject:C,onRemove:N,onSelectInEditor:function(){if(w.match){var e=(0,a.select)("core/block-editor").getBlock(w.match.blockId);e&&((0,a.dispatch)("core/block-editor").selectBlock(e.clientId),P())}}})]})]}),u&&(0,i.jsxs)(s.Modal,{title:(0,c.__)("Review Smart Links","wp-parsely"),onRequestClose:function(){return j(!1)},className:"wp-parsely-smart-linking-close-dialog",children:[(0,c.__)("Are you sure you want to close? All un-accepted smart links will not be added.","wp-parsely"),(0,i.jsxs)("div",{className:"smart-linking-close-dialog-actions",children:[(0,i.jsx)(s.Button,{variant:"secondary",onClick:function(){return j(!1)},children:(0,c.__)("Go Back","wp-parsely")}),(0,i.jsx)(s.Button,{variant:"primary",onClick:function(){return j(!0)},children:(0,c.__)("Close","wp-parsely")})]})]})]})})),ge=function(e){var t=e.value,n=e.onChange,r=e.max,a=e.min,o=e.suffix,l=e.size,c=e.label,u=e.initialPosition,p=e.disabled,d=e.className;return(0,i.jsxs)("div",{className:"parsely-inputrange-control ".concat(d||""),children:[(0,i.jsx)(s.__experimentalHeading,{className:"parsely-inputrange-control__label",level:3,children:c}),(0,i.jsxs)("div",{className:"parsely-inputrange-control__controls",children:[(0,i.jsx)(s.__experimentalNumberControl,{disabled:p,value:t,suffix:(0,i.jsx)(s.__experimentalInputControlSuffixWrapper,{children:o}),size:null!=l?l:"__unstable-large",min:a,max:r,onChange:function(e){var t=parseInt(e,10);isNaN(t)||n(t)}}),(0,i.jsx)(s.RangeControl,{disabled:p,value:t,showTooltip:!1,initialPosition:u,onChange:function(e){n(e)},withInputField:!1,min:a,max:r})]})]})},ye=function(e){var t,n=e.disabled,r=void 0!==n&&n,o=e.selectedBlock,u=e.onSettingChange,p=(0,l.useRef)(),d=(0,l.useState)(""),f=d[0],h=d[1],g=(0,l.useState)(!1),y=g[0],v=g[1],m=(0,l.useState)(!1)[1],w=(0,a.useSelect)((function(e){var t=e(J),n=t.getMaxLinkWords,r=t.getMaxLinks,i=t.isFullContent,s=t.wasAlreadyClicked,a=t.getApplyTo;return{maxLinks:r(),maxLinkWords:n(),fullContent:i(),alreadyClicked:s(),applyTo:a()}}),[]),_=w.maxLinks,b=w.maxLinkWords,x=w.fullContent,k=w.alreadyClicked,S=w.applyTo,P=(0,a.useDispatch)(J),j=P.setMaxLinks,T=P.setMaxLinkWords,E=P.setFullContent,L=P.setAlreadyClicked,C=P.setApplyTo,N=null!==(t=S)&&void 0!==t?t:o?"selected":"all";return(0,l.useEffect)((function(){if(!r){var e=function(){r||(S===K.Selected&&setTimeout((function(){h((0,c.__)("No block selected. Select a block to apply smart links.","wp-parsely"))}),100),C(null),m((function(e){return!e})))};o||S===K.All||(y?setTimeout(e,500):e()),E(K.All===N)}}),[y,S,N,r,o,C,E,h]),(0,l.useEffect)((function(){if(!r&&p.current&&N&&!k&&o){var e=p.current.querySelector('button[data-value="'.concat(N,'"]'));e&&"true"!==e.getAttribute("aria-checked")&&(C(N),L(!0))}}),[o,x,r,S]),(0,l.useEffect)((function(){h(null)}),[o]),(0,i.jsx)("div",{className:"parsely-panel-settings",children:(0,i.jsxs)("div",{className:"parsely-panel-settings-body",children:[(0,i.jsxs)("div",{className:"smart-linking-block-select",children:[(0,i.jsx)(s.Disabled,{isDisabled:r,children:(0,i.jsxs)(s.__experimentalToggleGroupControl,{ref:p,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,isBlock:!0,value:N,label:(0,c.__)("Apply Smart Links to","wp-parsely"),onChange:function(e){return t=void 0,n=void 0,s=function(){return function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}(this,(function(t){switch(t.label){case 0:return r?[2]:(v(!0),[4,E(K.All===e)]);case 1:return t.sent(),[4,C(e)];case 2:return t.sent(),setTimeout((function(){v(!1)}),500),[2]}}))},new((i=void 0)||(i=Promise))((function(e,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,o)}l((s=s.apply(t,n||[])).next())}));var t,n,i,s},children:[(0,i.jsx)(s.__experimentalToggleGroupControlOption,{label:(0,c.__)("Selected Block","wp-parsely"),value:"selected"}),(0,i.jsx)(s.__experimentalToggleGroupControlOption,{label:(0,c.__)("All Blocks","wp-parsely"),value:"all"})]})}),f&&(0,i.jsxs)("div",{className:"wp-parsely-smart-linking-hint",children:[(0,i.jsx)("strong",{children:(0,c.__)("Hint:","wp-parsely")})," ",f]})]}),(0,i.jsxs)("div",{className:"smart-linking-settings",children:[(0,i.jsx)(ge,{value:_,onChange:function(e){j(null!=e?e:1),u("MaxLinks",null!=e?e:Ne)},label:(0,c.__)("Target Number of Links","wp-parsely"),suffix:(0,c.__)("Links","wp-parsely"),min:1,max:20,initialPosition:_,disabled:r}),(0,i.jsx)(ge,{value:b,onChange:function(e){T(null!=e?e:1),u("MaxLinkWords",null!=e?e:Ae)},label:(0,c.__)("Target Link Length","wp-parsely"),suffix:(0,c.__)("Words","wp-parsely"),min:1,max:8,initialPosition:b,disabled:r})]})]})})},ve=function(){function e(){this.abortControllers=new Map}return e.prototype.cancelRequest=function(e){if(e)(t=this.abortControllers.get(e))&&(t.abort(),this.abortControllers.delete(e));else{var t,n=Array.from(this.abortControllers.keys()).pop();n&&(t=this.abortControllers.get(n))&&(t.abort(),this.abortControllers.delete(n))}},e.prototype.cancelAll=function(){this.abortControllers.forEach((function(e){return e.abort()})),this.abortControllers.clear()},e.prototype.getOrCreateController=function(e){if(e&&this.abortControllers.has(e))return{abortController:this.abortControllers.get(e),abortId:e};var t=null!=e?e:"auto-"+Date.now(),n=new AbortController;return this.abortControllers.set(t,n),{abortController:n,abortId:t}},e.prototype.fetch=function(e,t){return n=this,r=void 0,s=function(){var n,r,i,s,a;return function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}(this,(function(o){switch(o.label){case 0:n=this.getOrCreateController(t),r=n.abortController,i=n.abortId,e.signal=r.signal,o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,x()(e)];case 2:return(s=o.sent()).error?[2,Promise.reject(new z(s.error.message,N.ParselyApiResponseContainsError))]:[2,s.data];case 3:return"AbortError"===(a=o.sent()).name?[2,Promise.reject(new z((0,c.__)("The operation was aborted.","wp-parsely"),N.ParselyAborted))]:[2,Promise.reject(new z(a.message,a.code))];case 4:return this.abortControllers.delete(i),[7];case 5:return[2]}}))},new((i=void 0)||(i=Promise))((function(e,t){function a(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,o)}l((s=s.apply(n,r||[])).next())}));var n,r,i,s},e}(),me=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),we=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))},_e=function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return me(t,e),t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.generateSmartLinks=function(e){return we(this,arguments,void 0,(function(e,t,n,r){var i;return void 0===t&&(t=Ae),void 0===n&&(n=Ne),void 0===r&&(r=[]),_e(this,(function(s){switch(s.label){case 0:return[4,this.fetch({method:"POST",path:(0,oe.addQueryArgs)("/wp-parsely/v1/content-suggestions/suggest-linked-reference",{max_link_words:t,max_links:n}),data:{url_exclusion_list:r,text:e}})];case 1:return[2,null!=(i=s.sent())?i:[]]}}))}))},t.prototype.addSmartLink=function(e,t){return we(this,void 0,void 0,(function(){return _e(this,(function(n){switch(n.label){case 0:return[4,this.fetch({method:"POST",path:"/wp-parsely/v1/smart-linking/".concat(e,"/add"),data:{link:t}})];case 1:return[2,n.sent()]}}))}))},t}(ve),xe=function(){return xe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},xe.apply(this,arguments)},ke=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))},Se=function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},Pe=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};!function(e){e.Unknown="unknown",e.ContentHelperSidebar="content_helper_sidebar",e.BlockInspector="block_inspector"}(ee||(ee={}));var je=function(e){var t=e.className,n=e.selectedBlockClientId,r=e.context,o=void 0===r?ee.Unknown:r,u=P(),p=u.settings,d=u.setSettings,f=(0,O.useDebounce)(d,500),g=(0,l.useState)(0),y=g[0],v=g[1],m=(0,l.useState)(!1),w=m[0],_=m[1],b=(0,l.useState)(!1),x=b[0],k=b[1],S=(0,l.useState)(!1),j=S[0],T=S[1],E=(0,a.useDispatch)("core/notices").createNotice;(0,l.useEffect)((function(){w?y>0&&E("success",/* translators: %d: number of smart links applied */
(0,c.sprintf)((0,c.__)("%s smart links successfully applied.","wp-parsely"),y),{type:"snackbar"}):v(0)}),[w]);var L=(0,a.useSelect)((function(e){var t=e(J),n=t.isLoading,r=t.getOverlayBlocks,i=t.getSuggestedLinks,s=t.getError,a=t.isFullContent,o=t.getMaxLinks,l=t.getMaxLinkWords,c=t.getSmartLinkingSettings,u=t.getApplyTo,p=t.isRetrying,d=t.getRetryAttempt,f=t.getSmartLinks;return{loading:n(),error:s(),maxLinks:o(),maxLinkWords:l(),isFullContent:a(),overlayBlocks:r(),suggestedLinks:i(),smartLinkingSettings:c(),applyTo:u(),retrying:p(),retryAttempt:d(),smartLinks:f(),getSmartLinksFn:f}}),[]),C=L.loading,A=L.isFullContent,R=L.overlayBlocks,I=L.error,B=L.suggestedLinks,M=L.maxLinks,D=L.maxLinkWords,H=L.smartLinkingSettings,z=L.applyTo,U=L.retrying,Z=L.retryAttempt,q=L.smartLinks,$=L.getSmartLinksFn,Y=(0,a.useDispatch)(J),Q=Y.setLoading,X=Y.setError,te=Y.addSmartLinks,ne=Y.addOverlayBlock,re=Y.removeOverlayBlock,ie=Y.setSmartLinkingSettings,se=Y.setApplyTo,ae=Y.setMaxLinkWords,oe=Y.setMaxLinks,le=Y.setIsRetrying,ce=Y.incrementRetryAttempt,ue=Y.purgeSmartLinksSuggestions;(0,l.useEffect)((function(){if(!(Object.keys(H).length>0)){var e={maxLinksPerPost:p.SmartLinking.MaxLinks,maxLinkWords:p.SmartLinking.MaxLinkWords};ie(e)}}),[ie,p]);var pe=(0,a.useSelect)((function(e){var t=e("core/block-editor"),r=t.getSelectedBlock,i=t.getBlock,s=t.getBlocks,a=e("core/editor"),o=a.getEditedPostContent,l=a.getCurrentPostAttribute;return{allBlocks:s(),selectedBlock:n?i(n):r(),postContent:o(),postPermalink:l("link")}}),[n]),de=pe.allBlocks,fe=pe.selectedBlock,ge=pe.postContent,ve=pe.postPermalink,me=function(e){return ke(void 0,void 0,void 0,(function(){var t,n,r,i;return Se(this,(function(s){switch(s.label){case 0:t=[],s.label=1;case 1:return s.trys.push([1,4,,9]),[4,se((n=A||!fe)?K.All:K.Selected)];case 2:return s.sent(),a=ve.replace(/^https?:\/\//i,""),r=["http://"+a,"https://"+a],[4,be.getInstance().generateSmartLinks((null==fe?void 0:fe.originalContent)&&!n?fe.originalContent:ge,D,M,r)];case 3:return t=s.sent(),[3,9];case 4:if((i=s.sent()).code&&i.code===N.ParselyAborted)throw i.numRetries=3-e,i;return e>0&&i.retryFetch?(console.error(i),[4,le(!0)]):[3,8];case 5:return s.sent(),[4,ce()];case 6:return s.sent(),[4,me(e-1)];case 7:return[2,s.sent()];case 8:throw i;case 9:return[2,t]}var a}))}))},we=function(e,t,n,r){return void 0===r&&(r=0),e.forEach((function(e,i){var s,a=r+i;if(null===(s=e.innerBlocks)||void 0===s?void 0:s.length)we(e.innerBlocks,t,n,a);else if(e.originalContent){var o=(0,V.getBlockContent)(e),l=(new DOMParser).parseFromString(o,"text/html").body.firstChild;l instanceof HTMLElement&&t.forEach((function(t){var r=function(e,t){for(var n,r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(n){var r;if(!n.textContent||!n.textContent.includes(t))return NodeFilter.FILTER_REJECT;for(var i=n.parentNode;i&&i!==e;){if("A"===i.nodeName&&!(null===(r=i.textContent)||void 0===r?void 0:r.includes(t)))return NodeFilter.FILTER_REJECT;i=i.parentNode}return NodeFilter.FILTER_ACCEPT}}),i=[];n=r.nextNode();)i.push(n);return i}(l,t.text),i="".concat(t.text,"#").concat(t.offset);n[i]=n[i]||{encountered:0,linked:0};var s=0;r.forEach((function(r){for(var o,l=new RegExp(W(t.text),"g");null!==l.exec(null!==(o=r.textContent)&&void 0!==o?o:"");){var c=n[i];c.encountered++,s++,c.encountered===t.offset+1&&c.linked<1&&(c.linked++,t.match={blockId:e.clientId,blockOffset:s-1,blockPosition:a})}}))}))}})),t},_e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ke(void 0,Pe([],e,!0),void 0,(function(e){return void 0===e&&(e="all"),Se(this,(function(t){switch(t.label){case 0:return[4,ne(e)];case 1:return t.sent(),Te(),[2]}}))}))},je=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ke(void 0,Pe([],e,!0),void 0,(function(e){return void 0===e&&(e="all"),Se(this,(function(t){switch(t.label){case 0:return[4,re(e)];case 1:return t.sent(),0===R.length&&Ee(),[2]}}))}))},Te=function(){(0,a.dispatch)("core/editor").lockPostSaving("wp-parsely-block-overlay"),document.querySelectorAll('.edit-post-header__settings>[type="button"]').forEach((function(e){e.setAttribute("disabled","disabled")}))},Ee=function(){document.querySelectorAll('.edit-post-header__settings>[type="button"]').forEach((function(e){e.removeAttribute("disabled")})),(0,a.dispatch)("core/editor").unlockPostSaving("wp-parsely-block-overlay")};return(0,i.jsxs)("div",{className:"wp-parsely-smart-linking",children:[(0,i.jsxs)(s.PanelRow,{className:t,children:[(0,i.jsxs)("div",{className:"smart-linking-text",children:[(0,c.__)("Automatically insert links to your most relevant, top performing content.","wp-parsely"),(0,i.jsxs)(s.Button,{href:"https://docs.parse.ly/plugin-content-helper/#h-smart-linking-beta",target:"_blank",variant:"link",children:[(0,c.__)("Learn more about Parse.ly AI","wp-parsely"),(0,i.jsx)(F,{icon:G,size:18,className:"parsely-external-link-icon"})]})]}),I&&(0,i.jsx)(s.Notice,{status:"info",onRemove:function(){return X(null)},className:"wp-parsely-content-helper-error",children:I.Message()}),w&&y>0&&(0,i.jsx)(s.Notice,{status:"success",onRemove:function(){return _(!1)},className:"wp-parsely-smart-linking-suggested-links",children:(0,c.sprintf)(/* translators: 1 - number of smart links generated */
(0,c.__)("Successfully added %s smart links.","wp-parsely"),y>0?y:B.length)}),(0,i.jsx)(ye,{disabled:C,selectedBlock:null==fe?void 0:fe.clientId,onSettingChange:function(e,t){var n;f({SmartLinking:xe(xe({},p.SmartLinking),(n={},n[e]=t,n))}),"MaxLinks"===e?oe(t):"MaxLinkWords"===e&&ae(t)}}),(0,i.jsx)("div",{className:"smart-linking-generate",children:(0,i.jsx)(s.Button,{onClick:function(){return ke(void 0,void 0,void 0,(function(){var e,t,n,r,i,s;return Se(this,(function(a){switch(a.label){case 0:return[4,Q(!0)];case 1:return a.sent(),[4,ue()];case 2:return a.sent(),[4,X(null)];case 3:return a.sent(),_(!1),h.trackEvent("smart_linking_generate_pressed",{is_full_content:A,selected_block:null!==(s=null==fe?void 0:fe.name)&&void 0!==s?s:"none",context:o}),[4,_e(A?"all":null==fe?void 0:fe.clientId)];case 4:a.sent(),e=setTimeout((function(){var e;Q(!1),h.trackEvent("smart_linking_generate_timeout",{is_full_content:A,selected_block:null!==(e=null==fe?void 0:fe.name)&&void 0!==e?e:"none",context:o}),je(A?"all":null==fe?void 0:fe.clientId)}),18e4),t=z,a.label=5;case 5:return a.trys.push([5,8,10,15]),[4,me(3)];case 6:return n=a.sent(),[4,(l=n,ke(void 0,void 0,void 0,(function(){var e;return Se(this,(function(t){switch(t.label){case 0:return l=l.filter((function(e){return!q.find((function(t){return t.uid===e.uid&&t.applied}))})),e=ve.replace(/^https?:\/\//,"").replace(/\/+$/,""),l=l.filter((function(t){return!t.href.includes(e)||(console.warn("PCH Smart Linking: Skipping self-reference link: ".concat(t.href)),!1)})),l=we(de,l,{}).filter((function(e){return e.match})),[4,te(l)];case 1:return t.sent(),[2]}}))})))];case 7:return a.sent(),k(!0),[3,15];case 8:return r=a.sent(),i=(0,c.__)("There was a problem generating smart links.","wp-parsely"),r.code&&r.code===N.ParselyAborted&&(i=(0,c.sprintf)(/* translators: %d: number of retry attempts, %s: attempt plural */
(0,c.__)("The Smart Linking process was cancelled after %1$d %2$s.","wp-parsely"),r.numRetries,(0,c._n)("attempt","attempts",r.numRetries,"wp-parsely")),r.message=i),[4,X(r)];case 9:return a.sent(),E("error",i,{type:"snackbar"}),[3,15];case 10:return[4,Q(!1)];case 11:return a.sent(),[4,se(t)];case 12:return a.sent(),[4,le(!1)];case 13:return a.sent(),[4,je(A?"all":null==fe?void 0:fe.clientId)];case 14:return a.sent(),clearTimeout(e),[7];case 15:return[2]}var l}))}))},variant:"primary",isBusy:C,disabled:C,children:U?(0,c.sprintf)(/* translators: %1$d: number of retry attempts, %2$d: maximum number of retries */
(0,c.__)("Retrying… Attempt %1$d of %2$d","wp-parsely"),Z,3):C?(0,c.__)("Generating Smart Links…","wp-parsely"):(0,c.__)("Add Smart Links","wp-parsely")})}),j&&(0,i.jsx)("div",{className:"smart-linking-manage",children:(0,i.jsx)(s.Button,{onClick:function(){return k(!0)},variant:"secondary",children:(0,c.__)("Review Smart Links","wp-parsely")})})]}),(0,i.jsx)(he,{isOpen:x,onAppliedLink:function(){v((function(e){return e+1}))},onClose:function(){_(!0),k(!1),$().length>0?T(!0):T(!1)}})]})},Te=function(){return Te=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Te.apply(this,arguments)},Ee=function(e){var t=e.selectedBlockClientId,n=e.label,r=(0,a.useSelect)((function(e){return{retrying:(0,e(J).isRetrying)()}}),[]).retrying,o=(0,l.useState)(document.createElement("div"))[0];return o.className="wp-parsely-block-overlay","all"===t&&(o.className+=" full-content-overlay"),o.onclick=function(e){var n=document.querySelector(".wp-parsely-block-overlay-cancel");n&&e.target===n?e.stopPropagation():(e.stopPropagation(),e.stopImmediatePropagation(),"all"!==t&&((0,a.dispatch)("core/block-editor").selectBlock(t,-1),o.ownerDocument.activeElement.blur()))},(0,l.useEffect)((function(){if(t){if("all"===t){var e=document.querySelector(".interface-navigable-region.interface-interface-skeleton__content");return null==e||e.appendChild(o),null==e||e.setAttribute("style","overflow: hidden"),o.style.top=(null==e?void 0:e.scrollTop)+"px",function(){(null==e?void 0:e.contains(o))&&e.removeChild(o),null==e||e.setAttribute("style",""),o.style.top=""}}var n=document.querySelector('[data-block="'.concat(t,'"]'));return null==n||n.setAttribute("contenteditable","false"),null==n||n.setAttribute("aria-disabled","true"),null==n||n.appendChild(o),function(){null==n||n.setAttribute("contenteditable","true"),null==n||n.removeAttribute("aria-disabled"),(null==n?void 0:n.contains(o))&&n.removeChild(o)}}})),(0,l.createPortal)((0,i.jsxs)("div",{className:"wp-parsely-block-overlay-label",children:[(0,i.jsx)(s.Spinner,{}),!r&&(0,i.jsx)("span",{children:n}),r&&(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("span",{children:[(0,c.__)("Retrying to Generate Smart Links…","wp-parsely")," ",(0,i.jsx)(s.Button,{className:"wp-parsely-block-overlay-cancel",variant:"link",onClick:function(){be.getInstance().cancelRequest()},children:(0,c.__)("Cancel","wp-parsely")})]})})]}),o)},Le=(0,O.createHigherOrderComponent)((function(e){return function(t){return(0,a.useSelect)((function(e){return{overlayBlocks:(0,e(J).getOverlayBlocks)()}}),[]).overlayBlocks.includes(t.clientId)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e,Te({},t)),(0,i.jsx)(Ee,{label:(0,c.__)("Generating Smart Links…","wp-parsely"),selectedBlockClientId:t.clientId})]}):(0,i.jsx)(e,Te({},t))}}),"withBlockOverlay"),Ce=function(){return Ce=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ce.apply(this,arguments)},Ne=10,Ae=4,Oe=(0,O.createHigherOrderComponent)((function(e){return function(t){return"core/paragraph"!==t.name?(0,i.jsx)(e,Ce({},t)):(0,i.jsx)(j,{endpoint:"editor-sidebar-settings",defaultSettings:Sn(),children:(0,i.jsx)(e,Ce({},t))})}}),"withSettingsProvider"),Re=(0,O.createHigherOrderComponent)((function(e){return function(t){if(!t.isSelected||"core/paragraph"!==t.name)return(0,i.jsx)(e,Ce({},t));var n=P(),r=n.settings,a=n.setSettings;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e,Ce({},t)),(0,i.jsx)(A.InspectorControls,{group:"list",children:(0,i.jsx)(s.PanelBody,{title:(0,c.__)("Smart Linking (Beta)","wp-parsely"),initialOpen:r.SmartLinking.Open,className:"wp-parsely-panel wp-parsely-smart-linking-panel",icon:(0,i.jsx)(y,{}),onToggle:function(e){a({SmartLinking:Ce(Ce({},r.SmartLinking),{Open:e})}),h.trackEvent("smart_linking_block_inspector_panel_toggled",{open:e})},children:(0,i.jsx)(D,{children:(0,i.jsx)(je,{selectedBlockClientId:t.clientId,context:ee.BlockInspector})})})})]})}}),"withSmartLinkingPanel"),Ie=(0,O.compose)(Oe,Re),Be=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M7 11.5h10V13H7z"})),Me=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M13 19h-2v-2h2v2zm0-6h-2v-2h2v2zm0-6h-2V5h2v2z"})),De=function(e){var t=e.title,n=e.icon,r=e.subtitle,a=e.level,o=void 0===a?2:a,l=e.children,u=e.controls,p=e.onClick,d=e.isOpen,f=e.isLoading,h=e.dropdownChildren;return(0,i.jsxs)("div",{className:"performance-stat-panel",children:[(0,i.jsxs)(s.__experimentalHStack,{className:"panel-header level-"+o,children:[(0,i.jsx)(s.__experimentalHeading,{level:o,children:t}),r&&!d&&(0,i.jsx)("span",{className:"panel-subtitle",children:r}),u&&!h&&(0,i.jsx)(s.DropdownMenu,{icon:n,label:(0,c.__)("Settings","wp-parsely"),className:"panel-settings-button",controls:u}),h&&(0,i.jsx)(s.DropdownMenu,{icon:n,label:(0,c.__)("Settings","wp-parsely"),className:"panel-settings-button",children:h}),n&&!h&&!u&&(0,i.jsx)(s.Button,{icon:n,className:"panel-settings-button",isPressed:d,onClick:p})]}),(0,i.jsx)("div",{className:"panel-body",children:f?(0,i.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,i.jsx)(s.Spinner,{})}):l})]})};function Ve(e,t,n){void 0===t&&(t=1),void 0===n&&(n="");var r=parseInt(e.replace(/\D/g,""),10);if(r<1e3)return e;r<1e4&&(t=1);var i=r,s=r.toString(),a="",o=0;return Object.entries({1e3:"k","1,000,000":"M","1,000,000,000":"B","1,000,000,000,000":"T","1,000,000,000,000,000":"Q"}).forEach((function(e){var n=e[0],l=e[1],c=parseInt(n.replace(/\D/g,""),10);if(r>=c){var u=t;(i=r/c)%1>1/o&&(u=i>10?1:2),u=parseFloat(i.toFixed(2))===parseFloat(i.toFixed(0))?0:u,s=i.toFixed(u),a=l}o=c})),s+n+a}var Fe=function(e){var n=e.data,r=e.isLoading,a=(0,l.useState)(t.Views),o=a[0],u=a[1],p=(0,l.useState)(!1),d=p[0],f=p[1];r||delete n.referrers.types.totals;var h=function(e){switch(e){case"social":return(0,c.__)("Social","wp-parsely");case"search":return(0,c.__)("Search","wp-parsely");case"other":return(0,c.__)("Other","wp-parsely");case"internal":return(0,c.__)("Internal","wp-parsely");case"direct":return(0,c.__)("Direct","wp-parsely")}return e},g=(0,c.sprintf)((0,c.__)("By %s","wp-parsely"),L(o));
/* translators: %s: metric description */return(0,i.jsxs)(De,{title:(0,c.__)("Categories","wp-parsely"),level:3,subtitle:g,isOpen:d,onClick:function(){return f(!d)},children:[d&&(0,i.jsx)("div",{className:"panel-settings",children:(0,i.jsx)(s.SelectControl,{value:o,prefix:(0,c.__)("By: ","wp-parsely"),onChange:function(e){T(e,t)&&u(e)},children:Object.values(t).map((function(e){return(0,i.jsxs)("option",{value:e,disabled:"avg_engaged"===e,children:[L(e),"avg_engaged"===e&&(0,c.__)(" (coming soon)","wp-parsely")]},e)}))})}),r?(0,i.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,i.jsx)(s.Spinner,{})}):(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"multi-percentage-bar",children:Object.entries(n.referrers.types).map((function(e){var t=e[0],n=e[1],r=(0,c.sprintf)(/* translators: 1: Referrer type, 2: Percentage value, %%: Escaped percent sign */
(0,c.__)("%1$s: %2$s%%","wp-parsely"),h(t),n.viewsPercentage);return(0,i.jsx)(s.Tooltip
/* translators: %s: percentage value */,{
/* translators: %s: percentage value */
text:"".concat(h(t)," - ").concat((0,c.sprintf)((0,c.__)("%s%%","wp-parsely"),n.viewsPercentage)),delay:150,children:(0,i.jsx)("div",{"aria-label":r,className:"bar-fill "+t,style:{width:n.viewsPercentage+"%"}})},t)}))}),(0,i.jsx)("div",{className:"percentage-bar-labels",children:Object.entries(n.referrers.types).map((function(e){var t=e[0],n=e[1];return(0,i.jsxs)("div",{className:"single-label "+t,children:[(0,i.jsx)("div",{className:"label-color "+t}),(0,i.jsx)("div",{className:"label-text",children:h(t)}),(0,i.jsx)("div",{className:"label-value",children:Ve(n.views)})]},t)}))})]})]})},Ge=(0,u.createElement)(p.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,u.createElement)(p.Path,{d:"M3.99961 13C4.67043 13.3354 4.6703 13.3357 4.67017 13.3359L4.67298 13.3305C4.67621 13.3242 4.68184 13.3135 4.68988 13.2985C4.70595 13.2686 4.7316 13.2218 4.76695 13.1608C4.8377 13.0385 4.94692 12.8592 5.09541 12.6419C5.39312 12.2062 5.84436 11.624 6.45435 11.0431C7.67308 9.88241 9.49719 8.75 11.9996 8.75C14.502 8.75 16.3261 9.88241 17.5449 11.0431C18.1549 11.624 18.6061 12.2062 18.9038 12.6419C19.0523 12.8592 19.1615 13.0385 19.2323 13.1608C19.2676 13.2218 19.2933 13.2686 19.3093 13.2985C19.3174 13.3135 19.323 13.3242 19.3262 13.3305L19.3291 13.3359C19.3289 13.3357 19.3288 13.3354 19.9996 13C20.6704 12.6646 20.6703 12.6643 20.6701 12.664L20.6697 12.6632L20.6688 12.6614L20.6662 12.6563L20.6583 12.6408C20.6517 12.6282 20.6427 12.6108 20.631 12.5892C20.6078 12.5459 20.5744 12.4852 20.5306 12.4096C20.4432 12.2584 20.3141 12.0471 20.1423 11.7956C19.7994 11.2938 19.2819 10.626 18.5794 9.9569C17.1731 8.61759 14.9972 7.25 11.9996 7.25C9.00203 7.25 6.82614 8.61759 5.41987 9.9569C4.71736 10.626 4.19984 11.2938 3.85694 11.7956C3.68511 12.0471 3.55605 12.2584 3.4686 12.4096C3.42484 12.4852 3.39142 12.5459 3.36818 12.5892C3.35656 12.6108 3.34748 12.6282 3.34092 12.6408L3.33297 12.6563L3.33041 12.6614L3.32948 12.6632L3.32911 12.664C3.32894 12.6643 3.32879 12.6646 3.99961 13ZM11.9996 16C13.9326 16 15.4996 14.433 15.4996 12.5C15.4996 10.567 13.9326 9 11.9996 9C10.0666 9 8.49961 10.567 8.49961 12.5C8.49961 14.433 10.0666 16 11.9996 16Z"})),He=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M15.5 9.5a1 1 0 100-2 1 1 0 000 2zm0 1.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm-2.25 6v-2a2.75 2.75 0 00-2.75-2.75h-4A2.75 2.75 0 003.75 15v2h1.5v-2c0-.69.56-1.25 1.25-1.25h4c.69 0 1.25.56 1.25 1.25v2h1.5zm7-2v2h-1.5v-2c0-.69-.56-1.25-1.25-1.25H15v-1.5h2.5A2.75 2.75 0 0120.25 15zM9.5 8.5a1 1 0 11-2 0 1 1 0 012 0zm1.5 0a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z",fillRule:"evenodd"})),ze=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M12 4V2.2L9 4.8l3 2.5V5.5c3.6 0 6.5 2.9 6.5 6.5 0 2.9-1.9 5.3-4.5 6.2v.2l-.1-.2c-.4.1-.7.2-1.1.2l.2 1.5c.3 0 .6-.1 1-.2 3.5-.9 6-4 6-7.7 0-4.4-3.6-8-8-8zm-7.9 7l1.5.2c.1-1.2.5-2.3 1.2-3.2l-1.1-.9C4.8 8.2 4.3 9.6 4.1 11zm1.5 1.8l-1.5.2c.1.7.3 1.4.5 2 .3.7.6 1.3 1 1.8l1.2-.8c-.3-.5-.6-1-.8-1.5s-.4-1.1-.4-1.7zm1.5 5.5c1.1.9 2.4 1.4 3.8 1.6l.2-1.5c-1.1-.1-2.2-.5-3.1-1.2l-.9 1.1z"})),We=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M11 13h2v-2h-2v2zm-6 0h2v-2H5v2zm12-2v2h2v-2h-2z"})),Ue=function(){return Ue=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ue.apply(this,arguments)},Ze=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},qe=[{name:"views",title:(0,c.__)("Page Views","wp-parsely"),icon:Ge},{name:"visitors",title:(0,c.__)("Visitors","wp-parsely"),icon:He},{name:"avgEngaged",title:(0,c.__)("Avg. Engaged","wp-parsely"),icon:(0,i.jsx)((function(){return(0,i.jsxs)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,i.jsx)(s.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 19.5C16.1421 19.5 19.5 16.1421 19.5 12C19.5 7.85786 16.1421 4.5 12 4.5C7.85786 4.5 4.5 7.85786 4.5 12C4.5 16.1421 7.85786 19.5 12 19.5ZM12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z",fill:"#1E1E1E"}),(0,i.jsx)(s.Path,{d:"M11 12L12 7L13 12H11Z",fill:"#1E1E1E"}),(0,i.jsx)(s.Path,{d:"M12 13C12.5523 13 13 12.5523 13 12H11C11 12.5523 11.4477 13 12 13Z",fill:"#1E1E1E"}),(0,i.jsx)(s.Path,{d:"M12.8144 11.3845L15.6429 15.6271L11.4002 12.7987L12.8144 11.3845Z",fill:"#1E1E1E"})]})}),{})},{name:"recirculation",title:(0,c.__)("Recirculation","wp-parsely"),icon:ze,smallText:!0}],$e=function(e,t){return e.PerformanceStats.VisibleDataPoints.includes(t)},Ke=function(e){var t=e.title,n=e.value,r=e.icon,s=e.smallText,a=e.isVisible;return void 0===a||a?(0,i.jsxs)("div",{className:"data-point",children:[(0,i.jsx)(F,{size:24,icon:r}),(0,i.jsx)("span",{className:"data-point-title",children:t}),(0,i.jsx)("span",{className:"data-point-value"+(s?" is-small":""),children:n})]}):null},Ye=function(e){var t=e.dataPoints;return(0,i.jsx)("div",{className:"performance-data-points",children:t.map((function(e){var t=e.title,n=e.value,r=e.icon,s=e.smallText,a=e.isVisible;return(0,i.jsx)(Ke,{title:t,value:n,icon:r,smallText:s,isVisible:a},t)}))})},Qe=function(e){var t=e.onClose,n=P(),r=n.settings,a=n.setSettings;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.MenuGroup,{label:(0,c.__)("Performance Stats","wp-parsely"),children:qe.map((function(e){return(0,i.jsxs)(s.MenuItem,{icon:$e(r,e.name)?se:Be,onClick:function(){return n=e.name,$e(r,i=n)?(a({PerformanceStats:Ue(Ue({},r.PerformanceStats),{VisibleDataPoints:r.PerformanceStats.VisibleDataPoints.filter((function(e){return e!==i}))})}),h.trackEvent("editor_sidebar_performance_datapoint_hidden",{datapoint:i})):(a({PerformanceStats:Ue(Ue({},r.PerformanceStats),{VisibleDataPoints:Ze(Ze([],r.PerformanceStats.VisibleDataPoints,!0),[i],!1)})}),h.trackEvent("editor_sidebar_performance_datapoint_shown",{datapoint:i})),void t();var n,i},children:[(0,i.jsx)(F,{icon:e.icon}),e.title]},e.name)}))}),(0,i.jsx)(s.MenuGroup,{children:(0,i.jsx)(s.MenuItem,{onClick:function(){a({PerformanceStats:Ue(Ue({},r.PerformanceStats),{VisibleDataPoints:["views","visitors","avgEngaged","recirculation"]})}),h.trackEvent("editor_sidebar_performance_datapoints_reset"),t()},children:(0,c.__)("Reset all","wp-parsely")})})]})},Xe=function(e){var t=e.data,n=e.isLoading,r=void 0!==n&&n,a=P().settings,o=[];return r||(o=qe.map((function(e){var n;switch(e.name){case"views":n=Ve(t.views);break;case"visitors":n=Ve(t.visitors);break;case"avgEngaged":n=t.avgEngaged;break;default:n=(0,c.__)("Coming soon!","wp-parsely")}return Ue(Ue({},e),{value:n,isVisible:$e(a,e.name)})}))),(0,i.jsx)(De,{title:(0,c.__)("Overview","wp-parsely"),level:3,icon:We,dropdownChildren:function(e){var t=e.onClose;return(0,i.jsx)(Qe,{onClose:t})},children:r?(0,i.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,i.jsx)(s.Spinner,{})}):(0,i.jsx)(Ye,{dataPoints:o})})},Je=function(e){var n=e.data,r=e.isLoading,a=(0,l.useState)(t.Views),o=a[0],u=a[1],p=(0,l.useState)(!1),d=p[0],f=p[1],h=(0,c.sprintf)((0,c.__)("By %s","wp-parsely"),L(o));return(0,i.jsxs)(De,{title:(0,c.__)("Referrers","wp-parsely"),subtitle:h,level:3,isOpen:d,onClick:function(){return f(!d)},children:[d&&(0,i.jsx)("div",{className:"panel-settings",children:(0,i.jsx)(s.SelectControl,{value:o,prefix:(0,c.__)("By: ","wp-parsely"),onChange:function(e){T(e,t)&&u(e)},children:Object.values(t).map((function(e){return(0,i.jsxs)("option",{value:e,disabled:"avg_engaged"===e,children:[L(e),"avg_engaged"===e&&(0,c.__)(" (coming soon)","wp-parsely")]},e)}))})}),r?(0,i.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,i.jsx)(s.Spinner,{})}):(0,i.jsx)("div",{className:"referrers-list",children:Object.entries(n.referrers.top).map((function(e){var t=e[0],n=e[1];if("totals"===t)return null;var r=t;"direct"===t&&(r=(0,c.__)("Direct","wp-parsely"))
/* translators: %s: Percentage value, %%: Escaped percent sign */;var s=(0,c.sprintf)((0,c.__)("%s%%","wp-parsely"),n.viewsPercentage);return(0,i.jsxs)("div",{className:"referrers-row",children:[(0,i.jsx)("div",{className:"referrers-row-title",children:(0,i.jsx)("span",{children:r})}),(0,i.jsx)("div",{className:"referrers-row-bar",children:(0,i.jsx)("div",{"aria-label":s,className:"percentage-bar",style:{"--bar-fill":n.viewsPercentage+"%"}})}),(0,i.jsx)("div",{className:"referrers-row-value",children:(0,i.jsx)("span",{children:n.views})})]},t)}))})]})};function et(e){return{period_start:e,period_end:""}}(0,c.__)("Date N/A","wp-parsely");var tt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),nt=function(){return nt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},nt.apply(this,arguments)},rt=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))},it=function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},st=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.itmSource="wp-parsely-content-helper",t}return tt(t,e),t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.getPerformanceStats=function(e){return rt(this,void 0,void 0,(function(){var t,n,r,i,s;return it(this,(function(o){switch(o.label){case 0:if(!1===(t=(0,a.select)("core/editor")).isCurrentPostPublished())return[2,Promise.reject(new z((0,c.__)("This post is not published, so its details are unavailable.","wp-parsely"),N.PostIsNotPublished,""))];if(null===(n=t.getPermalink()))return[2,Promise.reject(new z((0,c.__)("The post's URL returned null.","wp-parsely"),N.PostIsNotPublished))];o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.fetchPerformanceDataFromWpEndpoint(e,n)];case 2:return r=o.sent(),[4,this.fetchReferrerDataFromWpEndpoint(e,n,r.views)];case 3:return i=o.sent(),[3,5];case 4:return s=o.sent(),[2,Promise.reject(s)];case 5:return[2,nt(nt({},r),{referrers:i})]}}))}))},t.prototype.fetchPerformanceDataFromWpEndpoint=function(e,t){return rt(this,void 0,void 0,(function(){var n;return it(this,(function(r){switch(r.label){case 0:return[4,this.fetch({path:(0,oe.addQueryArgs)("/wp-parsely/v1/stats/post/detail",nt(nt({},et(e)),{itm_source:this.itmSource,url:t}))})];case 1:return 0===(n=r.sent()).length?[2,Promise.reject(new z((0,c.sprintf)(/* translators: URL of the published post */
(0,c.__)("The post %s has 0 views, or the Parse.ly API returned no data.","wp-parsely"),t),N.ParselyApiReturnedNoData,""))]:n.length>1?[2,Promise.reject(new z((0,c.sprintf)(/* translators: URL of the published post */
(0,c.__)("Multiple results were returned for the post %s by the Parse.ly API.","wp-parsely"),t),N.ParselyApiReturnedTooManyResults))]:[2,n[0]]}}))}))},t.prototype.fetchReferrerDataFromWpEndpoint=function(e,t,n){return rt(this,void 0,void 0,(function(){return it(this,(function(r){switch(r.label){case 0:return[4,this.fetch({path:(0,oe.addQueryArgs)("/wp-parsely/v1/referrers/post/detail",nt(nt({},et(e)),{itm_source:this.itmSource,total_views:n,url:t}))})];case 1:return[2,r.sent()]}}))}))},t}(ve),at=function(){return at=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},at.apply(this,arguments)},ot=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))},lt=function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},ct=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},ut=[{name:"overview",label:(0,c.__)("Overview","wp-parsely")},{name:"categories",label:(0,c.__)("Referrer Categories","wp-parsely")},{name:"referrers",label:(0,c.__)("Referrers","wp-parsely")}],pt=function(e,t){return e.PerformanceStats.VisiblePanels.includes(t)},dt=function(e){var t=e.onClose,n=P(),r=n.settings,a=n.setSettings;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.MenuGroup,{label:(0,c.__)("Performance Stats","wp-parsely"),children:ut.map((function(e){return(0,i.jsx)(s.MenuItem,{disabled:e.forced,icon:pt(r,e.name)?se:Be,onClick:function(){return function(e){var t;(null===(t=ut.find((function(t){return t.name===e})))||void 0===t?void 0:t.forced)||(pt(r,e)?(a({PerformanceStats:at(at({},r.PerformanceStats),{VisiblePanels:r.PerformanceStats.VisiblePanels.filter((function(t){return t!==e}))})}),h.trackEvent("editor_sidebar_performance_panel_closed",{panel:e})):(a({PerformanceStats:at(at({},r.PerformanceStats),{VisiblePanels:ct(ct([],r.PerformanceStats.VisiblePanels,!0),[e],!1)})}),h.trackEvent("editor_sidebar_performance_panel_opened",{panel:e})))}(e.name),void t()},children:e.label},e.name)}))}),(0,i.jsx)(s.MenuGroup,{children:(0,i.jsx)(s.MenuItem,{onClick:function(){a({PerformanceStats:at(at({},r.PerformanceStats),{VisiblePanels:ut.map((function(e){return e.name}))})}),h.trackEvent("editor_sidebar_performance_panels_reset"),t()},children:(0,c.__)("Reset all","wp-parsely")})})]})},ft=function(t){var n=t.period,r=(0,l.useState)(!0),a=r[0],o=r[1],u=(0,l.useState)(),p=u[0],d=u[1],f=(0,l.useState)(),g=f[0],y=f[1],v=P(),m=v.settings,w=v.setSettings;return(0,l.useEffect)((function(){var e=st.getInstance(),t=function(r){return ot(void 0,void 0,void 0,(function(){return lt(this,(function(i){return e.getPerformanceStats(n).then((function(e){y(e),o(!1)})).catch((function(e){return ot(void 0,void 0,void 0,(function(){return lt(this,(function(n){switch(n.label){case 0:return r>0&&e.retryFetch?[4,new Promise((function(e){return setTimeout(e,500)}))]:[3,3];case 1:return n.sent(),[4,t(r-1)];case 2:return n.sent(),[3,4];case 3:d(e),o(!1),n.label=4;case 4:return[2]}}))}))})),[2]}))}))};return o(!0),t(1),function(){d(void 0)}}),[n]),(0,i.jsxs)("div",{className:"wp-parsely-performance-panel",children:[(0,i.jsx)(De,{title:(0,c.__)("Performance Stats","wp-parsely"),icon:Me,dropdownChildren:function(e){var t=e.onClose;return(0,i.jsx)(dt,{onClose:t})},children:(0,i.jsx)("div",{className:"panel-settings",children:(0,i.jsx)(s.SelectControl,{size:"__unstable-large",value:m.PerformanceStats.Period,prefix:(0,i.jsx)(s.__experimentalInputControlPrefixWrapper,{children:(0,c.__)("Period: ","wp-parsely")}),onChange:function(t){T(t,e)&&(w({PerformanceStats:at(at({},m.PerformanceStats),{Period:t})}),h.trackEvent("editor_sidebar_performance_period_changed",{period:t}))},children:Object.values(e).map((function(e){return(0,i.jsx)("option",{value:e,children:E(e)},e)}))})})}),p?p.Message():(0,i.jsxs)(i.Fragment,{children:[pt(m,"overview")&&(0,i.jsx)(Xe,{data:g,isLoading:a}),pt(m,"categories")&&(0,i.jsx)(Fe,{data:g,isLoading:a}),pt(m,"referrers")&&(0,i.jsx)(Je,{data:g,isLoading:a})]}),window.wpParselyPostUrl&&(0,i.jsx)(s.Button,{className:"wp-parsely-view-post",variant:"primary",onClick:function(){h.trackEvent("editor_sidebar_view_post_pressed")},href:window.wpParselyPostUrl,rel:"noopener",target:"_blank",children:(0,c.__)("View this in Parse.ly","wp-parsely")})]})},ht=function(e){var t=e.period;return(0,i.jsx)(s.Panel,{children:(0,i.jsx)(D,{children:(0,i.jsx)(ft,{period:t})})})},gt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},yt=function(e){var t=e.filter,n=e.label,a=e.postData,o=gt(e,["filter","label","postData"]);return(0,i.jsx)("div",{className:"related-posts-filter-types",children:(0,i.jsxs)(s.__experimentalToggleGroupControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:n||(0,c.__)("Filter by","wp-parsely"),value:t.type,onChange:function(e){return o.onFilterTypeChange(e)},isBlock:!0,children:[a.tags.length>=1&&(0,i.jsx)(s.__experimentalToggleGroupControlOption,{value:r.Tag,label:(0,c.__)("Tag","wp-parsely")}),a.categories.length>=1&&(0,i.jsx)(s.__experimentalToggleGroupControlOption,{value:r.Section,label:(0,c.__)("Section","wp-parsely")}),a.authors.length>=1&&(0,i.jsx)(s.__experimentalToggleGroupControlOption,{value:r.Author,label:(0,c.__)("Author","wp-parsely")})]})})},vt=function(e){var t=e.filter,n=e.label,a=e.postData,o=gt(e,["filter","label","postData"]);return(0,i.jsx)("div",{className:"related-posts-filter-values",children:(0,i.jsx)(s.ComboboxControl,{__next40pxDefaultSize:!0,allowReset:!0,label:n,onChange:function(e){return o.onFilterValueChange(e)},options:r.Tag===t.type?a.tags.map((function(e){return{value:e,label:e}})):r.Section===t.type?a.categories.map((function(e){return{value:e,label:e}})):r.Author===t.type?a.authors.map((function(e){return{value:e,label:e}})):[],value:t.value})})},mt=function(e){var t=e.filter,n=e.postData,s=e.label,a=gt(e,["filter","postData","label"]),o=function(){return n.authors.length>0&&n.categories.length>0||n.authors.length>0&&n.tags.length>0||n.tags.length>0&&n.categories.length>0},l=function(){return r.Tag===t.type&&n.tags.length>1||r.Section===t.type&&n.categories.length>1||r.Author===t.type&&n.authors.length>1};return o()||l()?(0,i.jsxs)("div",{className:"related-posts-filter-settings",children:[o()&&(0,i.jsx)(yt,{filter:t,label:s,onFilterTypeChange:a.onFilterTypeChange,postData:n}),l()&&(0,i.jsx)(vt,{filter:t,label:o()?void 0:s,onFilterValueChange:a.onFilterValueChange,postData:n})]}):null},wt=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M10 17.389H8.444A5.194 5.194 0 1 1 8.444 7H10v1.5H8.444a3.694 3.694 0 0 0 0 7.389H10v1.5ZM14 7h1.556a5.194 5.194 0 0 1 0 10.39H14v-1.5h1.556a3.694 3.694 0 0 0 0-7.39H14V7Zm-4.5 6h5v-1.5h-5V13Z"})),_t=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5.625 5.5h9.75c.069 0 .125.056.125.125v9.75a.125.125 0 0 1-.125.125h-9.75a.125.125 0 0 1-.125-.125v-9.75c0-.069.056-.125.125-.125ZM4 5.625C4 4.728 4.728 4 5.625 4h9.75C16.273 4 17 4.728 17 5.625v9.75c0 .898-.727 1.625-1.625 1.625h-9.75A1.625 1.625 0 0 1 4 15.375v-9.75Zm14.5 11.656v-9H20v9C20 18.8 18.77 20 17.251 20H6.25v-1.5h11.001c.69 0 1.249-.528 1.249-1.219Z"}));function bt(e){var t=e.metric,n=e.post,r=e.avgEngagedIcon,s=e.viewsIcon;return"views"===t?(0,i.jsxs)("span",{className:"parsely-post-metric-data",children:[(0,i.jsx)("span",{className:"screen-reader-text",children:(0,c.__)("Number of Views","wp-parsely")}),s,Ve(n.views.toString())]}):"avg_engaged"===t?(0,i.jsxs)("span",{className:"parsely-post-metric-data",children:[(0,i.jsx)("span",{className:"screen-reader-text",children:(0,c.__)("Average Time","wp-parsely")}),r,n.avgEngaged]}):(0,i.jsx)("span",{className:"parsely-post-metric-data",children:"-"})}var xt,kt=function(){return(0,i.jsx)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",width:"1",height:"40",viewBox:"0 0 1 40",fill:"none",children:(0,i.jsx)(s.Rect,{width:"1",height:"40",fill:"#cccccc"})})},St=function(e){var t,n,r=e.metric,o=e.post,l=e.postContent,u=(0,a.useDispatch)("core/notices").createNotice,p=l&&(t=l,n=W(o.rawUrl),new RegExp("<a [^>]*href=[\"'](http://|https://)?.*".concat(n,".*[\"'][^>]*>"),"i").test(t));return(0,i.jsxs)("div",{className:"related-post-single","data-testid":"related-post-single",children:[(0,i.jsx)("div",{className:"related-post-title",children:(0,i.jsxs)("a",{href:o.url,target:"_blank",rel:"noreferrer",children:[(0,i.jsx)("span",{className:"screen-reader-text",children:(0,c.__)("View on website (opens new tab)","wp-parsely")}),o.title]})}),(0,i.jsx)("div",{className:"related-post-actions",children:(0,i.jsxs)("div",{className:"related-post-info",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"related-post-metric",children:(0,i.jsx)(bt,{metric:r,post:o,viewsIcon:(0,i.jsx)(F,{icon:Ge}),avgEngagedIcon:(0,i.jsx)(s.Dashicon,{icon:"clock",size:24})})}),p&&(0,i.jsx)("div",{className:"related-post-linked",children:(0,i.jsx)(s.Tooltip,{text:(0,c.__)("This post is linked in the content","wp-parsely"),children:(0,i.jsx)(F,{icon:wt,size:24})})})]}),(0,i.jsx)(kt,{}),(0,i.jsxs)("div",{children:[(0,i.jsx)(s.Button,{icon:_t,iconSize:24,onClick:function(){navigator.clipboard.writeText(o.rawUrl).then((function(){u("success",(0,c.__)("URL copied to clipboard","wp-parsely"),{type:"snackbar"})}))},label:(0,c.__)("Copy URL to clipboard","wp-parsely")}),(0,i.jsx)(s.Button,{icon:(0,i.jsx)(y,{}),iconSize:18,href:o.dashUrl,target:"_blank",label:(0,c.__)("View in Parse.ly","wp-parsely")})]})]})})]})},Pt=window.wp.coreData,jt=window.wp.editor,Tt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Et=function(){return Et=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Et.apply(this,arguments)},Lt=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))},Ct=function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},Nt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Tt(t,e),t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.getRelatedPosts=function(e,t,n){return Lt(this,void 0,void 0,(function(){var r,i,s;return Ct(this,(function(a){switch(a.label){case 0:try{r=this.buildRelatedPostsApiQuery(e,t,n)}catch(e){return[2,Promise.reject(e)]}a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.fetchRelatedPostsFromWpEndpoint(r)];case 2:return i=a.sent(),[3,4];case 3:return s=a.sent(),[2,Promise.reject(s)];case 4:return[2,{message:this.generateMessage(0===i.length,e,r.message),posts:i}]}}))}))},t.prototype.generateMessage=function(e,t,n){return e?(0,c.sprintf)(/* translators: 1: message such as "in category Foo" */
(0,c.__)("No related posts %1$s were found for the specified period and metric.","wp-parsely"),n):(0,c.sprintf)(/* translators: 1: message such as "in category Foo", 2: period such as "last 7 days"*/
(0,c.__)("Related posts %1$s in the %2$s.","wp-parsely"),n,E(t,!0))},t.prototype.fetchRelatedPostsFromWpEndpoint=function(e){return Lt(this,void 0,void 0,(function(){var t;return Ct(this,(function(n){return[2,null!=(t=this.fetch({path:(0,oe.addQueryArgs)("/wp-parsely/v1/stats/posts",Et(Et({},e.query),{itm_source:"wp-parsely-content-helper"}))}))?t:[]]}))}))},t.prototype.buildRelatedPostsApiQuery=function(e,t,n){var i=Et(Et({},et(e)),{limit:5,sort:t});if(r.Tag===n.type)return{query:Et({tag:n.value},i),
/* translators: %s: message such as "with tag Foo" */
message:(0,c.sprintf)((0,c.__)('with tag "%1$s"',"wp-parsely"),n.value)};if(r.Section===n.type)return{query:Et({section:n.value},i),
/* translators: %s: message such as "in category Foo" */
message:(0,c.sprintf)((0,c.__)('in section "%1$s"',"wp-parsely"),n.value)};if(r.Author===n.type)return{query:Et({author:n.value},i),
/* translators: %s: message such as "by author John" */
message:(0,c.sprintf)((0,c.__)('by author "%1$s"',"wp-parsely"),n.value)};throw new z((0,c.__)("No valid filter type has been specified.","wp-parsely"),N.CannotFormulateApiQuery)},t}(ve),At=function(){return At=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},At.apply(this,arguments)},Ot=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))},Rt=function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},It=function(){var n=P(),o=n.settings,u=n.setSettings,p=o.RelatedPosts.Period,d=o.RelatedPosts.Metric,f=(0,l.useState)({authors:[],categories:[],tags:[]}),g=f[0],y=f[1],v=function(){var e=(0,a.useSelect)((function(e){var t,n,r,i,s,a,o=e(jt.store).getEditedPostAttribute,l=e(Pt.store).getEntityRecords,c=o("author"),u=o("categories"),p=o("tags");return{authors:i=Number.isInteger(c)?null!==(t=l("root","user",{include:[c],context:"view"}))&&void 0!==t?t:void 0:null,categories:s=Array.isArray(u)&&u.length>0&&u.every(Number.isInteger)?null!==(n=l("taxonomy","category",{include:u,context:"view"}))&&void 0!==n?n:void 0:null,tags:a=Array.isArray(p)&&p.length>0&&p.every(Number.isInteger)?null!==(r=l("taxonomy","post_tag",{include:p,context:"view"}))&&void 0!==r?r:void 0:null,isReady:void 0!==i&&void 0!==s&&void 0!==a}}),[]);return{authors:e.authors,categories:e.categories,tags:e.tags,isReady:e.isReady}}(),m=v.authors,w=v.categories,_=v.tags,b=v.isReady;(0,l.useEffect)((function(){if(b){var e=function(e){return function(e){return!(!Array.isArray(e)||0===e.length)&&e.every((function(e){return"name"in e&&"id"in e&&"slug"in e&&"description"in e&&"link"in e}))}(e)?e.map((function(e){return e.name})):[]};y({authors:e(m),categories:e(w),tags:e(_)})}}),[m,w,_,b]);var x=(0,l.useState)(!0),k=x[0],S=x[1],j=(0,l.useState)(),C=j[0],N=j[1],A=(0,l.useState)(),R=A[0],I=A[1],B=(0,l.useState)([]),M=B[0],D=B[1],V=(0,l.useState)({type:o.RelatedPosts.FilterBy,value:o.RelatedPosts.FilterValue}),F=V[0],G=V[1],H=(0,l.useState)(void 0),z=H[0],W=H[1],U=(0,O.useDebounce)(W,1e3);(0,a.useSelect)((function(e){var t=e("core/editor").getEditedPostContent;U(t())}),[U]);var Z=function(e,t){u({RelatedPosts:At(At({},o.RelatedPosts),{FilterBy:e,FilterValue:t})})};return(0,l.useEffect)((function(){var e,t,n=function(e){return Ot(void 0,void 0,void 0,(function(){return Rt(this,(function(t){return Nt.getInstance().getRelatedPosts(p,d,F).then((function(e){D(e.posts),I(e.message),S(!1)})).catch((function(t){return Ot(void 0,void 0,void 0,(function(){return Rt(this,(function(r){switch(r.label){case 0:return e>0&&t.retryFetch?[4,new Promise((function(e){return setTimeout(e,500)}))]:[3,3];case 1:return r.sent(),[4,n(e-1)];case 2:return r.sent(),[3,4];case 3:S(!1),N(t),r.label=4;case 4:return[2]}}))}))})),[2]}))}))},i=r.Author===F.type,s=r.Tag===F.type,a=r.Section===F.type,o=r.Unavailable===F.type,l=0===g.authors.length,c=0===g.tags.length,u=0===g.categories.length,f=i&&!g.authors.includes(F.value),h=s&&!g.tags.includes(F.value),y=a&&!g.categories.includes(F.value);return S(!0),o||s&&c||a&&u||i&&l?Object.values(g).every((function(e){return 0===e.length}))||G((e="",t=r.Unavailable,g.tags.length>=1?(t=r.Tag,e=g.tags[0]):g.categories.length>=1?(t=r.Section,e=g.categories[0]):g.authors.length>=1&&(t=r.Author,e=g.authors[0]),{type:t,value:e})):h?G({type:r.Tag,value:g.tags[0]}):y?G({type:r.Section,value:g.categories[0]}):f?G({type:r.Author,value:g.authors[0]}):n(1),function(){S(!1),D([]),I(""),N(void 0)}}),[p,d,F,g]),0===g.authors.length&&0===g.categories.length&&0===g.tags.length&&b?(0,i.jsx)("div",{className:"wp-parsely-related-posts",children:(0,i.jsx)("div",{className:"related-posts-body",children:(0,c.__)("Error: No author, section, or tags could be found for this post.","wp-parsely")})}):(0,i.jsxs)("div",{className:"wp-parsely-related-posts",children:[(0,i.jsx)("div",{className:"related-posts-description",children:(0,c.__)("Find top-performing related posts based on a key metric.","wp-parsely")}),(0,i.jsxs)("div",{className:"related-posts-body",children:[(0,i.jsxs)("div",{className:"related-posts-settings",children:[(0,i.jsx)(s.SelectControl,{size:"__unstable-large",onChange:function(e){var n;T(n=e,t)&&(u({RelatedPosts:At(At({},o.RelatedPosts),{Metric:n})}),h.trackEvent("related_posts_metric_changed",{metric:n}))},prefix:(0,i.jsx)(s.__experimentalInputControlPrefixWrapper,{children:(0,c.__)("Metric: ","wp-parsely")}),value:d,children:Object.values(t).map((function(e){return(0,i.jsx)("option",{value:e,children:L(e)},e)}))}),(0,i.jsx)(s.SelectControl,{size:"__unstable-large",value:p,prefix:(0,i.jsxs)(s.__experimentalInputControlPrefixWrapper,{children:[(0,c.__)("Period: ","wp-parsely")," "]}),onChange:function(t){return function(t){T(t,e)&&(u({RelatedPosts:At(At({},o.RelatedPosts),{Period:t})}),h.trackEvent("related_posts_period_changed",{period:t}))}(t)},children:Object.values(e).map((function(e){return(0,i.jsx)("option",{value:e,children:E(e)},e)}))})]}),(0,i.jsx)(mt,{label:(0,c.__)("Filter by","wp-parsely"),filter:F,onFilterTypeChange:function(e){if(T(e,r)){var t="",n=e;r.Tag===n&&(t=g.tags[0]),r.Section===n&&(t=g.categories[0]),r.Author===n&&(t=g.authors[0]),""!==t&&(Z(n,t),G({type:n,value:t}),h.trackEvent("related_posts_filter_type_changed",{filter_type:n}))}},onFilterValueChange:function(e){"string"==typeof e&&(Z(F.type,e),G(At(At({},F),{value:e})))},postData:g}),(0,i.jsxs)("div",{className:"related-posts-wrapper",children:[(0,i.jsx)("div",{children:(0,i.jsx)("p",{className:"related-posts-descr","data-testid":"parsely-related-posts-descr",children:r.Tag===F.type?(0,c.sprintf)(/* translators: 1: tag name, 2: period */
(0,c.__)("Top related posts with the “%1$s” tag in the %2$s.","wp-parsely"),F.value,E(p,!0)):r.Section===F.type?(0,c.sprintf)(/* translators: 1: section name, 2: period */
(0,c.__)("Top related posts in the “%1$s” section in the %2$s.","wp-parsely"),F.value,E(p,!0)):r.Author===F.type?(0,c.sprintf)(/* translators: 1: author name, 2: period */
(0,c.__)("Top related posts by %1$s in the %2$s.","wp-parsely"),F.value,E(p,!0)):null!=R?R:""})}),C&&C.Message(),k&&(0,i.jsx)("div",{className:"related-posts-loading-message","data-testid":"parsely-related-posts-loading-message",children:(0,c.__)("Loading…","wp-parsely")}),!k&&!C&&0===M.length&&(0,i.jsx)("div",{className:"related-posts-empty","data-testid":"parsely-related-posts-empty",children:(0,c.__)("No related posts found.","wp-parsely")}),!k&&M.length>0&&(0,i.jsx)("div",{className:"related-posts-list",children:M.map((function(e){return(0,i.jsx)(St,{metric:d,post:e,postContent:z},e.id)}))})]})]})]})},Bt=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),Mt=function(){return(0,i.jsx)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",children:(0,i.jsx)(s.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M13.5034 7.91642L9 12.0104L4.49662 7.91642L5.25337 7.08398L8.99999 10.49L12.7466 7.08398L13.5034 7.91642Z",fill:"#1E1E1E"})})},Dt={journalist:{label:(0,c.__)("Journalist","wp-parsely")},editorialWriter:{label:(0,c.__)("Editorial Writer","wp-parsely")},investigativeReporter:{label:(0,c.__)("Investigative Reporter","wp-parsely")},techAnalyst:{label:(0,c.__)("Tech Analyst","wp-parsely")},businessAnalyst:{label:(0,c.__)("Business Analyst","wp-parsely")},culturalCommentator:{label:(0,c.__)("Cultural Commentator","wp-parsely")},scienceCorrespondent:{label:(0,c.__)("Science Correspondent","wp-parsely")},politicalAnalyst:{label:(0,c.__)("Political Analyst","wp-parsely")},healthWellnessAdvocate:{label:(0,c.__)("Health and Wellness Advocate","wp-parsely")},environmentalJournalist:{label:(0,c.__)("Environmental Journalist","wp-parsely")},custom:{label:(0,c.__)("Custom Persona","wp-parsely"),icon:Bt}},Vt=Object.keys(Dt),Ft=function(e){return"custom"===e||""===e?Dt.custom.label:Gt(e)?e:Dt[e].label},Gt=function(e){return!Vt.includes(e)||"custom"===e},Ht=function(e){var t=e.value,n=e.onChange,r=(0,l.useState)(""),a=r[0],o=r[1],u=(0,O.useDebounce)(n,500);return(0,i.jsx)("div",{className:"parsely-persona-selector-custom",children:(0,i.jsx)(s.TextControl,{value:a||t,placeholder:(0,c.__)("Enter a custom persona…","wp-parsely"),onChange:function(e){if(""===e)return n(""),void o("");e.length>32&&(e=e.slice(0,32)),u(e),o(e)}})})},zt=function(e){var t=e.persona,n=e.value,r=void 0===n?(0,c.__)("Select a persona…","wp-parsely"):n,a=e.label,o=void 0===a?(0,c.__)("Persona","wp-parsely"):a,l=e.onChange,u=e.onDropdownChange,p=e.disabled,d=void 0!==p&&p,f=e.allowCustom,h=void 0!==f&&f;return(0,i.jsxs)(s.Disabled,{isDisabled:d,children:[o&&(0,i.jsx)("div",{className:"wp-parsely-dropdown-label",children:o}),(0,i.jsx)(s.DropdownMenu,{label:(0,c.__)("Persona","wp-parsely"),className:"parsely-persona-selector-dropdown"+(d?" is-disabled":""),popoverProps:{className:"wp-parsely-popover"},toggleProps:{children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"parsely-persona-selector-label",children:Gt(t)?Dt.custom.label:r}),(0,i.jsx)(Mt,{})]})},children:function(e){var n=e.onClose;return(0,i.jsx)(s.MenuGroup,{label:(0,c.__)("Persona","wp-parsely"),children:(0,i.jsx)(i.Fragment,{children:Vt.map((function(e){if(!h&&"custom"===e)return null;var r=Dt[e],a=e===t||Gt(t)&&"custom"===e;return(0,i.jsxs)(s.MenuItem,{isSelected:a,className:a?"is-selected":"",role:"menuitemradio",onClick:function(){null==u||u(e),l(e),n(),"custom"===e&&setTimeout((function(){var e=document.querySelector(".parsely-persona-selector-custom input");e&&e.focus()}),0)},children:[r.icon&&(0,i.jsx)(F,{icon:r.icon}),r.label]},e)}))})})}}),h&&Gt(t)&&(0,i.jsx)(Ht,{onChange:function(e){l(""!==e?e:"custom")},value:"custom"===t?"":t})]})},Wt={neutral:{label:(0,c.__)("Neutral","wp-parsely")},formal:{label:(0,c.__)("Formal","wp-parsely")},humorous:{label:(0,c.__)("Humorous","wp-parsely")},confident:{label:(0,c.__)("Confident","wp-parsely")},provocative:{label:(0,c.__)("Provocative","wp-parsely")},serious:{label:(0,c.__)("Serious","wp-parsely")},inspirational:{label:(0,c.__)("Inspirational","wp-parsely")},skeptical:{label:(0,c.__)("Skeptical","wp-parsely")},conversational:{label:(0,c.__)("Conversational","wp-parsely")},analytical:{label:(0,c.__)("Analytical","wp-parsely")},custom:{label:(0,c.__)("Custom Tone","wp-parsely"),icon:Bt}},Ut=Object.keys(Wt),Zt=function(e){return"custom"===e||""===e?Wt.custom.label:qt(e)?e:Wt[e].label},qt=function(e){return!Ut.includes(e)||"custom"===e},$t=function(e){var t=e.value,n=e.onChange,r=(0,l.useState)(""),a=r[0],o=r[1],u=(0,O.useDebounce)(n,500);return(0,i.jsx)("div",{className:"parsely-tone-selector-custom",children:(0,i.jsx)(s.TextControl,{value:a||t,placeholder:(0,c.__)("Enter a custom tone","wp-parsely"),onChange:function(e){if(""===e)return n(""),void o("");e.length>32&&(e=e.slice(0,32)),u(e),o(e)}})})},Kt=function(e){var t=e.tone,n=e.value,r=void 0===n?(0,c.__)("Select a tone","wp-parsely"):n,a=e.label,o=void 0===a?(0,c.__)("Tone","wp-parsely"):a,l=e.onChange,u=e.onDropdownChange,p=e.disabled,d=void 0!==p&&p,f=e.allowCustom,h=void 0!==f&&f;return(0,i.jsxs)(s.Disabled,{isDisabled:d,children:[(0,i.jsx)("div",{className:"wp-parsely-dropdown-label",children:o}),(0,i.jsx)(s.DropdownMenu,{label:(0,c.__)("Tone","wp-parsely"),className:"parsely-tone-selector-dropdown"+(d?" is-disabled":""),popoverProps:{className:"wp-parsely-popover"},toggleProps:{children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"parsely-tone-selector-label",children:qt(t)?Wt.custom.label:r}),(0,i.jsx)(Mt,{})]})},children:function(e){var n=e.onClose;return(0,i.jsx)(s.MenuGroup,{label:(0,c.__)("Select a tone","wp-parsely"),children:(0,i.jsx)(i.Fragment,{children:Ut.map((function(e){if(!h&&"custom"===e)return null;var r=Wt[e],a=e===t||qt(t)&&"custom"===e;return(0,i.jsxs)(s.MenuItem,{isSelected:a,className:a?"is-selected":"",role:"menuitemradio",onClick:function(){null==u||u(e),l(e),n(),"custom"===e&&setTimeout((function(){var e=document.querySelector(".parsely-tone-selector-custom input");e&&e.focus()}),0)},children:[r.icon&&(0,i.jsx)(F,{icon:r.icon}),r.label]},e)}))})})}}),h&&qt(t)&&(0,i.jsx)($t,{onChange:function(e){l(""!==e?e:"custom")},value:"custom"===t?"":t})]})},Yt=(0,u.createElement)(p.SVG,{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,u.createElement)(p.Path,{d:"M10.97 10.159a3.382 3.382 0 0 0-2.857.955l1.724 1.723-2.836 2.913L7 17h1.25l2.913-2.837 1.723 1.723a3.38 3.38 0 0 0 .606-.825c.33-.63.446-1.343.35-2.032L17 10.695 13.305 7l-2.334 3.159Z"})),Qt=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"M18.3 11.7c-.6-.6-1.4-.9-2.3-.9H6.7l2.9-3.3-1.1-1-4.5 5L8.5 16l1-1-2.7-2.7H16c.5 0 .9.2 1.3.5 1 1 1 3.4 1 4.5v.3h1.5v-.2c0-1.5 0-4.3-1.5-5.7z"})),Xt=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})),Jt=(0,u.createElement)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,u.createElement)(p.Path,{d:"m21.5 9.1-6.6-6.6-4.2 5.6c-1.2-.1-2.4.1-3.6.7-.1 0-.1.1-.2.1-.5.3-.9.6-1.2.9l3.7 3.7-5.7 5.7v1.1h1.1l5.7-5.7 3.7 3.7c.4-.4.7-.8.9-1.2.1-.1.1-.2.2-.3.6-1.1.8-2.4.6-3.6l5.6-4.1zm-7.3 3.5.1.9c.1.9 0 1.8-.4 2.6l-6-6c.8-.4 1.7-.5 2.6-.4l.9.1L15 4.9 19.1 9l-4.9 3.6z"})),en=function(){return en=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},en.apply(this,arguments)},tn=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},nn=0;!function(e){e.PostTitle="postTitles",e.Heading="headings"}(xt||(xt={}));var rn={isLoading:!1,postTitles:{titles:[]},headings:{titles:[]}},sn=(0,a.createReduxStore)("wp-parsely/write-titles",{initialState:rn,reducer:function(e,t){var n,r,i,s,a,o;switch(void 0===e&&(e=rn),t.type){case"SET_LOADING":return en(en({},e),{isLoading:t.isLoading});case"SET_TITLES":return en(en({},e),((n={})[t.titleType]=en(en({},e[t.titleType]),{titles:tn(tn([],e[t.titleType].titles.filter((function(e){return e.isPinned})),!0),t.data.map((function(e){return{title:e,isPinned:!1,id:nn++}})),!0)}),n));case"REMOVE_TITLE":return en(en({},e),((r={})[t.titleType]=en(en({},e[t.titleType]),{titles:e[t.titleType].titles.filter((function(e){return e.id!==t.title.id}))}),r));case"PIN_TITLE":return en(en({},e),((i={})[t.titleType]=en(en({},e[t.titleType]),{titles:e[t.titleType].titles.map((function(e){return e.id===t.title.id?en(en({},e),{isPinned:!0}):e}))}),i));case"UNPIN_TITLE":return en(en({},e),((s={})[t.titleType]=en(en({},e[t.titleType]),{titles:e[t.titleType].titles.map((function(e){return e.id===t.title.id?en(en({},e),{isPinned:!1}):e}))}),s));case"SET_ACCEPTED_TITLE":return en(en({},e),((a={})[t.titleType]=en(en({},e[t.titleType]),{acceptedTitle:t.title}),a));case"SET_ORIGINAL_TITLE":return en(en({},e),((o={})[t.titleType]=en(en({},e[t.titleType]),{originalTitle:t.title}),o));default:return e}},actions:{setLoading:function(e){return{type:"SET_LOADING",isLoading:e}},setTitles:function(e,t){return{type:"SET_TITLES",titleType:e,data:t}},removeTitle:function(e,t){return{type:"REMOVE_TITLE",titleType:e,title:t}},setAcceptedTitle:function(e,t){return{type:"SET_ACCEPTED_TITLE",titleType:e,title:t}},pinTitle:function(e,t){return{type:"PIN_TITLE",titleType:e,title:t}},unpinTitle:function(e,t){return{type:"UNPIN_TITLE",titleType:e,title:t}},setOriginalTitle:function(e,t){return{type:"SET_ORIGINAL_TITLE",titleType:e,title:t}}},selectors:{getState:function(e){return e},isLoading:function(e){return e.isLoading},getTitles:function(e,t){return e[t].titles.map((function(e){return e}))},getPinnedTitles:function(e,t){return e[t].titles.filter((function(e){return e.isPinned}))},isPinned:function(e,t,n){var r,i;return null!==(i=null===(r=e[t].titles.find((function(e){return e.id===n.id})))||void 0===r?void 0:r.isPinned)&&void 0!==i&&i},getAcceptedTitle:function(e,t){return e[t].acceptedTitle},isAcceptedTitle:function(e,t,n){var r;return(null===(r=e[t].acceptedTitle)||void 0===r?void 0:r.id)===n.id},getOriginalTitle:function(e,t){var n;if(e[t].originalTitle)return{id:-1,title:null!==(n=e[t].originalTitle)&&void 0!==n?n:"",isPinned:!1}}}});(0,a.register)(sn);var an=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))},on=function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},ln=function(){return(0,i.jsx)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",width:"1",height:"40",viewBox:"0 0 1 40",fill:"none",children:(0,i.jsx)(s.Rect,{width:"1",height:"40",fill:"#cccccc"})})},cn=function(e){var t=(0,l.useState)(!1),n=t[0],r=t[1],o=function(){return r(!1)},u=(0,a.useDispatch)(sn),p=u.removeTitle,d=u.setAcceptedTitle,f=u.pinTitle,g=u.unpinTitle,y=u.setOriginalTitle,v=(0,a.useSelect)((function(t){return t(sn).isPinned(e.type,e.title)}),[e.title,e.type]),m=(0,a.useSelect)((function(e){return(0,e("core/editor").getEditedPostAttribute)("title")}),[]),w=m===e.title.title,_=function(){return an(void 0,void 0,void 0,(function(){return on(this,(function(t){switch(t.label){case 0:return h.trackEvent("title_suggestion_pinned",{pinned:!v,type:e.type,title:e.title.title}),v?[4,g(e.type,e.title)]:[3,2];case 1:return t.sent(),[3,4];case 2:return[4,f(e.type,e.title)];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"wp-parsely-title-suggestion"+(w?" title-in-use":"")+(e.isOriginal?" original-title":"")+(v?" pinned-title":""),children:[(0,i.jsxs)("div",{className:"suggested-title",children:[e.isOriginal&&(0,i.jsx)(s.__experimentalHeading,{className:"suggested-title-original",level:3,children:(0,c.__)("Original","wp-parsely")}),e.title.title]}),(0,i.jsx)("div",{className:"suggested-title-actions",children:(0,i.jsxs)("div",{className:"suggested-title-actions-container",children:[e.isOriginal&&(0,i.jsx)(s.Button,{onClick:function(){return an(void 0,void 0,void 0,(function(){return on(this,(function(t){switch(t.label){case 0:return h.trackEvent("title_suggestion_restored",{type:e.type,restored_title:e.title.title,accepted_title:m}),(0,a.dispatch)("core/editor").editPost({title:e.title.title}),[4,y(e.type,void 0)];case 1:return t.sent(),[2]}}))}))},icon:Qt,label:(0,c.__)("Restore","wp-parsely")}),!e.isOriginal&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"suggested-title-actions-left",children:[(0,i.jsx)(s.Button,{onClick:function(){w||r(!0)},disabled:w,icon:se,label:w?(0,c.__)("Applied","wp-parsely"):(0,c.__)("Apply","wp-parsely")}),!v&&(0,i.jsx)(s.Button,{onClick:function(){return an(void 0,void 0,void 0,(function(){return on(this,(function(t){switch(t.label){case 0:return h.trackEvent("title_suggestion_removed",{type:e.type,title:e.title.title}),[4,p(e.type,e.title)];case 1:return t.sent(),[2]}}))}))},icon:Xt,label:(0,c.__)("Remove","wp-parsely")})]}),(0,i.jsx)(ln,{}),(0,i.jsx)("div",{className:"suggested-title-actions-right",children:v?(0,i.jsx)(s.Button,{onClick:_,icon:Be,label:(0,c.__)("Unpin","wp-parsely")}):(0,i.jsx)(s.Button,{onClick:_,icon:Jt,label:(0,c.__)("Pin","wp-parsely")})})]})]})})]}),n&&(0,i.jsx)(s.Modal,{title:(0,c.__)("Replace Title?","wp-parsely"),onRequestClose:o,children:(0,i.jsxs)("div",{className:"wp-parsely-suggested-title-modal",children:[(0,i.jsx)("h2",{children:e.title.title}),(0,c.__)("You'll still be able to restore your original title until you exit the editor.","wp-parsely"),(0,i.jsxs)("div",{className:"suggested-title-modal-actions",children:[(0,i.jsx)(s.Button,{onClick:o,variant:"secondary",children:(0,c.__)("Cancel","wp-parsely")}),(0,i.jsx)(s.Button,{onClick:function(){return an(void 0,void 0,void 0,(function(){return on(this,(function(t){switch(t.label){case 0:return w?[2]:(h.trackEvent("title_suggestion_applied",{title:e.title.title,type:e.type}),[4,d(e.type,e.title)]);case 1:return t.sent(),o(),[2]}}))}))},variant:"primary",children:(0,c.__)("Replace","wp-parsely")})]})]})})]})},un=function(e){var t=e.pinnedTitles,n=e.isOpen,r=(0,l.useState)(n),a=r[0],o=r[1];return(0,i.jsx)(s.Panel,{className:"wp-parsely-pinned-suggestions",children:(0,i.jsx)(s.PanelBody,{className:"wp-parsely-collapsible-panel",icon:Yt,title:(0,c.__)("Pinned","wp-parsely"),onToggle:function(){o(!a),h.trackEvent("title_suggestions_pinned_toggled",{is_open:!a,pinned_titles:t.length})},opened:a,children:(0,i.jsx)("div",{className:"title-suggestions-container",children:t.map((function(e){return(0,i.jsx)(cn,{title:e,type:xt.PostTitle},e.title)}))})})})},pn=function(e){var t=e.isLoading,n=e.onPersonaChange,r=e.onToneChange,s=e.persona,a=e.tone;return(0,i.jsxs)("div",{className:"title-suggestions-settings",children:[(0,i.jsx)(Kt,{tone:a,value:Zt(a),onChange:function(e){r(e)},onDropdownChange:function(e){h.trackEvent("title_suggestions_ai_tone_changed",{tone:e})},disabled:t,allowCustom:!0}),(0,i.jsx)(zt,{persona:s,value:Ft(s),onChange:function(e){n(e)},onDropdownChange:function(e){h.trackEvent("title_suggestions_ai_persona_changed",{persona:e})},disabled:t,allowCustom:!0})]})},dn=function(e){var t=e.size,n=void 0===t?24:t,r=e.className,a=void 0===r?"wp-parsely-icon":r;return(0,i.jsxs)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",className:a,width:n,height:n,viewBox:"0 0 24 24",fill:"none",children:[(0,i.jsx)(s.Path,{d:"M8.18983 5.90381L8.83642 7.54325L10.4758 8.18983L8.83642 8.8364L8.18983 10.4759L7.54324 8.8364L5.90381 8.18983L7.54324 7.54325L8.18983 5.90381Z"}),(0,i.jsx)(s.Path,{d:"M15.048 5.90381L15.9101 8.08972L18.0961 8.95186L15.9101 9.81397L15.048 11.9999L14.1859 9.81397L12 8.95186L14.1859 8.08972L15.048 5.90381Z"}),(0,i.jsx)(s.Path,{d:"M11.238 10.4761L12.3157 13.2085L15.048 14.2861L12.3157 15.3638L11.238 18.0962L10.1603 15.3638L7.42798 14.2861L10.1603 13.2085L11.238 10.4761Z"})]})},fn=function(e){var t=e.suggestions,n=e.isOpen,r=e.isLoading,a=void 0!==r&&r,o=(0,l.useState)(n),u=o[0],p=o[1];return(0,i.jsx)(s.Panel,{className:"wp-parsely-title-suggestions",children:(0,i.jsx)(s.PanelBody,{className:"wp-parsely-collapsible-panel",title:(0,c.__)("Suggestions","wp-parsely"),icon:(0,i.jsx)(dn,{className:"components-panel__icon"}),onToggle:function(){p(!u),h.trackEvent("title_suggestions_suggestions_toggled",{is_open:!u,suggestions:t.length})},opened:u,children:(0,i.jsxs)("div",{className:"title-suggestions-container",children:[a&&(0,i.jsxs)("div",{className:"wp-parsely-loading-overlay",children:[(0,i.jsx)(s.Spinner,{}),(0,c.__)("Loading…","wp-parsely")]}),t.map((function(e){return(0,i.jsx)(cn,{title:e,type:xt.PostTitle},e.title)}))]})})})},hn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),gn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return hn(t,e),t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.generateTitles=function(e){return t=this,n=arguments,i=function(e,t,n,r){var i;return void 0===t&&(t=3),function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}(this,(function(s){return[2,null!=(i=this.fetch({method:"POST",path:(0,oe.addQueryArgs)("/wp-parsely/v1/content-suggestions/suggest-headline",{limit:t,tone:Zt(n),persona:Ft(r)}),data:{content:e}}))?i:[]]}))},new((r=void 0)||(r=Promise))((function(e,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i},t}(ve),yn=function(){return yn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},yn.apply(this,arguments)},vn=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))},mn=function(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},wn=function(){var e=P(),t=e.settings,n=e.setSettings,r=(0,l.useState)(),o=r[0],u=r[1],p=(0,l.useState)(t.TitleSuggestions.Tone),d=p[0],f=p[1],g=(0,l.useState)(t.TitleSuggestions.Persona),y=g[0],v=g[1],m=(0,a.useSelect)((function(e){var t=e(sn),n=t.isLoading,r=t.getTitles,i=t.getAcceptedTitle,s=t.getOriginalTitle,a=r(xt.PostTitle);return{acceptedTitle:i(xt.PostTitle),loading:n(),titles:a.filter((function(e){return!e.isPinned})),pinnedTitles:a.filter((function(e){return e.isPinned})),allTitles:a,originalTitle:s(xt.PostTitle)}}),[]),w=m.loading,_=m.titles,b=m.pinnedTitles,x=m.allTitles,k=m.acceptedTitle,S=m.originalTitle,j=(0,a.useDispatch)(sn),T=j.setTitles,E=j.setLoading,L=j.setAcceptedTitle,C=j.setOriginalTitle,N=(0,a.useDispatch)("core/notices").createNotice,A=function(e,r){var i;n({TitleSuggestions:yn(yn({},t.TitleSuggestions),(i={},i[e]=r,i))})},O=(0,a.useSelect)((function(e){return(0,e("core/editor").getEditedPostContent)()}),[]),R=(0,a.useSelect)((function(e){return(0,e("core/editor").getEditedPostAttribute)("title")}),[]);return(0,l.useEffect)((function(){k&&(C(xt.PostTitle,R),(0,a.dispatch)("core/editor").editPost({title:null==k?void 0:k.title}),k&&((0,a.dispatch)(sn).pinTitle(xt.PostTitle,k),h.trackEvent("title_suggestions_accept_pressed",{old_title:R,new_title:k.title})),L(xt.PostTitle,void 0),N("success",(0,c.__)("Title suggestion applied.","wp-parsely"),{type:"snackbar",className:"parsely-title-suggestion-applied",explicitDismiss:!0,actions:[{label:(0,c.__)("Undo","wp-parsely"),onClick:function(){(0,a.dispatch)("core/editor").editPost({title:R}),C(xt.PostTitle,void 0)}}]}))}),[k]),(0,l.useEffect)((function(){void 0!==o&&N("error",(0,c.__)("There was an error generating title suggestions.","wp-parsely"),{type:"snackbar",className:"parsely-title-suggestion-error"})}),[o]),(0,i.jsx)(s.PanelRow,{children:(0,i.jsxs)("div",{className:"wp-parsely-title-suggestions-wrapper",children:[(0,i.jsxs)("div",{className:"title-suggestions-header",children:[x.length>0?(0,i.jsx)("span",{className:"parsely-write-titles-text",children:(0,l.createInterpolateElement)(
// translators: %1$s is the tone, %2$s is the persona.
(0,c.__)("We've generated a few <tone/> titles based on the content of your post, written as a <persona/>.","wp-parsely"),{tone:(0,i.jsx)("strong",{children:Zt(d)}),persona:(0,i.jsx)("strong",{children:Ft(y)})})}):(0,c.__)("Use Parse.ly AI to generate a title for your post.","wp-parsely"),(0,i.jsxs)(s.Button,{href:"https://docs.parse.ly/plugin-content-helper/#h-title-suggestions-beta",target:"_blank",variant:"link",children:[(0,c.__)("Learn more about Parse.ly AI","wp-parsely"),(0,i.jsx)(F,{icon:G,size:18,className:"parsely-external-link-icon"})]})]}),o&&(0,i.jsx)(s.Notice,{status:"info",className:"wp-parsely-content-helper-error",children:o.Message()}),void 0!==S&&(0,i.jsx)(cn,{title:S,type:xt.PostTitle,isOriginal:!0}),0<x.length&&(0,i.jsxs)(i.Fragment,{children:[b.length>0&&(0,i.jsx)(un,{pinnedTitles:b,isOpen:!0}),_.length>0&&(0,i.jsx)(fn,{suggestions:_,isOpen:!0,isLoading:w})]}),(0,i.jsx)(pn,{isLoading:w,onPersonaChange:function(e){A("Persona",e),v(e)},onSettingChange:A,onToneChange:function(e){A("Tone",e),f(e)},persona:t.TitleSuggestions.Persona,tone:t.TitleSuggestions.Tone}),(0,i.jsx)("div",{className:"title-suggestions-generate",children:(0,i.jsxs)(s.Button,{variant:"primary",isBusy:w,disabled:w||"custom"===d||"custom"===y,onClick:function(){return vn(void 0,void 0,void 0,(function(){return mn(this,(function(e){switch(e.label){case 0:return u(void 0),!1!==w?[3,2]:(h.trackEvent("title_suggestions_generate_pressed",{request_more:_.length>0,total_titles:_.length,total_pinned:_.filter((function(e){return e.isPinned})).length,tone:d,persona:y}),[4,(t=xt.PostTitle,n=O,r=d,i=y,vn(void 0,void 0,void 0,(function(){var e,s,a;return mn(this,(function(o){switch(o.label){case 0:return[4,E(!0)];case 1:o.sent(),e=gn.getInstance(),o.label=2;case 2:return o.trys.push([2,5,,6]),[4,e.generateTitles(n,3,r,i)];case 3:return s=o.sent(),[4,T(t,s)];case 4:return o.sent(),[3,6];case 5:return a=o.sent(),u(a),T(t,[]),[3,6];case 6:return[4,E(!1)];case 7:return o.sent(),[2]}}))})))]);case 1:e.sent(),e.label=2;case 2:return[2]}var t,n,r,i}))}))},children:[w&&(0,c.__)("Generating Titles…","wp-parsely"),!w&&x.length>0&&(0,c.__)("Generate More","wp-parsely"),!w&&0===x.length&&(0,c.__)("Generate Titles","wp-parsely")]})})]})})},bn=function(){return bn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},bn.apply(this,arguments)},xn=function(e){var t=e.trackToggle,n=P(),r=n.settings,a=n.setSettings;return(0,i.jsxs)(s.Panel,{children:[(0,i.jsx)(s.PanelBody,{title:(0,c.__)("Title Suggestions (Beta)","wp-parsely"),initialOpen:r.TitleSuggestions.Open,onToggle:function(e){a({TitleSuggestions:bn(bn({},r.TitleSuggestions),{Open:e})}),t("title_suggestions",e)},children:(0,i.jsx)(D,{children:(0,i.jsx)(wn,{})})}),(0,i.jsx)(s.PanelBody,{title:(0,c.__)("Smart Linking (Beta)","wp-parsely"),initialOpen:r.SmartLinking.Open,onToggle:function(e){a({SmartLinking:bn(bn({},r.SmartLinking),{Open:e})}),t("smart_linking",e)},children:(0,i.jsx)(D,{children:(0,i.jsx)(je,{context:ee.ContentHelperSidebar})})}),(0,i.jsx)(s.PanelBody,{title:(0,c.__)("Related Posts","wp-parsely"),initialOpen:r.RelatedPosts.Open,onToggle:function(e){a({RelatedPosts:bn(bn({},r.RelatedPosts),{Open:e})}),t("related_top_posts",e)},children:(0,i.jsx)(D,{children:(0,i.jsx)(It,{})})})]})},kn=function(){return kn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},kn.apply(this,arguments)},Sn=function(n){void 0===n&&(n="");var i,s={InitialTabName:"tools",PerformanceStats:{Period:e.Days7,VisiblePanels:["overview","categories","referrers"],VisibleDataPoints:["views","visitors","avgEngaged","recirculation"]},RelatedPosts:{FilterBy:r.Unavailable,FilterValue:"",Metric:t.Views,Open:!1,Period:e.Days7},SmartLinking:{MaxLinks:Ne,MaxLinkWords:Ae,Open:!1},TitleSuggestions:{Open:!1,Tone:"neutral",Persona:"journalist"}};""===n&&(n=window.wpParselyContentHelperSettings);try{i=JSON.parse(n)}catch(e){return s}var a=kn(kn({},s),i);return"string"!=typeof a.InitialTabName&&(a.InitialTabName=s.InitialTabName),"object"!=typeof a.PerformanceStats&&(a.PerformanceStats=s.PerformanceStats),T(a.PerformanceStats.Period,e)||(a.PerformanceStats.Period=s.PerformanceStats.Period),Array.isArray(a.PerformanceStats.VisiblePanels)||(a.PerformanceStats.VisiblePanels=s.PerformanceStats.VisiblePanels),Array.isArray(a.PerformanceStats.VisibleDataPoints)||(a.PerformanceStats.VisibleDataPoints=s.PerformanceStats.VisibleDataPoints),"object"!=typeof a.RelatedPosts&&(a.RelatedPosts=s.RelatedPosts),T(a.RelatedPosts.FilterBy,r)||(a.RelatedPosts.FilterBy=s.RelatedPosts.FilterBy),"string"!=typeof a.RelatedPosts.FilterValue&&(a.RelatedPosts.FilterValue=s.RelatedPosts.FilterValue),T(a.RelatedPosts.Metric,t)||(a.RelatedPosts.Metric=s.RelatedPosts.Metric),"boolean"!=typeof a.RelatedPosts.Open&&(a.RelatedPosts.Open=s.RelatedPosts.Open),T(a.RelatedPosts.Period,e)||(a.RelatedPosts.Period=s.RelatedPosts.Period),"object"!=typeof a.SmartLinking&&(a.SmartLinking=s.SmartLinking),"number"!=typeof a.SmartLinking.MaxLinks&&(a.SmartLinking.MaxLinks=s.SmartLinking.MaxLinks),"number"!=typeof a.SmartLinking.MaxLinkWords&&(a.SmartLinking.MaxLinkWords=s.SmartLinking.MaxLinkWords),"boolean"!=typeof a.SmartLinking.Open&&(a.SmartLinking.Open=s.SmartLinking.Open),"object"!=typeof a.TitleSuggestions&&(a.TitleSuggestions=s.TitleSuggestions),"boolean"!=typeof a.TitleSuggestions.Open&&(a.TitleSuggestions.Open=s.TitleSuggestions.Open),"string"!=typeof a.TitleSuggestions.Tone&&(a.TitleSuggestions.Tone=s.TitleSuggestions.Tone),"string"!=typeof a.TitleSuggestions.Persona&&(a.TitleSuggestions.Persona=s.TitleSuggestions.Persona),a},Pn=function(){var e=P(),t=e.settings,n=e.setSettings,r=(0,a.useSelect)((function(e){return e("core/interface").getActiveComplementaryArea("core/edit-post")}),[]);(0,l.useEffect)((function(){"wp-parsely-block-editor-sidebar/wp-parsely-content-helper"===r&&h.trackEvent("editor_sidebar_opened")}),[r]);var u=function(e,t){t?h.trackEvent("editor_sidebar_panel_opened",{panel:e}):h.trackEvent("editor_sidebar_panel_closed",{panel:e})};return(0,i.jsx)(o.PluginSidebar,{icon:(0,i.jsx)(y,{className:"wp-parsely-sidebar-icon"}),name:"wp-parsely-content-helper",className:"wp-parsely-content-helper",title:(0,c.__)("Parse.ly","wp-parsely"),children:(0,i.jsx)(j,{endpoint:"editor-sidebar-settings",defaultSettings:Sn(),children:(0,i.jsx)(s.Panel,{className:"wp-parsely-sidebar-main-panel",children:(0,i.jsx)(s.TabPanel,{className:"wp-parsely-sidebar-tabs",initialTabName:t.InitialTabName,tabs:[{icon:(0,i.jsx)(g,{}),name:"tools",title:(0,c.__)("Tools","wp-parsely")},{icon:d,name:"performance",title:(0,c.__)("Performance","wp-parsely")}],onSelect:function(e){n(kn(kn({},t),{InitialTabName:e})),h.trackEvent("editor_sidebar_tab_selected",{tab:e})},children:function(e){return(0,i.jsxs)(i.Fragment,{children:["tools"===e.name&&(0,i.jsx)(xn,{trackToggle:u}),"performance"===e.name&&(0,i.jsx)(ht,{period:t.PerformanceStats.Period})]})}})})})})};(0,f.registerPlugin)("wp-parsely-block-editor-sidebar",{icon:y,render:function(){return(0,i.jsx)(j,{endpoint:"editor-sidebar-settings",defaultSettings:Sn(),children:(0,i.jsx)(Pn,{})})}}),(0,R.addFilter)("editor.BlockEdit","wpparsely/smart-linking-inspector-control-panel",Ie),(0,R.addFilter)("editor.BlockEdit","wpparsely/block-overlay",Le),(0,f.registerPlugin)("wp-parsely-block-overlay",{render:function(){return(0,a.useSelect)((function(e){return{overlayBlocks:(0,e(J).getOverlayBlocks)()}}),[]).overlayBlocks.includes("all")?(0,i.jsx)(Ee,{label:(0,c.__)("Generating Smart Links…","wp-parsely"),selectedBlockClientId:"all"}):(0,i.jsx)(i.Fragment,{})}})}()}();