!function(){"use strict";var e={251:function(e,t,r){var n=r(196),s=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,a={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,n)&&!l.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:s,type:e,key:c,ref:u,props:a,_owner:i.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},893:function(e,t,r){e.exports=r(251)},196:function(e){e.exports=window.React}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e,t,n=r(893),s=window.wp.element,a=function(e){void 0===e&&(e=null);var t="";(null==e?void 0:e.children)&&(t=e.children);var r="content-helper-error-message";return(null==e?void 0:e.className)&&(r+=" "+e.className),(0,n.jsx)("div",{className:r,"data-testid":null==e?void 0:e.testId,dangerouslySetInnerHTML:{__html:t}})},o=function(e){return void 0===e&&(e=null),(0,n.jsx)(a,{className:null==e?void 0:e.className,testId:"empty-credentials-message",children:window.wpParselyEmptyCredentialsMessage})},i=function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},i.apply(this,arguments)},l=function(e,t){var r=e.children;return void 0===t&&(t=null),window.wpParselyEmptyCredentialsMessage?(0,n.jsx)(o,i({},t)):(0,n.jsx)(n.Fragment,{children:r})},c=window.wp.components,u=function(e){var t=e.defaultValue,r=e.items,s=e.onChange;return(0,n.jsx)("select",{onChange:s,value:t,children:r.map((function(e){return(0,n.jsx)("option",{value:e[0],children:e[1]},e[0])}))})};!function(e){e.Day="1",e.Week="7",e.Month="30"}(e||(e={})),function(e){e.Views="views",e.AvgEngaged="avg_engaged"}(t||(t={}));var p,d,h=function(e,t){return Object.values(t).includes(e)},f=window.wp.apiFetch,y=r.n(f),v=window.wp.i18n,m=window.wp.url,w=(p=function(e,t){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},p(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function __(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)});!function(e){e.CannotFormulateApiQuery="ch_cannot_formulate_api_query",e.FetchError="fetch_error",e.HttpRequestFailed="http_request_failed",e[e.ParselyApiForbidden=403]="ParselyApiForbidden",e.ParselyApiResponseContainsError="ch_response_contains_error",e.ParselyApiReturnedNoData="ch_parsely_api_returned_no_data",e.ParselyApiReturnedTooManyResults="ch_parsely_api_returned_too_many_results",e.PluginCredentialsNotSetMessageDetected="parsely_credentials_not_set_message_detected",e.PluginSettingsApiSecretNotSet="parsely_api_secret_not_set",e.PluginSettingsSiteIdNotSet="parsely_site_id_not_set",e.PostIsNotPublished="ch_post_not_published"}(d||(d={}));var _=function(e){function t(r,n,s){void 0===s&&(s=(0,v.__)("Error: ","wp-parsely"));var a=e.call(this,s+r)||this;a.hint=null,a.name=a.constructor.name,a.code=n;var o=[d.ParselyApiForbidden,d.ParselyApiResponseContainsError,d.ParselyApiReturnedNoData,d.ParselyApiReturnedTooManyResults,d.PluginCredentialsNotSetMessageDetected,d.PluginSettingsApiSecretNotSet,d.PluginSettingsSiteIdNotSet,d.PostIsNotPublished];return a.retryFetch=!o.includes(a.code),Object.setPrototypeOf(a,t.prototype),a}return w(t,e),t.prototype.Message=function(e){return void 0===e&&(e=null),[d.PluginCredentialsNotSetMessageDetected,d.PluginSettingsSiteIdNotSet,d.PluginSettingsApiSecretNotSet].includes(this.code)?o(e):(this.code===d.FetchError&&(this.hint=this.Hint((0,v.__)("This error can sometimes be caused by ad-blockers or browser tracking protections. Please add this site to any applicable allow lists and try again.","wp-parsely"))),this.code===d.ParselyApiForbidden&&(this.hint=this.Hint((0,v.__)("Please ensure that the Site ID and API Secret given in the plugin's settings are correct.","wp-parsely"))),this.code===d.HttpRequestFailed&&(this.hint=this.Hint((0,v.__)("The Parse.ly API cannot be reached. Please verify that you are online.","wp-parsely"))),(0,n.jsx)(a,{className:null==e?void 0:e.className,testId:"error",children:"<p>".concat(this.message,"</p>").concat(this.hint?this.hint:"")}))},t.prototype.Hint=function(e){return'<p className="content-helper-error-message-hint" data-testid="content-helper-error-message-hint"><strong>'.concat((0,v.__)("Hint:","wp-parsely"),"</strong> ").concat(e,"</p>")},t}(Error),g={month:"short",day:"numeric",year:"numeric"},x={month:"short",day:"numeric"},b=(0,v.__)("Date N/A","wp-parsely");function j(e){if(!1===function(e){return!isNaN(+e)&&0!==e.getTime()}(e))return b;var t=g;return e.getUTCFullYear()===(new Date).getUTCFullYear()&&(t=x),Intl.DateTimeFormat(document.documentElement.lang||"en",t).format(e)}var P=function(){return P=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},P.apply(this,arguments)},N=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function o(e){try{l(n.next(e))}catch(e){a(e)}}function i(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))},S=function(e,t){var r,n,s,a,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(l){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(o=0)),o;)try{if(r=1,n&&(s=2&i[0]?n.return:i[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],n=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},C=function(){function e(){}return e.prototype.getTopPosts=function(e,t){return N(this,void 0,void 0,(function(){var r,n;return S(this,(function(s){switch(s.label){case 0:r=[],s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.fetchTopPostsFromWpEndpoint(e,t)];case 2:return r=s.sent(),[3,4];case 3:return n=s.sent(),[2,Promise.reject(n)];case 4:return 0===r.length?[2,Promise.reject(new _((0,v.__)("No Top Posts data is available.","wp-parsely"),d.ParselyApiReturnedNoData,""))]:[2,r]}}))}))},e.prototype.fetchTopPostsFromWpEndpoint=function(e,t){var r;return N(this,void 0,void 0,(function(){var n,s;return S(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,y()({path:(0,m.addQueryArgs)("/wp-parsely/v1/stats/posts/",P(P({limit:3},(o=parseInt(e),{period_start:"".concat(o,"d"),period_end:""})),{sort:t,itm_source:"wp-parsely-content-helper"}))})];case 1:return n=a.sent(),[3,3];case 2:return s=a.sent(),[2,Promise.reject(new _(s.message,s.code))];case 3:return(null==n?void 0:n.error)?[2,Promise.reject(new _(n.error.message,d.ParselyApiResponseContainsError))]:[2,null!==(r=null==n?void 0:n.data)&&void 0!==r?r:[]]}var o}))}))},e}(),E=function(){return(0,n.jsx)(c.SVG,{"aria-hidden":"true",version:"1.1",viewBox:"0 0 15 15",width:"15",height:"15",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)(c.Path,{d:"M0 14.0025V11.0025L7.5 3.5025L10.5 6.5025L3 14.0025H0ZM12 5.0025L13.56 3.4425C14.15 2.8525 14.15 1.9025 13.56 1.3225L12.68 0.4425C12.09 -0.1475 11.14 -0.1475 10.56 0.4425L9 2.0025L12 5.0025Z"})})},A=function(){return(0,n.jsxs)(c.SVG,{"aria-hidden":"true",version:"1.1",viewBox:"0 0 16 16",width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)(c.Path,{d:"M0 3.29592C0 2.73237 0.456853 2.27551 1.02041 2.27551H4.08165C4.50432 2.27551 4.84696 2.61815 4.84696 3.04082C4.84696 3.46349 4.50432 3.80613 4.08165 3.80613H1.53062V11.9694H9.69391V9.6735C9.69391 9.25083 10.0366 8.90819 10.4592 8.90819C10.8819 8.90819 11.2245 9.25083 11.2245 9.6735V12.4796C11.2245 13.0432 10.7677 13.5 10.2041 13.5H1.02041C0.456854 13.5 0 13.0432 0 12.4796V3.29592Z"}),(0,n.jsx)(c.Path,{d:"M12.531 1.22415C12.8299 1.52303 12.8299 2.00759 12.531 2.30646L6.15342 8.68404C5.85455 8.98291 5.36998 8.98291 5.07111 8.68404C4.77224 8.38517 4.77224 7.9006 5.07111 7.60173L11.4487 1.22415C11.7476 0.925282 12.2321 0.925282 12.531 1.22415Z"}),(0,n.jsx)(c.Path,{d:"M6.63268 1.51012C6.63268 1.08745 6.97532 0.744812 7.39799 0.744812H12.2449C12.6676 0.744812 13.0103 1.08745 13.0103 1.51012V6.35708C13.0103 6.77975 12.6676 7.12239 12.2449 7.12239C11.8223 7.12239 11.4796 6.77975 11.4796 6.35708V2.27543H7.39799C6.97532 2.27543 6.63268 1.93279 6.63268 1.51012Z"})]})};function O(e,t,r){void 0===t&&(t=1),void 0===r&&(r="");var n=parseInt(e.replace(/\D/g,""),10);if(n<1e3)return e;n<1e4&&(t=1);var s=n,a=n.toString(),o="",i=0;return Object.entries({1e3:"k","1,000,000":"M","1,000,000,000":"B","1,000,000,000,000":"T","1,000,000,000,000,000":"Q"}).forEach((function(e){var r=e[0],l=e[1],c=parseInt(r.replace(/\D/g,""),10);if(n>=c){var u=t;(s=n/c)%1>1/i&&(u=s>10?1:2),u=parseFloat(s.toFixed(2))===parseFloat(s.toFixed(0))?0:u,a=s.toFixed(u),o=l}i=c})),a+r+o}function F(e){var t=e.metric,r=e.post,s=e.avgEngagedIcon,a=e.viewsIcon;return"views"===t?(0,n.jsxs)("span",{className:"parsely-top-post-metric-data",children:[(0,n.jsx)("span",{className:"screen-reader-text",children:(0,v.__)("Number of Views","wp-parsely")}),a,O(r.views.toString())]}):"avg_engaged"===t?(0,n.jsxs)("span",{className:"parsely-top-post-metric-data",children:[(0,n.jsx)("span",{className:"screen-reader-text",children:(0,v.__)("Average Time","wp-parsely")}),s,r.avgEngaged]}):(0,n.jsx)("span",{className:"parsely-top-post-metric-data",children:(0,v.__)("-","wp-parsely")})}function T(e){var t,r=e.metric,s=e.post;return(0,n.jsx)("li",{className:"parsely-top-post",children:(0,n.jsxs)("div",{className:"parsely-top-post-content",children:[(0,n.jsx)(k,{post:s}),(0,n.jsxs)("div",{className:"parsely-top-post-data",children:[(0,n.jsx)(F,{metric:r,post:s}),(0,n.jsx)(I,{post:s}),(0,n.jsxs)("a",{className:"parsely-top-post-icon-link",href:s.url,target:"_blank",rel:"noreferrer",children:[(0,n.jsx)("span",{className:"screen-reader-text",children:(0,v.__)("View Post (opens in new tab)","wp-parsely")}),(0,n.jsx)(A,{})]}),0!==s.postId&&(0,n.jsxs)("a",{className:"parsely-top-post-icon-link",href:(t=s.postId,"/wp-admin/post.php?post=".concat(t,"&action=edit")),target:"_blank",rel:"noreferrer",children:[(0,n.jsx)("span",{className:"screen-reader-text",children:(0,v.__)("Edit Post (opens in new tab)","wp-parsely")}),(0,n.jsx)(E,{})]}),(0,n.jsxs)("div",{className:"parsely-top-post-metadata",children:[(0,n.jsxs)("span",{className:"parsely-top-post-date",children:[(0,n.jsx)("span",{className:"screen-reader-text",children:(0,v.__)("Date","wp-parsely")}),j(new Date(s.date))]}),(0,n.jsxs)("span",{className:"parsely-top-post-author",children:[(0,n.jsx)("span",{className:"screen-reader-text",children:(0,v.__)("Author","wp-parsely")}),s.author]})]})]})]})},s.id)}function k(e){var t=e.post;return t.thumbnailUrl?(0,n.jsxs)("div",{className:"parsely-top-post-thumbnail",children:[(0,n.jsx)("span",{className:"screen-reader-text",children:(0,v.__)("Thumbnail","wp-parsely")}),(0,n.jsx)("img",{src:t.thumbnailUrl,alt:(0,v.__)("Post thumbnail","wp-parsely")})]}):(0,n.jsx)("div",{className:"parsely-top-post-thumbnail",children:(0,n.jsx)("span",{className:"screen-reader-text",children:(0,v.__)("Post thumbnail not available","wp-parsely")})})}function I(e){var t=e.post;return(0,n.jsxs)("a",{className:"parsely-top-post-title",href:t.dashUrl,target:"_blank",rel:"noreferrer",children:[(0,n.jsx)("span",{className:"screen-reader-text",children:(0,v.__)("View in Parse.ly (opens in new tab)","wp-parsely")}),t.title]})}var D=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function o(e){try{l(n.next(e))}catch(e){a(e)}}function i(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))},M=function(e,t){var r,n,s,a,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(l){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(o=0)),o;)try{if(r=1,n&&(s=2&i[0]?n.return:i[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],n=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};function R(){var r=this,a=(0,s.useState)(!0),o=a[0],i=a[1],l=(0,s.useState)(),p=l[0],d=l[1],f=(0,s.useState)([]),y=f[0],v=f[1],m=(0,s.useState)(e.Week),w=m[0],_=m[1],g=(0,s.useState)(t.Views),x=g[0],b=g[1];if((0,s.useEffect)((function(){var e=new C,t=function(n){return D(r,void 0,void 0,(function(){var r=this;return M(this,(function(s){return e.getTopPosts(w,x).then((function(e){v(e),i(!1)})).catch((function(e){return D(r,void 0,void 0,(function(){return M(this,(function(r){switch(r.label){case 0:return n>0&&e.retryFetch?[4,new Promise((function(e){return setTimeout(e,500)}))]:[3,3];case 1:return r.sent(),[4,t(n-1)];case 2:return r.sent(),[3,4];case 3:i(!1),d(e),r.label=4;case 4:return[2]}}))}))})),[2]}))}))};return i(!0),t(1),function(){i(!1),v([]),d(void 0)}}),[w,x]),p)return p.Message({className:"parsely-top-posts-descr"});var j=(0,n.jsx)("div",{className:"parsely-spinner-wrapper",children:(0,n.jsx)(c.Spinner,{})});return(0,n.jsxs)("div",{className:"parsely-top-posts-wrapper",children:[(0,n.jsxs)("div",{className:"parsely-top-posts-filters",children:[(0,n.jsx)(u,{defaultValue:w,items:[[e.Day,"Last 24 Hours"],[e.Week,"Last 7 Days"],[e.Month,"Last 30 Days"]],onChange:function(t){h(t.target.value,e)&&_(t.target.value)}}),(0,n.jsx)(u,{defaultValue:x,items:[[t.Views,"Page views"],[t.AvgEngaged,"Avg. Time"]],onChange:function(e){h(e.target.value,t)&&b(e.target.value)}})]}),o?j:(0,n.jsx)("ol",{className:"parsely-top-posts",children:y.map((function(e){return(0,n.jsx)(T,{metric:x,post:e},e.id)}))})]})}window.addEventListener("load",(function(){(0,s.render)((0,n.jsx)(l,{children:(0,n.jsx)(R,{})}),document.querySelector("#wp-parsely-dashboard-widget > .inside"))}),!1)}()}();